const t={isRecording:!1,sessionId:null,tabId:null,steps:[]};chrome.runtime.onMessage.addListener((e,s,r)=>{var o,n;switch(e.type){case"content-script:ready":console.log("[QAerx] Content script ready in tab:",(o=s.tab)==null?void 0:o.id),r({success:!0});break;case"recording:started":t.isRecording=!0,t.sessionId=e.sessionId,t.tabId=((n=s.tab)==null?void 0:n.id)||null,t.steps=[],c({type:"recording:state-changed",state:t}),r({success:!0});break;case"recording:stopped":t.isRecording=!1,t.steps=e.steps||[],c({type:"recording:completed",sessionId:e.sessionId,steps:e.steps}),r({success:!0});break;case"recording:step-added":t.steps.push(e.step),c({type:"recording:step-added",step:e.step}),r({success:!0});break;case"recording:paused":case"recording:resumed":c({type:e.type}),r({success:!0});break;case"command:start-recording":return a(e.tabId).then(r),!0;case"command:stop-recording":return i().then(r),!0;case"command:get-state":r({state:t});break;default:r({error:"Unknown message type"})}return!0});async function a(e){try{const s=e||await d();if(!s)return{success:!1,error:"No active tab found"};const r=crypto.randomUUID();return await chrome.tabs.sendMessage(s,{type:"recording:start",sessionId:r}),{success:!0}}catch(s){return console.error("[QAerx] Failed to start recording:",s),{success:!1,error:String(s)}}}async function i(){try{return t.tabId?{success:!0,steps:(await chrome.tabs.sendMessage(t.tabId,{type:"recording:stop"})).steps}:{success:!1,error:"No recording in progress"}}catch(e){return console.error("[QAerx] Failed to stop recording:",e),{success:!1,error:String(e)}}}async function d(){const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});return e==null?void 0:e.id}function c(e){chrome.runtime.sendMessage(e).catch(()=>{})}chrome.action.onClicked.addListener(e=>{e.id&&chrome.sidePanel.open({tabId:e.id})});chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0});console.log("[QAerx] Background service worker initialized");
