var Ce=Object.defineProperty;var Te=(a,s,t)=>s in a?Ce(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t;var P=(a,s,t)=>Te(a,typeof s!="symbol"?s+"":s,t);import"./chunks/modulepreload-polyfill.B5Qt9EMX.js";import{j as e,Z as Ee,F as Fe,P as ie,H as ye,S as Re,c as T,r as f,z as b,a as De,C as Pe,D as Me,v as ce,b as $e,d as pe,e as oe,T as W,f as he,g as X,G as Le,E as le,h as Oe,i as ze,k as Q,l as Z,m as se,L as ee,n as Be,X as Ue,N as be,M as de,o as we,p as je,q as ue,s as qe,t as te,U as Ve,u as ve,w as We,x as Ke,O as Ye,y as _e,A as H,B as Ge,I as Je,J as He,K as Qe,Q as Xe,R as Ze,V as et,W as tt,Y as st,_ as at,$ as nt}from"./chunks/client.BFtubph4.js";const rt=[{id:"suites",icon:Fe,label:"Suites"},{id:"tests",icon:ie,label:"Tests"},{id:"results",icon:ye,label:"Results"},{id:"settings",icon:Re,label:"Settings"}];function it({currentView:a,onViewChange:s}){return e.jsxs("aside",{className:"w-16 bg-dark-950 border-r border-dark-800 flex flex-col items-center py-4",children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"w-10 h-10 bg-accent rounded-xl flex items-center justify-center",children:e.jsx(Ee,{className:"w-6 h-6 text-white"})})}),e.jsx("nav",{className:"flex-1 flex flex-col gap-2",children:rt.map(t=>{const r=t.icon,n=a===t.id;return e.jsx("button",{onClick:()=>s(t.id),className:T("w-10 h-10 rounded-lg flex items-center justify-center transition-colors",n?"bg-accent text-white":"text-dark-400 hover:text-dark-100 hover:bg-dark-800"),title:t.label,children:e.jsx(r,{className:"w-5 h-5"})},t.id)})}),e.jsx("div",{className:"mt-auto pt-4 text-[10px] text-dark-600",children:"v0.1"})]})}function ct(){const[a,s]=f.useState({isRecording:!1,isPaused:!1,steps:[],sessionId:null});f.useEffect(()=>{const o=l=>{switch(l.type){case"recording:state-changed":break;case"recording:step-added":l.step&&s(u=>({...u,steps:[...u.steps,l.step]}));break;case"recording:completed":s(u=>({...u,isRecording:!1,steps:l.steps||u.steps}));break;case"recording:paused":s(u=>({...u,isPaused:!0}));break;case"recording:resumed":s(u=>({...u,isPaused:!1}));break}};return chrome.runtime.onMessage.addListener(o),()=>chrome.runtime.onMessage.removeListener(o)},[]);const t=f.useCallback(async()=>{try{const o=await chrome.runtime.sendMessage({type:"command:start-recording"});o.success?(s({isRecording:!0,isPaused:!1,steps:[],sessionId:crypto.randomUUID()}),b.success("Recording started")):b.error(o.error||"Failed to start recording")}catch(o){console.error("Failed to start recording:",o),b.error("Failed to start recording. Make sure you are on a web page.")}},[]),r=f.useCallback(async()=>{var o;try{const l=await chrome.runtime.sendMessage({type:"command:stop-recording"});return l.success?(s(u=>({...u,isRecording:!1,steps:l.steps||u.steps})),b.success(`Recording stopped. ${((o=l.steps)==null?void 0:o.length)||0} steps captured.`),l.steps||[]):(b.error(l.error||"Failed to stop recording"),[])}catch(l){return console.error("Failed to stop recording:",l),b.error("Failed to stop recording"),[]}},[]),n=f.useCallback(async()=>{await chrome.runtime.sendMessage({type:"command:pause-recording"}),s(o=>({...o,isPaused:!0}))},[]),c=f.useCallback(async()=>{await chrome.runtime.sendMessage({type:"command:resume-recording"}),s(o=>({...o,isPaused:!1}))},[]);return{...a,startRecording:t,stopRecording:r,pauseRecording:n,resumeRecording:c}}const ot={suites:"Test Suites",tests:"Tests",results:"Results",settings:"Settings"};function lt({currentView:a}){const{isRecording:s,startRecording:t,stopRecording:r}=ct();return e.jsxs("header",{className:"h-14 bg-dark-850 border-b border-dark-800 px-4 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("h1",{className:"text-lg font-semibold text-dark-100",children:ot[a]})}),e.jsx("div",{className:"flex items-center gap-2",children:s?e.jsxs("button",{onClick:r,className:"btn btn-sm bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(De,{className:"w-3 h-3 fill-current"}),"Stop Recording"]}):e.jsxs("button",{onClick:t,className:"btn btn-sm btn-primary",children:[e.jsx(Pe,{className:T("w-3 h-3",s&&"fill-current animate-pulse")}),"Record"]})})]})}class dt extends Me{constructor(){super("QAerxDB");P(this,"suites");P(this,"tests");P(this,"testRuns");P(this,"credentials");P(this,"screenshots");P(this,"settings");this.version(1).stores({suites:"id, parentId, name, updatedAt",tests:"id, suiteId, name, updatedAt, [suiteId+order]",testRuns:"id, testId, suiteId, status, startedAt, [testId+startedAt]",credentials:"id, name, domain",screenshots:"id, testRunId, stepId, timestamp, isBaseline, [testId+isBaseline]",settings:"id"}),this.version(2).stores({suites:"id, parentId, name, order, updatedAt",tests:"id, suiteId, name, updatedAt, [suiteId+order]",testRuns:"id, testId, suiteId, status, startedAt, [testId+startedAt]",credentials:"id, name, domain",screenshots:"id, testRunId, stepId, timestamp, isBaseline, [testId+isBaseline]",settings:"id"})}}const j=new dt,_={async create(a){console.log("SuiteRepository.create called with:",a);const s=Date.now(),t={...a,id:ce(),createdAt:s,updatedAt:s};return console.log("Creating suite:",t),console.log("Database instance:",j),await j.suites.add(t),console.log("Suite added successfully"),t},async getById(a){return j.suites.get(a)},async getAll(){return j.suites.orderBy("order").toArray()},async getByParent(a){return a===void 0?j.suites.filter(s=>!s.parentId).toArray():j.suites.where("parentId").equals(a).toArray()},async update(a,s){await j.suites.update(a,{...s,updatedAt:Date.now()})},async delete(a){await j.tests.where("suiteId").equals(a).delete();const s=await this.getByParent(a);for(const t of s)await this.delete(t.id);await j.suites.delete(a)},async getTree(){const a=await this.getAll(),s=await j.tests.toArray(),t=new Map;for(const n of s)t.set(n.suiteId,(t.get(n.suiteId)||0)+1);const r=n=>a.filter(c=>c.parentId===n).sort((c,o)=>c.order-o.order).map(c=>({...c,children:r(c.id),tests:t.get(c.id)||0}));return r(void 0)},async createDefault(){return this.create({name:"Default Suite",order:0,hooks:{}})}},z={async create(a){const s=Date.now(),t={...a,id:ce(),createdAt:s,updatedAt:s};return await j.tests.add(t),t},async getById(a){return j.tests.get(a)},async getAll(){return j.tests.toArray()},async getBySuite(a){return j.tests.where("suiteId").equals(a).sortBy("order")},async update(a,s){await j.tests.update(a,{...s,updatedAt:Date.now()})},async delete(a){await j.testRuns.where("testId").equals(a).delete(),await j.tests.delete(a)},async addStep(a,s){const t=await this.getById(a);if(!t)throw new Error("Test not found");const r=[...t.steps,s];await this.update(a,{steps:r})},async updateStep(a,s,t){const r=await this.getById(a);if(!r)throw new Error("Test not found");const n=r.steps.map(c=>c.id===s?{...c,...t}:c);await this.update(a,{steps:n})},async deleteStep(a,s){const t=await this.getById(a);if(!t)throw new Error("Test not found");const n=t.steps.filter(c=>c.id!==s).map((c,o)=>({...c,order:o}));await this.update(a,{steps:n})},async reorderSteps(a,s){const t=await this.getById(a);if(!t)throw new Error("Test not found");const r=new Map(t.steps.map(c=>[c.id,c])),n=s.map((c,o)=>{const l=r.get(c);return l?{...l,order:o}:null}).filter(c=>c!==null);await this.update(a,{steps:n})},async createNew(a,s,t){const n=(await this.getBySuite(a)).length;return this.create({suiteId:a,name:s,url:t,order:n,steps:[]})}},ut={async create(a,s){const t={id:ce(),testId:a,suiteId:s,startedAt:Date.now(),status:"running",environment:await this.getEnvironment(),stepResults:[],summary:{totalSteps:0,passedSteps:0,failedSteps:0,skippedSteps:0,duration:0}};return await j.testRuns.add(t),t},async getById(a){return j.testRuns.get(a)},async getByTest(a,s=10){return j.testRuns.where("testId").equals(a).reverse().sortBy("startedAt").then(t=>t.slice(0,s))},async getBySuite(a,s=50){return j.testRuns.where("suiteId").equals(a).reverse().sortBy("startedAt").then(t=>t.slice(0,s))},async getRecent(a=20){return j.testRuns.orderBy("startedAt").reverse().limit(a).toArray()},async update(a,s){await j.testRuns.update(a,s)},async addStepResult(a,s){const t=await this.getById(a);if(!t)throw new Error("Test run not found");const r=[...t.stepResults,s],n=this.calculateSummary(r,t.startedAt);await this.update(a,{stepResults:r,summary:n})},async complete(a,s){const t=await this.getById(a);if(!t)throw new Error("Test run not found");const r=Date.now(),n=this.calculateSummary(t.stepResults,t.startedAt,r);await this.update(a,{status:s,completedAt:r,summary:n})},async delete(a){await j.screenshots.where("testRunId").equals(a).delete(),await j.testRuns.delete(a)},async pruneOld(a=30){const s=Date.now()-a*24*60*60*1e3,t=await j.testRuns.where("startedAt").below(s).toArray();for(const r of t)await j.screenshots.where("testRunId").equals(r.id).delete();return j.testRuns.where("startedAt").below(s).delete()},calculateSummary(a,s,t){return{totalSteps:a.length,passedSteps:a.filter(r=>r.status==="passed").length,failedSteps:a.filter(r=>r.status==="failed").length,skippedSteps:a.filter(r=>r.status==="skipped").length,duration:(t||Date.now())-s}},async getEnvironment(){var a,s,t,r;return{browserVersion:((a=navigator.userAgent.match(/Chrome\/(\d+)/))==null?void 0:a[1])||"unknown",extensionVersion:((r=(t=(s=chrome.runtime)==null?void 0:s.getManifest)==null?void 0:t.call(s))==null?void 0:r.version)||"0.1.0",screenSize:{width:window.screen.width,height:window.screen.height},userAgent:navigator.userAgent}}},xe={id:"app-settings",parallelLimit:2,defaultTimeout:3e4,screenshotQuality:80,recordMouseMovements:!1,recordScrollEvents:!0,onboardingCompleted:!1,tutorialProgress:0,theme:"dark"},G={async get(){const a=await j.settings.get("app-settings");return a||(await j.settings.add(xe),xe)},async update(a){const t={...await this.get(),...a};return await j.settings.put(t),t},async setOpenAIKey(a){await this.update({openaiApiKey:a})},async clearOpenAIKey(){await this.update({openaiApiKey:void 0})},async setParallelLimit(a){await this.update({parallelLimit:Math.max(1,Math.min(a,10))})},async completeOnboarding(){await this.update({onboardingCompleted:!0})},async updateTutorialProgress(a){await this.update({tutorialProgress:a})},async setLastOpened(a,s){await this.update({lastOpenedSuiteId:a,lastOpenedTestId:s})}},Ne=f.createContext(null);function mt({children:a}){const[s,t]=f.useState([]),[r,n]=f.useState([]),[c,o]=f.useState(null),[l,u]=f.useState(!0),h=async()=>{const g=await _.getAll();t(g)},x=async g=>{const i=g?await z.getBySuite(g):await z.getAll();n(i)},d=async()=>{const g=await G.get();o(g)};return f.useEffect(()=>{(async()=>{try{console.log("AppContext init starting..."),u(!0),await Promise.all([h(),x(),d()]),console.log("Initial data loaded");const i=await _.getAll();console.log("All suites:",i),i.length===0&&(console.log("Creating default suite..."),await _.createDefault(),await h()),u(!1),console.log("AppContext init complete")}catch(i){console.error("AppContext init error:",i),u(!1)}})()},[]),e.jsx(Ne.Provider,{value:{suites:s,tests:r,settings:c,isLoading:l,refreshSuites:h,refreshTests:x,refreshSettings:d},children:a})}function Se(){const a=f.useContext(Ne);if(!a)throw new Error("useApp must be used within AppProvider");return a}function pt({selectedSuiteId:a,onSelectSuite:s}){const{suites:t,refreshSuites:r}=Se(),[n,c]=f.useState(!1),[o,l]=f.useState(""),u=async()=>{if(o.trim())try{await _.create({name:o.trim(),order:t.length,hooks:{}}),await r(),l(""),c(!1),b.success("Suite created")}catch(x){console.error("Suite creation error:",x),b.error("Failed to create suite: "+(x instanceof Error?x.message:"Unknown error"))}},h=async x=>{if(confirm("Delete this suite and all its tests?"))try{await _.delete(x),await r(),a===x&&s(null),b.success("Suite deleted")}catch{b.error("Failed to delete suite")}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-sm font-medium text-dark-400 uppercase tracking-wider",children:["Suites (",t.length,")"]}),e.jsxs("button",{onClick:()=>c(!0),className:"btn btn-sm btn-ghost",children:[e.jsx($e,{className:"w-4 h-4"}),"New Suite"]})]}),n&&e.jsxs("div",{className:"card p-3",children:[e.jsx("input",{type:"text",placeholder:"Suite name",value:o,onChange:x=>l(x.target.value),onKeyDown:x=>{x.key==="Enter"&&u(),x.key==="Escape"&&c(!1)},className:"input mb-2",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:u,className:"btn btn-sm btn-primary",children:"Create"}),e.jsx("button",{onClick:()=>c(!1),className:"btn btn-sm btn-ghost",children:"Cancel"})]})]}),e.jsxs("div",{className:"space-y-1",children:[t.map(x=>e.jsxs("div",{className:T("group flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer transition-colors",a===x.id?"bg-accent/20 text-accent":"hover:bg-dark-800 text-dark-200"),onClick:()=>s(x.id),children:[e.jsx(pe,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"flex-1 truncate",children:x.name}),e.jsx(oe,{className:"w-4 h-4 opacity-0 group-hover:opacity-100"}),e.jsx("button",{onClick:d=>{d.stopPropagation(),h(x.id)},className:"p-1 opacity-0 group-hover:opacity-100 hover:text-red-400",children:e.jsx(W,{className:"w-3 h-3"})})]},x.id)),t.length===0&&!n&&e.jsxs("div",{className:"text-center py-8 text-dark-500",children:[e.jsx(pe,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No test suites yet"}),e.jsx("button",{onClick:()=>c(!0),className:"btn btn-sm btn-primary mt-4",children:"Create your first suite"})]})]})]})}function ht({suiteId:a,selectedTestId:s,onSelectTest:t}){const[r,n]=f.useState([]),[c,o]=f.useState(!1),[l,u]=f.useState(""),[h,x]=f.useState("");f.useEffect(()=>{a?z.getBySuite(a).then(n):z.getAll().then(n)},[a]);const d=async()=>{if(!(!l.trim()||!a))try{await z.createNew(a,l.trim(),h||"https://");const i=await z.getBySuite(a);n(i),u(""),x(""),o(!1),b.success("Test created")}catch{b.error("Failed to create test")}},g=async i=>{if(confirm("Delete this test?"))try{if(await z.delete(i),a){const m=await z.getBySuite(a);n(m)}s===i&&t(null),b.success("Test deleted")}catch{b.error("Failed to delete test")}};return a?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-sm font-medium text-dark-400 uppercase tracking-wider",children:["Tests (",r.length,")"]}),e.jsxs("button",{onClick:()=>o(!0),className:"btn btn-sm btn-ghost",children:[e.jsx(X,{className:"w-4 h-4"}),"New Test"]})]}),c&&e.jsxs("div",{className:"card p-3 space-y-2",children:[e.jsx("input",{type:"text",placeholder:"Test name",value:l,onChange:i=>u(i.target.value),className:"input",autoFocus:!0}),e.jsx("input",{type:"url",placeholder:"Starting URL (https://...)",value:h,onChange:i=>x(i.target.value),className:"input"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:d,className:"btn btn-sm btn-primary",children:"Create"}),e.jsx("button",{onClick:()=>o(!1),className:"btn btn-sm btn-ghost",children:"Cancel"})]})]}),e.jsxs("div",{className:"space-y-2",children:[r.map(i=>e.jsx("div",{className:T("card p-3 cursor-pointer transition-colors",s===i.id?"ring-2 ring-accent":"hover:bg-dark-750"),onClick:()=>t(i.id),children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-dark-100 truncate",children:i.name}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-dark-500 mt-1",children:[e.jsx(Le,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:i.url})]}),e.jsxs("div",{className:"text-xs text-dark-500 mt-1",children:[i.steps.length," steps"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:m=>{m.stopPropagation(),b.success("Running test...")},className:"btn btn-icon btn-sm btn-ghost text-accent hover:bg-accent/20",children:e.jsx(ie,{className:"w-4 h-4"})}),e.jsx("button",{onClick:m=>{m.stopPropagation(),g(i.id)},className:"btn btn-icon btn-sm btn-ghost text-dark-400 hover:text-red-400",children:e.jsx(W,{className:"w-4 h-4"})})]})]})},i.id)),r.length===0&&!c&&e.jsxs("div",{className:"text-center py-8 text-dark-500",children:[e.jsx(he,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No tests in this suite"}),e.jsx("button",{onClick:()=>o(!0),className:"btn btn-sm btn-primary mt-4",children:"Create your first test"})]})]})]}):e.jsxs("div",{className:"text-center py-12 text-dark-500",children:[e.jsx(he,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Select a suite to view tests"})]})}function xt(a,s){let t=null;const r=function(...n){const c=()=>{t=null,a.apply(this,n)};t&&clearTimeout(t),t=setTimeout(c,s)};return r.cancel=()=>{t&&(clearTimeout(t),t=null)},r}function gt(a){const[s,t]=f.useState({isValid:!1,count:0,status:"validating",message:""});return f.useEffect(()=>{if(!a||a.trim()===""){t({isValid:!1,count:0,status:"invalid",message:"Enter a selector"});return}const r=xt(async()=>{var n;try{const[c]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(c!=null&&c.id)){t({isValid:!1,count:0,status:"error",message:"No active tab"});return}let o;try{o=await chrome.tabs.sendMessage(c.id,{type:"selector:validate",selector:a})}catch{try{await chrome.scripting.executeScript({target:{tabId:c.id},files:["content.js"]}),await new Promise(u=>setTimeout(u,300)),o=await chrome.tabs.sendMessage(c.id,{type:"selector:validate",selector:a})}catch{t({isValid:!1,count:0,status:"error",message:"Content script not available"});return}}if(!o){t({isValid:!1,count:0,status:"error",message:"Cannot validate"});return}o.count===0?t({isValid:!1,count:0,status:"invalid",message:"No elements found"}):o.count===1?t({isValid:!0,count:1,status:"valid",message:`Found: ${((n=o.element)==null?void 0:n.tag)||"element"}`}):t({isValid:!0,count:o.count,status:"multiple",message:`${o.count} elements found`})}catch{t({isValid:!1,count:0,status:"error",message:"Validation error"})}},500);return r(),()=>{var n;(n=r.cancel)==null||n.call(r)}},[a]),s}function ge({value:a,onChange:s,suggestions:t=[],onSuggestionsRequest:r}){const n=gt(a),[c,o]=f.useState(!1),[l,u]=f.useState(!1),h=async()=>{if(a)try{const[i]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(i!=null&&i.id))return;await chrome.tabs.sendMessage(i.id,{type:"ping"}).catch(async()=>{await chrome.scripting.executeScript({target:{tabId:i.id},files:["content.js"]}),await new Promise(m=>setTimeout(m,200))}),await chrome.tabs.sendMessage(i.id,{type:"element:highlight",selector:a})}catch(i){console.error("Failed to highlight element:",i)}},x=async()=>{try{u(!0);const[i]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(i!=null&&i.id))throw new Error("No active tab");await chrome.tabs.sendMessage(i.id,{type:"ping"}).catch(async()=>{await chrome.scripting.executeScript({target:{tabId:i.id},files:["content.js"]}),await new Promise(y=>setTimeout(y,200))}),await chrome.tabs.sendMessage(i.id,{type:"picker:start"});const m=y=>{y.type==="picker:element-selected"&&(y.selectors&&y.selectors.length>0&&(s(y.selectors[0].value,y.selectors),r&&r()),chrome.runtime.onMessage.removeListener(m),u(!1))};chrome.runtime.onMessage.addListener(m),setTimeout(()=>{chrome.runtime.onMessage.removeListener(m),u(!1)},6e4)}catch(i){console.error("Failed to pick element:",i),u(!1)}},d=()=>{switch(n.status){case"validating":return e.jsx(ee,{className:"w-4 h-4 animate-spin text-dark-500"});case"valid":return e.jsx(se,{className:"w-4 h-4 text-green-400"});case"multiple":return e.jsx(Z,{className:"w-4 h-4 text-yellow-400"});case"invalid":case"error":return e.jsx(Z,{className:"w-4 h-4 text-red-400"})}},g=()=>{switch(n.status){case"valid":return"border-green-400 focus:ring-green-400";case"multiple":return"border-yellow-400 focus:ring-yellow-400";case"invalid":case"error":return"border-red-400 focus:ring-red-400";default:return"border-dark-700"}};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:a,onChange:i=>s(i.target.value),placeholder:"#id, .class, [attr], button[type='submit']",className:T("input pr-10 font-mono text-sm transition-all",g())}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1",children:d()})]}),n.isValid&&e.jsx("button",{onClick:h,className:"btn btn-sm btn-ghost",title:"Preview element on page",children:e.jsx(le,{className:"w-4 h-4"})}),e.jsxs("button",{onClick:x,disabled:l,className:T("btn btn-sm",l?"btn-ghost animate-pulse":"btn-primary"),title:"Pick element from page",children:[e.jsx(Oe,{className:"w-4 h-4"}),l?"Picking...":"Pick"]}),t.length>0&&e.jsx("button",{onClick:()=>o(!c),className:"btn btn-sm btn-ghost",title:"Show selector suggestions",children:c?e.jsx(ze,{className:"w-4 h-4"}):e.jsx(Q,{className:"w-4 h-4"})})]}),n.message&&e.jsx("p",{className:T("text-xs mt-1",n.status==="valid"?"text-green-400":n.status==="multiple"?"text-yellow-400":"text-red-400"),children:n.message})]}),c&&t.length>0&&e.jsxs("div",{className:"bg-dark-850 border border-dark-700 rounded-lg p-2 space-y-1",children:[e.jsx("div",{className:"text-xs text-dark-400 px-2 py-1",children:"Suggestions (click to use):"}),t.slice(0,5).map((i,m)=>e.jsx("button",{onClick:()=>{s(i.value),o(!1)},className:"w-full text-left px-3 py-2 rounded hover:bg-dark-700 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("code",{className:"text-xs text-dark-200 font-mono",children:i.value}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-dark-500",children:i.type}),e.jsxs("span",{className:T("text-xs px-1.5 py-0.5 rounded",i.confidence>.8?"bg-green-400/20 text-green-400":i.confidence>.6?"bg-yellow-400/20 text-yellow-400":"bg-dark-700 text-dark-400"),children:[Math.round(i.confidence*100),"%"]})]})]})},m))]})]})}function ft(){const[a,s]=f.useState(!0);return a?e.jsx("div",{className:"bg-accent/10 border border-accent/30 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx(Be,{className:"w-5 h-5 text-accent flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-accent",children:"Selector Tips"}),e.jsxs("div",{className:"text-xs text-dark-300 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{className:"text-dark-200",children:"1. Use the Pick button"})," - Click on the page element directly"]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-dark-200",children:"2. By ID:"})," ",e.jsx("code",{className:"bg-dark-800 px-1 rounded",children:"#email"})," - Most reliable"]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-dark-200",children:"3. By name:"})," ",e.jsx("code",{className:"bg-dark-800 px-1 rounded",children:'input[name="email"]'})]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-dark-200",children:"4. By type:"})," ",e.jsx("code",{className:"bg-dark-800 px-1 rounded",children:'button[type="submit"]'})]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-dark-200",children:"5. By placeholder:"})," ",e.jsx("code",{className:"bg-dark-800 px-1 rounded",children:'input[placeholder="Email"]'})]})]})]}),e.jsx("button",{onClick:()=>s(!1),className:"btn btn-icon btn-sm btn-ghost flex-shrink-0",children:e.jsx(Ue,{className:"w-4 h-4"})})]})}):null}const yt=[{type:"navigate",label:"Navigate",icon:be,description:"Go to a URL"},{type:"click",label:"Click",icon:de,description:"Click an element"},{type:"type",label:"Type",icon:we,description:"Enter text into a field"},{type:"select",label:"Select",icon:je,description:"Select from dropdown"},{type:"assert",label:"Assert",icon:le,description:"Verify element text/visibility"},{type:"wait",label:"Wait",icon:ue,description:"Wait for element or time"}];function bt({steps:a,onStepsChange:s,currentStepId:t,stepResults:r}){const[n,c]=f.useState(null),[o,l]=f.useState(!1),u=i=>r==null?void 0:r.find(m=>m.stepId===i),h=i=>{const m=jt(i,a.length);s([...a,m]),c(m.id),l(!1)},x=(i,m)=>{s(a.map(y=>y.id===i?{...y,...m}:y))},d=i=>{s(a.filter(m=>m.id!==i)),n===i&&c(null)},g=(i,m)=>{const y=m==="up"?i-1:i+1;if(y<0||y>=a.length)return;const I=[...a];[I[i],I[y]]=[I[y],I[i]],I.forEach((p,v)=>p.order=v),s(I)};return e.jsxs("div",{className:"space-y-3",children:[e.jsx(ft,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-medium text-dark-300",children:["Steps (",a.length,")"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>l(!o),className:"btn btn-sm btn-primary",children:[e.jsx(X,{className:"w-4 h-4"}),"Add Step"]}),o&&e.jsx("div",{className:"absolute right-0 top-full mt-1 w-56 bg-dark-800 border border-dark-700 rounded-lg shadow-xl z-10",children:yt.map(({type:i,label:m,icon:y,description:I})=>e.jsxs("button",{onClick:()=>h(i),className:"w-full flex items-center gap-3 px-3 py-2 hover:bg-dark-700 text-left first:rounded-t-lg last:rounded-b-lg",children:[e.jsx(y,{className:"w-4 h-4 text-accent"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-dark-100",children:m}),e.jsx("div",{className:"text-xs text-dark-500",children:I})]})]},i))})]})]}),a.length===0?e.jsxs("div",{className:"text-center py-8 text-dark-500 border border-dashed border-dark-700 rounded-lg",children:[e.jsx(de,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No steps yet"}),e.jsx("p",{className:"text-xs mt-1",children:'Click "Add Step" to create your first test step'})]}):e.jsx("div",{className:"space-y-2",children:a.map((i,m)=>e.jsx(wt,{step:i,index:m,isExpanded:n===i.id,isCurrent:t===i.id,result:u(i.id),onToggle:()=>c(n===i.id?null:i.id),onUpdate:y=>x(i.id,y),onDelete:()=>d(i.id),onMove:y=>g(m,y),canMoveUp:m>0,canMoveDown:m<a.length-1},i.id))})]})}function wt({step:a,index:s,isExpanded:t,isCurrent:r,result:n,onToggle:c,onUpdate:o,onDelete:l,onMove:u,canMoveUp:h,canMoveDown:x}){var v,k;const g=(()=>{switch(a.action.type){case"navigate":return be;case"click":case"dblclick":return de;case"type":return we;case"select":return je;case"waitForElement":return ue;default:return le}})(),i=N=>{o({action:{...a.action,...N}})},m=(N,L)=>{if(L)o({selectors:L});else{const M=a.selectors.length>1?a.selectors:[],U=[{type:"css",value:N,priority:0,confidence:1},...M.slice(1)];o({selectors:U})}},y=()=>r?"border-blue-400 shadow-lg shadow-blue-400/20":(n==null?void 0:n.status)==="passed"?"border-green-400":(n==null?void 0:n.status)==="failed"?"border-red-400":t?"border-accent":"border-dark-700",I=()=>r?"bg-blue-400/5":(n==null?void 0:n.status)==="passed"?"bg-green-400/5":(n==null?void 0:n.status)==="failed"?"bg-red-400/5":t?"bg-dark-850":"bg-dark-800",p=()=>r?e.jsx(ee,{className:"w-4 h-4 text-blue-400 animate-spin"}):(n==null?void 0:n.status)==="passed"?e.jsx(se,{className:"w-4 h-4 text-green-400"}):(n==null?void 0:n.status)==="failed"?e.jsx(te,{className:"w-4 h-4 text-red-400"}):null;return e.jsxs("div",{className:T("border rounded-lg transition-all duration-200",y(),I()),children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 cursor-pointer",onClick:c,children:[e.jsx(qe,{className:"w-4 h-4 text-dark-600 cursor-grab"}),e.jsx("span",{className:T("w-6 h-6 flex items-center justify-center rounded text-xs",r?"bg-blue-400/20 text-blue-400":(n==null?void 0:n.status)==="passed"?"bg-green-400/20 text-green-400":(n==null?void 0:n.status)==="failed"?"bg-red-400/20 text-red-400":"bg-dark-700 text-dark-400"),children:s+1}),e.jsx(g,{className:T("w-4 h-4",r?"text-blue-400":(n==null?void 0:n.status)==="passed"?"text-green-400":(n==null?void 0:n.status)==="failed"?"text-red-400":"text-accent")}),e.jsx("span",{className:T("flex-1 text-sm truncate",r?"text-blue-300 font-medium":(n==null?void 0:n.status)==="passed"?"text-green-300":(n==null?void 0:n.status)==="failed"?"text-red-300":"text-dark-200"),children:a.name}),p(),(n==null?void 0:n.duration)&&e.jsxs("span",{className:"text-xs text-dark-500",children:[n.duration,"ms"]}),t?e.jsx(Q,{className:"w-4 h-4 text-dark-500"}):e.jsx(oe,{className:"w-4 h-4 text-dark-500"})]}),(n==null?void 0:n.error)&&!t&&e.jsx("div",{className:"px-3 pb-2",children:e.jsx("div",{className:"text-xs text-red-400 bg-red-400/10 rounded px-2 py-1",children:n.error})}),t&&e.jsxs("div",{className:"px-3 pb-3 space-y-3 border-t border-dark-700 pt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-dark-400 mb-1",children:"Step Name"}),e.jsx("input",{type:"text",value:a.name,onChange:N=>o({name:N.target.value}),className:"input"})]}),a.action.type==="navigate"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-dark-400 mb-1",children:["URL ",e.jsxs("span",{className:"text-dark-600",children:["(use ","{{variable}}"," for data)"]})]}),e.jsx("input",{type:"text",value:a.action.url||"",onChange:N=>i({url:N.target.value}),placeholder:"https://example.com/{{page}}",className:"input"})]}),["click","type","select","waitForElement"].includes(a.action.type)&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-dark-400 mb-1",children:["Element Selector ",e.jsx("span",{className:"text-dark-600",children:"(CSS selector, or use Pick button)"})]}),e.jsx(ge,{value:((v=a.selectors[0])==null?void 0:v.value)||"",onChange:m,suggestions:a.selectors,onSuggestionsRequest:()=>{}})]}),a.action.type==="type"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-dark-400 mb-1",children:["Text to Type ",e.jsxs("span",{className:"text-dark-600",children:["(use ","{{variable}}"," for data)"]})]}),e.jsx("input",{type:"text",value:a.action.text||"",onChange:N=>i({text:N.target.value}),placeholder:"{{email}}",className:"input"})]}),a.action.type==="select"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-dark-400 mb-1",children:["Value to Select ",e.jsxs("span",{className:"text-dark-600",children:["(use ","{{variable}}"," for data)"]})]}),e.jsx("input",{type:"text",value:a.action.value||"",onChange:N=>i({value:N.target.value}),placeholder:"{{option}}",className:"input"})]}),(a.action.type==="waitTime"||a.action.type==="waitForElement")&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-dark-400 mb-2",children:"Wait Type"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>i({type:"waitTime",duration:2e3}),className:T("flex-1 px-3 py-2 rounded-lg text-sm transition-colors",a.action.type==="waitTime"?"bg-accent text-white":"bg-dark-700 text-dark-300 hover:bg-dark-600"),children:"Wait for Time"}),e.jsx("button",{onClick:()=>{i({type:"waitForElement"}),a.selectors.length===0&&o({selectors:[{type:"css",value:"",priority:0,confidence:1}]})},className:T("flex-1 px-3 py-2 rounded-lg text-sm transition-colors",a.action.type==="waitForElement"?"bg-accent text-white":"bg-dark-700 text-dark-300 hover:bg-dark-600"),children:"Wait for Element"})]})]}),a.action.type==="waitTime"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-dark-400 mb-1",children:"Duration (milliseconds)"}),e.jsx("input",{type:"number",value:a.action.duration||2e3,onChange:N=>i({duration:parseInt(N.target.value)||2e3}),placeholder:"2000",min:"100",step:"100",className:"input"}),e.jsxs("p",{className:"text-xs text-dark-500 mt-1",children:[(a.action.duration||2e3)/1e3," seconds"]})]}),a.action.type==="waitForElement"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-dark-400 mb-1",children:["Element Selector ",e.jsx("span",{className:"text-dark-600",children:"(CSS selector, or use Pick button)"})]}),e.jsx(ge,{value:((k=a.selectors[0])==null?void 0:k.value)||"",onChange:m,suggestions:a.selectors,onSuggestionsRequest:()=>{}})]})]}),(n==null?void 0:n.error)&&e.jsx("div",{className:"bg-red-400/10 border border-red-400/20 rounded-lg p-3 mb-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(te,{className:"w-4 h-4 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-red-300 mb-1",children:"Step Failed"}),e.jsx("div",{className:"text-xs text-red-200",children:n.error}),n.duration&&e.jsxs("div",{className:"text-xs text-red-400/60 mt-1",children:["Failed after ",n.duration,"ms"]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>u("up"),disabled:!h,className:"btn btn-icon btn-sm btn-ghost disabled:opacity-30",title:"Move up",children:e.jsx(Q,{className:"w-4 h-4 rotate-180"})}),e.jsx("button",{onClick:()=>u("down"),disabled:!x,className:"btn btn-icon btn-sm btn-ghost disabled:opacity-30",title:"Move down",children:e.jsx(Q,{className:"w-4 h-4"})})]}),e.jsxs("button",{onClick:l,className:"btn btn-sm btn-ghost text-red-400 hover:bg-red-400/10",children:[e.jsx(W,{className:"w-4 h-4"}),"Delete"]})]})]})]})}function jt(a,s){const r={id:crypto.randomUUID(),type:"ui",order:s,enabled:!0,continueOnFailure:!1,selectors:[]};switch(a){case"navigate":return{...r,name:"Navigate to URL",action:{type:"navigate",url:""},selectors:[]};case"click":return{...r,name:"Click element",action:{type:"click"},selectors:[{type:"css",value:"",priority:0,confidence:1}]};case"type":return{...r,name:"Type text",action:{type:"type",text:""},selectors:[{type:"css",value:"",priority:0,confidence:1}]};case"select":return{...r,name:"Select option",action:{type:"select",value:""},selectors:[{type:"css",value:"",priority:0,confidence:1}]};case"assert":return{...r,name:"Assert element visible",action:{type:"waitForElement"},selectors:[{type:"css",value:"",priority:0,confidence:1}],assertions:[{type:"visibility",expected:"visible"}]};case"wait":return{...r,name:"Wait",action:{type:"waitTime",duration:2e3},selectors:[]};default:return{...r,name:"New step",action:{type:"click"},selectors:[]}}}function vt({dataSets:a,onDataSetsChange:s,onGenerateWithAI:t}){const[r,n]=f.useState(0),[c,o]=f.useState(""),l=a.length>0?a:[{}],u=l[r]||{},h=Array.from(new Set(l.flatMap(p=>Object.keys(p)))),x=p=>{const v=[...l];v[r]={...u,...p},s(v)},d=()=>{c.trim()&&(x({[c.trim()]:""}),o(""))},g=p=>{const v=l.map(k=>{const N={...k};return delete N[p],N});s(v)},i=()=>{const p={};h.forEach(v=>p[v]=""),s([...l,p]),n(l.length)},m=()=>{const p={...u};s([...l,p]),n(l.length)},y=()=>{if(l.length<=1)return;const p=l.filter((v,k)=>k!==r);s(p),n(Math.min(r,p.length-1))},I=p=>{var N;const v=(N=p.target.files)==null?void 0:N[0];if(!v)return;const k=new FileReader;k.onload=L=>{var U;const M=(U=L.target)==null?void 0:U.result;try{const B=JSON.parse(M);Array.isArray(B)?s(B):s([B])}catch{const B=M.trim().split(`
`);if(B.length<2)return;const ae=B[0].split(",").map(w=>w.trim()),ne=B.slice(1).map(w=>{const E=w.split(",").map($=>$.trim()),S={};return ae.forEach(($,R)=>{S[$]=E[R]||""}),S});s(ne)}},k.readAsText(v)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-dark-300",children:"Test Data"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"btn btn-sm btn-ghost cursor-pointer",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Import",e.jsx("input",{type:"file",accept:".json,.csv",onChange:I,className:"hidden"})]}),t&&e.jsxs("button",{onClick:t,className:"btn btn-sm btn-ghost text-accent",children:[e.jsx(ve,{className:"w-4 h-4"}),"AI Generate"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-dark-850 rounded-lg px-3 py-2",children:[e.jsx("button",{onClick:()=>n(Math.max(0,r-1)),disabled:r===0,className:"btn btn-icon btn-sm btn-ghost disabled:opacity-30",children:e.jsx(We,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm text-dark-300",children:["Data Set ",r+1," of ",l.length]}),e.jsx("button",{onClick:()=>n(Math.min(l.length-1,r+1)),disabled:r===l.length-1,className:"btn btn-icon btn-sm btn-ghost disabled:opacity-30",children:e.jsx(oe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:i,className:"btn btn-sm btn-ghost flex-1",children:[e.jsx(X,{className:"w-4 h-4"}),"New Set"]}),e.jsxs("button",{onClick:m,className:"btn btn-sm btn-ghost flex-1",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Duplicate"]}),e.jsx("button",{onClick:y,disabled:l.length<=1,className:"btn btn-sm btn-ghost text-red-400 disabled:opacity-30",children:e.jsx(W,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-2",children:h.length===0?e.jsxs("div",{className:"text-center py-6 text-dark-500 border border-dashed border-dark-700 rounded-lg",children:[e.jsx("p",{className:"text-sm",children:"No variables defined"}),e.jsx("p",{className:"text-xs mt-1",children:"Add variables below to use in your test steps"})]}):h.map(p=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1/3",children:e.jsx("div",{className:"px-3 py-2 bg-dark-850 rounded-lg text-sm text-dark-300 font-mono",children:`{{${p}}}`})}),e.jsx("input",{type:"text",value:u[p]||"",onChange:v=>x({[p]:v.target.value}),placeholder:`Enter ${p}...`,className:"input flex-1"}),e.jsx("button",{onClick:()=>g(p),className:"btn btn-icon btn-sm btn-ghost text-dark-500 hover:text-red-400",children:e.jsx(W,{className:"w-4 h-4"})})]},p))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:c,onChange:p=>o(p.target.value),onKeyDown:p=>p.key==="Enter"&&d(),placeholder:"Variable name (e.g., email, password)",className:"input flex-1"}),e.jsxs("button",{onClick:d,className:"btn btn-sm btn-primary",children:[e.jsx(X,{className:"w-4 h-4"}),"Add"]})]}),e.jsx("div",{className:"bg-dark-850 rounded-lg px-3 py-2 text-xs text-dark-500",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Tip:"})," Use ",e.jsx("code",{className:"bg-dark-700 px-1 rounded",children:"{{variableName}}"})," in your test steps to substitute these values."]})})]})}class fe{constructor(){P(this,"client",null);P(this,"rateLimitDelay",0);P(this,"lastRequestTime",0);P(this,"minInterval",1e3);P(this,"cache",new Map);P(this,"cacheMaxAge",5*60*1e3)}async initialize(){try{const s=await G.get();if(!(s!=null&&s.openaiApiKey))throw new Error("OpenAI API key not configured. Please add it in Settings.");return this.client=new Ye({apiKey:s.openaiApiKey,dangerouslyAllowBrowser:!0}),!0}catch(s){throw console.error("Failed to initialize AIService:",s),s}}async generateTestData(s,t=3){var l,u;if(!this.client)throw new Error("AIService not initialized");let r=this.extractVariablesFromSteps(s);if(r.length===0&&(r=this.inferFieldsFromSteps(s),r.length===0))throw new Error(`Could not find variables in test steps.

Tips:
1. Use {{variableName}} in step text (e.g., "Type {{email}}")
2. Or add Type steps with selectors like #email, #password, etc.`);const n=s.map((h,x)=>{var g;const d=((g=h.selectors)==null?void 0:g.map(i=>i.value).join(" or "))||"no selector";return`${x+1}. ${h.name}: ${this.describeAction(h)} [selector: ${d}]`}).join(`
`),c="You are a test data generator for automated testing. Generate realistic, diverse test data based on variable names and test context. Consider field types, validation rules, and real-world user scenarios.",o=`Generate ${t} unique test data sets for these variables:

Variables needed: ${r.join(", ")}

Test context:
${n}

Requirements:
- Return ONLY a JSON array of objects
- Each object must have exactly these keys: ${r.join(", ")}
- Make data realistic and diverse (different email domains, name variations, valid formats)
- For emails: use real-looking domains (gmail.com, company.com, etc.)
- For passwords: include mix of letters, numbers, special chars
- For names: use diverse, realistic names
- For numbers: use appropriate formats (phone, zip, etc.)

Example format:
[{"variable1": "value1", "variable2": "value2"}]`;try{const x=(u=(l=(await this.makeRequest(async()=>await this.client.chat.completions.create({model:"gpt-4o-mini",messages:[{role:"system",content:c},{role:"user",content:o}],temperature:.8,response_format:{type:"json_object"}}))).choices[0])==null?void 0:l.message)==null?void 0:u.content;if(!x)throw new Error("Empty response from AI");const d=JSON.parse(x);let g=Array.isArray(d)?d:d.data||d.dataSets||[];if(!Array.isArray(g)||g.length===0)throw new Error("AI returned invalid data format");return g.forEach((i,m)=>{r.forEach(y=>{if(!(y in i))throw new Error(`Missing variable "${y}" in data set ${m+1}`)})}),g.slice(0,t)}catch(h){throw this.handleError(h),h}}async analyzePageAndSuggestTests(s){var n,c;if(!this.client)throw new Error("AIService not initialized");const t="You are a QA test expert. Analyze web pages and suggest comprehensive test scenarios. Focus on critical user flows, edge cases, and validation tests.",r=`Analyze this page and suggest 5-10 important test steps to cover key functionality:

${s}

Requirements:
- Suggest practical, executable test steps
- Include form validation, navigation, and assertions
- Use actual selectors from the page
- Consider positive and negative test cases
- Return ONLY valid JSON

Format:
{"steps": [{"name": "Step name", "type": "click|type|navigate|waitForElement", "selector": "CSS selector", "text": "text to type (if type action)", "description": "Why this test is important"}]}`;try{const l=(c=(n=(await this.makeRequest(async()=>await this.client.chat.completions.create({model:"gpt-4o-mini",messages:[{role:"system",content:t},{role:"user",content:r}],temperature:.7,response_format:{type:"json_object"}}))).choices[0])==null?void 0:n.message)==null?void 0:c.content;if(!l)throw new Error("Empty response from AI");const h=JSON.parse(l).steps||[];if(!Array.isArray(h))throw new Error("AI returned invalid format");return h.map((d,g)=>({id:crypto.randomUUID(),type:"ui",order:g,name:d.name||"AI Suggested Step",description:d.description,enabled:!0,continueOnFailure:!1,action:this.createActionFromSuggestion(d),selectors:d.selector?[{type:"css",value:d.selector,priority:0,confidence:.75}]:[]}))}catch(o){throw this.handleError(o),o}}async suggestSelectors(s,t,r="not-found"){var h,x;if(!this.client)throw new Error("AIService not initialized");const n=`selectors:${this.hashString(t+s.html+r)}`,c=this.getFromCache(n);if(c)return c;const o=r==="not-found"?"0 elements found - selector does not match any element":"Multiple elements found - selector is not unique",l="You are a CSS selector expert. Analyze DOM context and suggest robust, maintainable selectors. Prefer data-testid, ARIA labels, semantic HTML, and stable IDs over brittle class names or complex XPath.",u=`Current selector: ${t}
Issue: ${o}

Page: ${s.metadata.title} (${s.metadata.url})

Simplified DOM:
${this.optimizeDOMSnapshot(s.html)}

Suggest 3-5 alternative selectors ordered by robustness.

Requirements:
- Return ONLY valid JSON
- Prefer: data-testid > ARIA > semantic HTML > stable IDs > classes
- Avoid: auto-generated IDs, CSS framework classes (Tailwind, MUI), nth-child when possible
- Each suggestion needs: type, value, confidence (0-1), explanation

Format:
{"suggestions": [{"type": "css", "value": "[data-testid='btn']", "confidence": 0.95, "explanation": "Uses stable test ID"}]}`;try{const g=(x=(h=(await this.makeRequest(async()=>await this.client.chat.completions.create({model:"gpt-4o-mini",messages:[{role:"system",content:l},{role:"user",content:u}],temperature:.3,response_format:{type:"json_object"}}))).choices[0])==null?void 0:h.message)==null?void 0:x.content;if(!g)throw new Error("Empty response from AI");const m=JSON.parse(g).suggestions||[];if(!Array.isArray(m))throw new Error("AI returned invalid suggestions format");const y=m.map((I,p)=>({type:I.type||"css",value:I.value,priority:p,confidence:I.confidence||.5,explanation:I.explanation}));return this.setInCache(n,y),y}catch(d){throw this.handleError(d),d}}async suggestNextStep(s,t){var o,l;if(!this.client)throw new Error("AIService not initialized");const r=s.map((u,h)=>`${h+1}. ${u.name}`).join(`
`),n="You are a QA automation expert. Analyze test context and page state to suggest logical next test steps. Consider common user flows, form validation, and typical test scenarios.",c=`Current test steps:
${r}

Current page:
- URL: ${t.url}
- Title: ${t.title}
- Forms: ${t.forms.length} form(s) ${t.forms.map(u=>`with ${u.fields.length} fields`).join(", ")}
- Buttons: ${t.buttons.map(u=>u.text).join(", ")}
- Links: ${t.links.slice(0,5).map(u=>u.text).join(", ")}
- Filled fields: ${Object.keys(t.currentFormState).join(", ")||"none"}

Suggest the most logical next test step.

Requirements:
- Return ONLY valid JSON
- Consider common flows (login, form fill, navigation, assertions)
- Include: type, name, selector, reasoning
- Type must be one of: click, type, navigate, waitTime, waitForElement

Format:
{"step": {"type": "click", "name": "Click submit button", "selector": "button[type='submit']", "reasoning": "Form filled, next is submission"}}`;try{const h=(l=(o=(await this.makeRequest(async()=>await this.client.chat.completions.create({model:"gpt-4o-mini",messages:[{role:"system",content:n},{role:"user",content:c}],temperature:.5,response_format:{type:"json_object"}}))).choices[0])==null?void 0:o.message)==null?void 0:l.content;if(!h)return null;const d=JSON.parse(h).step;return!d||!d.type||!d.selector?null:{id:crypto.randomUUID(),type:"ui",order:s.length,name:d.name||"AI Suggested Step",enabled:!0,continueOnFailure:!1,action:this.createAction(d.type,d),selectors:[{type:"css",value:d.selector,priority:0,confidence:.8}]}}catch(u){return this.handleError(u),null}}async healSelector(s,t,r,n){var l,u;if(!this.client)throw new Error("AIService not initialized");const c="You are a selector repair expert. A test selector failed to find an element. Analyze the DOM to find the element the user likely intended and suggest updated selectors.",o=`Failed selector: ${s}
Error: ${r}
Step context: ${n||"Unknown step"}

Current DOM snapshot:
${this.optimizeDOMSnapshot(t)}

Find the most likely target element and suggest 3-5 alternative selectors.
Consider: renamed classes, moved elements, similar elements nearby, updated IDs.

Requirements:
- Return ONLY valid JSON
- Include confidence (0-1) for overall healing success
- Include explanation of what changed
- Suggest robust selectors

Format:
{"suggestedSelectors": [{"type": "css", "value": ".new-class", "confidence": 0.9}], "confidence": 0.88, "explanation": "Button class changed from .old to .new"}`;try{const x=(u=(l=(await this.makeRequest(async()=>await this.client.chat.completions.create({model:"gpt-4o",messages:[{role:"system",content:c},{role:"user",content:o}],temperature:.3,response_format:{type:"json_object"}}))).choices[0])==null?void 0:l.message)==null?void 0:u.content;if(!x)throw new Error("Empty response from AI");const d=JSON.parse(x),g=(d.suggestedSelectors||[]).map((i,m)=>({type:i.type||"css",value:i.value,priority:m,confidence:i.confidence||.5}));return{originalSelector:{type:"css",value:s,priority:0,confidence:0},suggestedSelectors:g,confidence:d.confidence||.5,aiExplanation:d.explanation}}catch(h){throw this.handleError(h),h}}extractVariablesFromSteps(s){const t=new Set;return s.forEach(r=>{const n=r.action;["url","text","value"].forEach(c=>{if(typeof n[c]=="string"){const o=n[c].match(/\{\{(\w+)\}\}/g);o&&o.forEach(l=>{const u=l.replace(/[{}]/g,"");t.add(u)})}})}),Array.from(t)}inferFieldsFromSteps(s){const t=new Set;return s.forEach(r=>{if(r.action.type==="type"&&r.selectors&&r.selectors.length>0){const c=r.selectors[0].value,o=[/id="?(\w+)"?/i,/name="?(\w+)"?/i,/#(\w+)/,/\[name=["']?(\w+)["']?\]/,/\[id=["']?(\w+)["']?\]/,/\[placeholder=["']?([^"']+)["']?\]/i];for(const l of o){const u=c.match(l);if(u&&u[1]){const h=u[1].toLowerCase();if(h.includes("email")||h.includes("user")||h.includes("password")||h.includes("name")||h.includes("phone")||h.includes("address")||h.includes("city")||h.includes("zip")||h.includes("state")){t.add(h);break}}}if(t.size===0){const l=r.name.toLowerCase();l.includes("email")&&t.add("email"),l.includes("password")&&t.add("password"),(l.includes("username")||l.includes("user"))&&t.add("username"),l.includes("name")&&t.add("name")}}}),Array.from(t)}describeAction(s){const t=s.action;switch(t.type){case"type":return`Type "${t.text}" into element`;case"click":return"Click element";case"navigate":return`Navigate to ${t.url}`;case"select":return`Select option "${t.value}"`;case"waitTime":return`Wait ${t.duration}ms`;case"waitForElement":return"Wait for element to appear";default:return t.type}}createAction(s,t){switch(s){case"click":return{type:"click"};case"type":return{type:"type",text:t.text||""};case"navigate":return{type:"navigate",url:t.url||""};case"waitTime":return{type:"waitTime",duration:t.duration||2e3};case"waitForElement":return{type:"waitForElement"};default:return{type:"click"}}}createActionFromSuggestion(s){switch(s.type||"click"){case"type":return{type:"type",text:s.text||""};case"click":return{type:"click"};case"navigate":return{type:"navigate",url:s.url||""};case"waitForElement":return{type:"waitForElement"};case"waitTime":return{type:"waitTime",duration:s.duration||2e3};default:return{type:"click"}}}optimizeDOMSnapshot(s){if(!s)return"";let t=s;return t=t.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,""),t=t.replace(/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi,""),t=t.replace(/<!--[\s\S]*?-->/g,""),t=t.replace(/data:[^"'\s>]+/g,"data:..."),t=t.replace(/>([^<]{100})[^<]*</g,">$1...</"),t=t.replace(/\s+/g," "),t.length>8e3&&(t=t.substring(0,8e3)+`
...[truncated]`),t}async makeRequest(s){var n;const r=Date.now()-this.lastRequestTime;if(r<this.minInterval+this.rateLimitDelay){const c=this.minInterval+this.rateLimitDelay-r;await new Promise(o=>setTimeout(o,c))}this.lastRequestTime=Date.now();try{const c=await s();return this.rateLimitDelay=0,c}catch(c){if((c==null?void 0:c.status)===429){const o=(n=c==null?void 0:c.headers)==null?void 0:n["retry-after"];throw this.rateLimitDelay=o?parseInt(o)*1e3:5e3,new Error(`AI rate limited. Please try again in ${this.rateLimitDelay/1e3}s`)}throw c}}handleError(s){var t;if(console.error("AIService error:",s),(s==null?void 0:s.status)===401)throw new Error("Invalid OpenAI API key. Please update in Settings.");if((s==null?void 0:s.status)===429)throw new Error("AI rate limit exceeded. Please wait before trying again.");if((t=s==null?void 0:s.message)!=null&&t.includes("network")||(s==null?void 0:s.code)==="ECONNREFUSED")throw new Error("Cannot reach OpenAI API. Check your internet connection.")}getFromCache(s){const t=this.cache.get(s);return t?Date.now()-t.timestamp>this.cacheMaxAge?(this.cache.delete(s),null):t.data:null}setInCache(s,t){if(this.cache.set(s,{data:t,timestamp:Date.now()}),this.cache.size>100){const r=this.cache.keys().next().value;r&&this.cache.delete(r)}}hashString(s){let t=0;for(let r=0;r<s.length;r++){const n=s.charCodeAt(r);t=(t<<5)-t+n,t=t&t}return t.toString(36)}}class Nt{static async generateReport(s){const t=new _e,r=t.internal.pageSize.getWidth(),n=t.internal.pageSize.getHeight(),c=s.test.steps.length,o=s.dataSets.length,l=s.results.filter(p=>p.status==="passed").length,u=s.results.filter(p=>p.status==="failed").length,h=s.completedAt-s.startedAt,x=u===0?"PASSED":"FAILED";t.setFillColor(37,99,235),t.rect(0,0,r,40,"F"),t.setTextColor(255,255,255),t.setFontSize(24),t.setFont("helvetica","bold"),t.text("QAerx Test Report",20,25);let d=55;t.setTextColor(0,0,0),t.setFontSize(18),t.setFont("helvetica","bold"),t.text("Test Information",20,d),d+=10,t.setFontSize(11),t.setFont("helvetica","normal"),[["Test Name:",s.test.name],["URL:",s.test.url||"N/A"],["Executed At:",new Date(s.startedAt).toLocaleString()],["Duration:",this.formatDuration(h)],["Status:",x]].forEach(([p,v])=>{t.setFont("helvetica","bold"),t.text(p,20,d),t.setFont("helvetica","normal"),t.text(v,60,d),d+=7}),d+=10,t.setFontSize(18),t.setFont("helvetica","bold"),t.text("Summary",20,d),d+=10,H(t,{startY:d,head:[["Metric","Value"]],body:[["Total Steps",c.toString()],["Total Data Sets",o.toString()],["Passed Steps",l.toString()],["Failed Steps",u.toString()],["Success Rate",`${(l/(l+u)*100).toFixed(1)}%`]],theme:"grid",headStyles:{fillColor:[37,99,235],textColor:[255,255,255],fontStyle:"bold"},alternateRowStyles:{fillColor:[249,250,251]}}),d=t.lastAutoTable.finalY+20,d>n-60&&(t.addPage(),d=20),t.setFontSize(18),t.setFont("helvetica","bold"),t.text("Test Steps",20,d),d+=10;const i=s.test.steps.filter(p=>p.type==="ui").map((p,v)=>{const k=s.results.filter(M=>M.stepId===p.id),N=k.filter(M=>M.status==="passed").length,L=k.length>0?k.reduce((M,U)=>M+(U.duration||0),0)/k.length:0;return[(v+1).toString(),p.name,this.getActionDescription(p),`${N}/${k.length}`,this.formatDuration(L)]});if(H(t,{startY:d,head:[["#","Step Name","Action","Pass Rate","Avg Duration"]],body:i,theme:"grid",headStyles:{fillColor:[37,99,235],textColor:[255,255,255],fontStyle:"bold"},alternateRowStyles:{fillColor:[249,250,251]},columnStyles:{0:{cellWidth:10},1:{cellWidth:60},2:{cellWidth:50},3:{cellWidth:25},4:{cellWidth:30}}}),o>1){d=t.lastAutoTable.finalY+20,d>n-60&&(t.addPage(),d=20),t.setFontSize(18),t.setFont("helvetica","bold"),t.text("Data Sets",20,d),d+=10;const p=["Set #",...Object.keys(s.dataSets[0]||{})],v=s.dataSets.map((k,N)=>[(N+1).toString(),...Object.values(k)]);H(t,{startY:d,head:[p],body:v,theme:"grid",headStyles:{fillColor:[37,99,235],textColor:[255,255,255],fontStyle:"bold"},alternateRowStyles:{fillColor:[249,250,251]}})}const m=s.results.filter(p=>p.status==="failed");if(m.length>0){d=t.lastAutoTable.finalY+20,d>n-60&&(t.addPage(),d=20),t.setFontSize(18),t.setFont("helvetica","bold"),t.setTextColor(220,38,38),t.text("Failed Steps",20,d),d+=10;const p=m.map(v=>{const k=s.test.steps.find(L=>L.id===v.stepId),N=v.dataSetIndex+1;return[(k==null?void 0:k.name)||"Unknown",`Data Set ${N}`,v.error||"Unknown error"]});t.setTextColor(0,0,0),H(t,{startY:d,head:[["Step","Data Set","Error"]],body:p,theme:"grid",headStyles:{fillColor:[220,38,38],textColor:[255,255,255],fontStyle:"bold"},alternateRowStyles:{fillColor:[254,242,242]},columnStyles:{0:{cellWidth:60},1:{cellWidth:30},2:{cellWidth:85}}})}const y=t.internal.pages.length-1;for(let p=1;p<=y;p++)t.setPage(p),t.setFontSize(9),t.setTextColor(128,128,128),t.text(`Generated by QAerx  Page ${p} of ${y}`,r/2,n-10,{align:"center"});const I=`${s.test.name.replace(/[^a-z0-9]/gi,"_")}_${new Date().toISOString().split("T")[0]}.pdf`;t.save(I)}static getActionDescription(s){const t=s.action;switch(t.type){case"click":return"Click element";case"type":return"Type text";case"navigate":return`Navigate to ${t.url}`;case"select":return"Select option";case"waitTime":return`Wait ${t.duration}ms`;case"waitForElement":return"Wait for element";default:return t.type}}static formatDuration(s){if(s<1e3)return`${Math.round(s)}ms`;const t=s/1e3;if(t<60)return`${t.toFixed(1)}s`;const r=Math.floor(t/60),n=t%60;return`${r}m ${n.toFixed(0)}s`}}function St({testId:a,onBack:s}){const[t,r]=f.useState(null),[n,c]=f.useState([]),[o,l]=f.useState([{}]),[u,h]=f.useState(!1),[x,d]=f.useState("steps"),[g,i]=f.useState(!1),[m,y]=f.useState(null),[I,p]=f.useState(!1);f.useEffect(()=>{z.getById(a).then(w=>{var E,S;w&&(r(w),c(w.steps),l(((E=w.dataSource)==null?void 0:E.data)||[{}]),h(((S=w.dataSource)==null?void 0:S.type)==="ai-generated"))})},[a]);const v=w=>{c(w),p(!0)},k=w=>{l(w),h(!1),p(!0)},N=async()=>{try{if(n.length===0){b.error("Add test steps first before generating data");return}const w=b.loading("Generating test data with AI..."),E=new fe;await E.initialize();const S=o.length>0?o.length:3,$=await E.generateTestData(n,S);l($),h(!0),p(!0),b.dismiss(w),b.success(`Generated ${$.length} data sets with AI `)}catch(w){console.error("AI generation error:",w),b.error(w.message||"Failed to generate data with AI")}},L=async()=>{try{const w=b.loading("Analyzing page with AI..."),[E]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!E.id)throw new Error("No active tab found");try{await chrome.tabs.sendMessage(E.id,{type:"ping"})}catch{await chrome.scripting.executeScript({target:{tabId:E.id},files:["content.js"]}),await new Promise(q=>setTimeout(q,500))}const S=await chrome.tabs.sendMessage(E.id,{type:"analyzer:getPageContext"}),$=new fe;await $.initialize();const R=await $.analyzePageAndSuggestTests(S.context);c(q=>[...q,...R]),p(!0),b.dismiss(w),b.success(`AI suggested ${R.length} test steps `)}catch(w){console.error("AI analysis error:",w),b.error(w.message||"Failed to analyze page with AI")}},M=async()=>{if(!(!t||!m))try{const w=b.loading("Generating PDF report...");await Nt.generateReport({test:t,dataSets:o,results:m.results,startedAt:Date.now()-m.results.reduce((E,S)=>E+(S.duration||0),0),completedAt:Date.now()}),b.dismiss(w),b.success("PDF report downloaded ")}catch(w){console.error("PDF generation error:",w),b.error(w.message||"Failed to generate PDF report")}},U=async()=>{if(t)try{await z.update(a,{steps:n,dataSource:{type:u?"ai-generated":"manual",data:o}}),p(!1),b.success("Test saved")}catch{b.error("Failed to save test")}},B=async()=>{var w,E;if(n.length===0){b.error("Add at least one step before running");return}i(!0),y({currentStep:0,total:n.length,currentDataSet:0,totalDataSets:o.length,currentStepId:null,results:[]});try{const[S]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(S!=null&&S.id))throw new Error("No active tab found");const $=async()=>{try{await chrome.tabs.sendMessage(S.id,{type:"ping"})}catch{await chrome.scripting.executeScript({target:{tabId:S.id},files:["content.js"]}),await new Promise(R=>setTimeout(R,300))}};for(let R=0;R<o.length;R++){const q=o[R];if(y(F=>F&&{...F,currentDataSet:R}),t!=null&&t.url&&t.url!=="https://"){let F=t.url;Object.entries(q).forEach(([C,D])=>{F=F.replace(new RegExp(`\\{\\{${C}\\}\\}`,"g"),D)}),await chrome.tabs.update(S.id,{url:F}),await new Promise(C=>setTimeout(C,2500)),await $()}const me=F=>{F.type==="playback:step-start"&&y(C=>C?{...C,currentStepId:F.stepId,currentStep:F.index}:null)};chrome.runtime.onMessage.addListener(me);try{let F=[];for(let C=0;C<n.length;C++){const D=n[C];if(D.action.type==="navigate"||D.action.type==="waitTime"){if(F.length>0){try{const A=await chrome.tabs.sendMessage(S.id,{type:"playback:execute",steps:F,variables:q,timeout:3e4});(w=A==null?void 0:A.result)!=null&&w.stepResults&&A.result.stepResults.forEach(V=>{y(O=>O?{...O,results:[...O.results,{dataSetIndex:R,...V}]}:null)})}catch(A){throw console.error("Error executing steps before navigation:",A),new Error(`Step execution failed: ${A instanceof Error?A.message:String(A)}`)}F=[]}y(A=>A?{...A,currentStepId:D.id,currentStep:C}:null);try{const A=Date.now();if(D.action.type==="navigate"){let Y=D.action.url;Object.entries(q).forEach(([J,K])=>{Y=Y.replace(new RegExp(`\\{\\{${J}\\}\\}`,"g"),K)}),await chrome.tabs.update(S.id,{url:Y}),await new Promise(J=>{let K=!1;const ke=setTimeout(()=>{K||(K=!0,J())},8e3),re=(Ae,Ie)=>{Ae===S.id&&Ie.status==="complete"&&!K&&(K=!0,clearTimeout(ke),chrome.tabs.onUpdated.removeListener(re),setTimeout(()=>J(),500))};chrome.tabs.onUpdated.addListener(re),setTimeout(()=>{chrome.tabs.onUpdated.removeListener(re)},8500)}),await $()}else if(D.action.type==="waitTime"){const O=D.action;await new Promise(Y=>setTimeout(Y,O.duration))}const V=Date.now()-A;y(O=>O?{...O,currentStepId:null,results:[...O.results,{dataSetIndex:R,stepId:D.id,status:"passed",duration:V}]}:null)}catch(A){throw y(V=>V?{...V,currentStepId:null,results:[...V.results,{dataSetIndex:R,stepId:D.id,status:"failed",error:`${D.action.type==="navigate"?"Navigation":"Wait"} failed: ${A instanceof Error?A.message:String(A)}`,duration:0}]}:null),A}}else F.push(D)}if(F.length>0)try{const C=await chrome.tabs.sendMessage(S.id,{type:"playback:execute",steps:F,variables:q,timeout:3e4});(E=C==null?void 0:C.result)!=null&&E.stepResults&&C.result.stepResults.forEach(D=>{y(A=>A?{...A,results:[...A.results,{dataSetIndex:R,...D}]}:null)})}catch(C){throw console.error("Error executing remaining steps:",C),new Error(`Step execution failed: ${C instanceof Error?C.message:String(C)}`)}}finally{chrome.runtime.onMessage.removeListener(me)}}b.success("Test completed!")}catch(S){console.error("Test execution error:",S),b.error("Test execution failed: "+(S instanceof Error?S.message:"Unknown error"))}finally{i(!1)}};if(!t)return e.jsx("div",{className:"flex items-center justify-center h-full text-dark-500",children:e.jsx(ee,{className:"w-6 h-6 animate-spin"})});const ae=(m==null?void 0:m.results.filter(w=>w.status==="passed").length)||0,ne=(m==null?void 0:m.results.filter(w=>w.status==="failed").length)||0;return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 border-b border-dark-800",children:[e.jsx("button",{onClick:s,className:"btn btn-icon btn-sm btn-ghost",children:e.jsx(Ge,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-lg font-medium text-dark-100 truncate",children:t.name}),e.jsx("p",{className:"text-xs text-dark-500 truncate",children:t.url})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[x==="steps"&&!g&&e.jsxs("button",{onClick:L,className:"btn btn-sm btn-ghost text-purple-400 hover:bg-purple-400/10",title:"AI analyze page and suggest test steps",children:[e.jsx(ve,{className:"w-4 h-4"}),"AI Analyze"]}),m&&!g&&e.jsxs("button",{onClick:M,className:"btn btn-sm btn-ghost text-blue-400 hover:bg-blue-400/10",title:"Download PDF test report",children:[e.jsx(Je,{className:"w-4 h-4"}),"Report"]}),I&&e.jsxs("button",{onClick:U,className:"btn btn-sm btn-ghost",children:[e.jsx(He,{className:"w-4 h-4"}),"Save"]}),e.jsx("button",{onClick:B,disabled:g,className:"btn btn-sm btn-primary",children:g?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4 animate-spin"}),"Running..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4"}),"Run Test"]})})]})]}),m&&e.jsxs("div",{className:"px-4 py-2 bg-dark-850 border-b border-dark-800",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-dark-400 mb-1",children:[e.jsxs("span",{children:["Data Set ",m.currentDataSet+1,"/",m.totalDataSets]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"flex items-center gap-1 text-green-400",children:[e.jsx(se,{className:"w-3 h-3"})," ",ae]}),e.jsxs("span",{className:"flex items-center gap-1 text-red-400",children:[e.jsx(te,{className:"w-3 h-3"})," ",ne]})]})]}),e.jsx("div",{className:"h-1 bg-dark-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-accent transition-all",style:{width:`${(m.currentDataSet*n.length+m.results.length)/(m.totalDataSets*n.length)*100}%`}})})]}),e.jsxs("div",{className:"flex border-b border-dark-800",children:[e.jsxs("button",{onClick:()=>d("steps"),className:T("flex-1 flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium transition-colors",x==="steps"?"text-accent border-b-2 border-accent":"text-dark-400 hover:text-dark-200"),children:[e.jsx(Qe,{className:"w-4 h-4"}),"Steps (",n.length,")"]}),e.jsxs("button",{onClick:()=>d("data"),className:T("flex-1 flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium transition-colors",x==="data"?"text-accent border-b-2 border-accent":"text-dark-400 hover:text-dark-200"),children:[e.jsx(Xe,{className:"w-4 h-4"}),"Data (",o.length," sets)"]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:x==="steps"?e.jsx(bt,{steps:n,onStepsChange:v,currentStepId:m==null?void 0:m.currentStepId,stepResults:m==null?void 0:m.results}):e.jsx(vt,{dataSets:o,onDataSetsChange:k,onGenerateWithAI:N})})]})}const kt={passed:se,failed:te,running:ue,error:Z,stopped:Z},At={passed:"text-status-pass",failed:"text-status-fail",running:"text-status-running",error:"text-status-fail",stopped:"text-status-pending"};function It(){const[a,s]=f.useState([]),[t,r]=f.useState(!0);return f.useEffect(()=>{ut.getRecent(50).then(n=>{s(n),r(!1)})},[]),t?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin w-6 h-6 border-2 border-accent border-t-transparent rounded-full"})}):a.length===0?e.jsxs("div",{className:"text-center py-12 text-dark-500",children:[e.jsx(ye,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No test results yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Run some tests to see results here"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-sm font-medium text-dark-400 uppercase tracking-wider",children:["Recent Results (",a.length,")"]}),e.jsx("div",{className:"space-y-2",children:a.map(n=>{const c=kt[n.status],o=At[n.status];return e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{className:T("w-5 h-5",o)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-dark-100",children:"Test Run"}),e.jsx("span",{className:T("text-xs px-2 py-0.5 rounded-full",o,"bg-current/10"),children:n.status})]}),e.jsx("div",{className:"text-xs text-dark-500 mt-1",children:new Date(n.startedAt).toLocaleString()})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{className:"text-dark-300",children:[n.summary.passedSteps,"/",n.summary.totalSteps," passed"]}),e.jsxs("div",{className:"text-xs text-dark-500",children:[(n.summary.duration/1e3).toFixed(1),"s"]})]})]}),n.summary.failedSteps>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-700",children:e.jsxs("div",{className:"text-xs text-status-fail",children:[n.summary.failedSteps," step",n.summary.failedSteps!==1?"s":""," failed"]})})]},n.id)})})]})}function Ct(){const{settings:a,refreshSettings:s}=Se(),[t,r]=f.useState(""),[n,c]=f.useState(!1),[o,l]=f.useState((a==null?void 0:a.parallelLimit)||2),u=async()=>{if(!t.trim()){b.error("Please enter an API key");return}try{await G.setOpenAIKey(t),await s(),r(""),b.success("API key saved")}catch{b.error("Failed to save API key")}},h=async()=>{if(confirm("Remove the OpenAI API key?"))try{await G.clearOpenAIKey(),await s(),b.success("API key removed")}catch{b.error("Failed to remove API key")}},x=async()=>{try{await G.setParallelLimit(o),await s(),b.success("Settings saved")}catch{b.error("Failed to save settings")}},d=async()=>{if(confirm("This will delete ALL data including tests, results, and settings. This cannot be undone. Continue?"))try{await j.delete(),await j.open(),window.location.reload()}catch{b.error("Failed to clear data")}};return e.jsxs("div",{className:"space-y-6 max-w-lg",children:[e.jsxs("section",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"font-medium text-dark-100 flex items-center gap-2",children:[e.jsx(Ze,{className:"w-4 h-4"}),"AI Integration"]})}),e.jsxs("div",{className:"card-body space-y-4",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Add your OpenAI API key to enable AI-powered test data generation and self-healing selectors."}),a!=null&&a.openaiApiKey?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 px-3 py-2 bg-dark-900 rounded-lg text-dark-400 text-sm",children:""}),e.jsx("button",{onClick:h,className:"btn btn-sm btn-ghost text-red-400",children:e.jsx(W,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:n?"text":"password",placeholder:"sk-...",value:t,onChange:g=>r(g.target.value),className:"input"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:u,className:"btn btn-sm btn-primary",children:"Save API Key"}),e.jsx("button",{onClick:()=>c(!n),className:"btn btn-sm btn-ghost",children:n?"Hide":"Show"})]})]})]})]}),e.jsxs("section",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"font-medium text-dark-100 flex items-center gap-2",children:[e.jsx(et,{className:"w-4 h-4"}),"Execution Settings"]})}),e.jsx("div",{className:"card-body space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-dark-400 mb-2",children:"Parallel Test Limit"}),e.jsx("p",{className:"text-xs text-dark-500 mb-2",children:"Maximum number of tests to run simultaneously"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"1",max:"10",value:o,onChange:g=>l(parseInt(g.target.value)||1),className:"input w-20"}),e.jsx("button",{onClick:x,className:"btn btn-sm btn-secondary",children:"Save"})]})]})})]}),e.jsxs("section",{className:"card border-red-900/50",children:[e.jsx("div",{className:"card-header border-red-900/50",children:e.jsx("h3",{className:"font-medium text-red-400",children:"Danger Zone"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("p",{className:"text-sm text-dark-400 mb-4",children:"Permanently delete all data including test suites, tests, and results."}),e.jsxs("button",{onClick:d,className:"btn btn-sm btn-danger",children:[e.jsx(W,{className:"w-4 h-4"}),"Clear All Data"]})]})]}),e.jsx("section",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex items-center gap-2 text-dark-400",children:[e.jsx(tt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"QAerx v0.1.0"})]}),e.jsx("p",{className:"text-xs text-dark-500 mt-2",children:"Automation testing with AI-powered test data generation"})]})})]})}function Tt({currentView:a,selectedSuiteId:s,selectedTestId:t,onSelectSuite:r,onSelectTest:n}){return a==="tests"&&t?e.jsx("main",{className:"flex-1 overflow-hidden",children:e.jsx(St,{testId:t,onBack:()=>n(null)})}):e.jsxs("main",{className:"flex-1 overflow-auto p-4",children:[a==="suites"&&e.jsx(pt,{selectedSuiteId:s,onSelectSuite:r}),a==="tests"&&e.jsx(ht,{suiteId:s,selectedTestId:t,onSelectTest:n}),a==="results"&&e.jsx(It,{}),a==="settings"&&e.jsx(Ct,{})]})}function Et(){const[a,s]=f.useState("suites"),[t,r]=f.useState(null),[n,c]=f.useState(null);return e.jsxs(mt,{children:[e.jsxs("div",{className:"flex h-screen bg-dark-900",children:[e.jsx(it,{currentView:a,onViewChange:s}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(lt,{currentView:a,selectedSuiteId:t,selectedTestId:n}),e.jsx(Tt,{currentView:a,selectedSuiteId:t,selectedTestId:n,onSelectSuite:r,onSelectTest:c})]})]}),e.jsx(st,{position:"bottom-right",toastOptions:{className:"bg-dark-800 text-dark-100 border border-dark-600",duration:3e3}})]})}at.createRoot(document.getElementById("root")).render(e.jsx(nt.StrictMode,{children:e.jsx(Et,{})}));
