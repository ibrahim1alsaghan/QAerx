var je=Object.defineProperty;var we=(t,n,a)=>n in t?je(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a;var V=(t,n,a)=>we(t,typeof n!="symbol"?n+"":n,a);import"./chunks/modulepreload-polyfill.B5Qt9EMX.js";import{j as e,Z as Ne,F as ve,P as te,H as ue,S as ke,c as T,r as d,z as f,a as Se,C as Ce,D as Ae,v as se,b as Te,d as ce,e as ae,T as K,f as le,g as Z,G as Ie,E as ne,h as Re,i as Ee,k as Q,l as _,m as Y,L as J,n as De,X as Pe,N as me,M as re,o as xe,p as he,q as ie,s as Me,t as X,U as Le,u as Fe,w as Be,x as Ve,A as Ke,y as Ue,B as Oe,I as qe,K as $e,J as We,O as He,Q as Ge,R as Qe,V as ze}from"./chunks/client.FxHGQBs3.js";const Ze=[{id:"suites",icon:ve,label:"Suites"},{id:"tests",icon:te,label:"Tests"},{id:"results",icon:ue,label:"Results"},{id:"settings",icon:ke,label:"Settings"}];function _e({currentView:t,onViewChange:n}){return e.jsxs("aside",{className:"w-16 bg-dark-950 border-r border-dark-800 flex flex-col items-center py-4",children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"w-10 h-10 bg-accent rounded-xl flex items-center justify-center",children:e.jsx(Ne,{className:"w-6 h-6 text-white"})})}),e.jsx("nav",{className:"flex-1 flex flex-col gap-2",children:Ze.map(a=>{const i=a.icon,s=t===a.id;return e.jsx("button",{onClick:()=>n(a.id),className:T("w-10 h-10 rounded-lg flex items-center justify-center transition-colors",s?"bg-accent text-white":"text-dark-400 hover:text-dark-100 hover:bg-dark-800"),title:a.label,children:e.jsx(i,{className:"w-5 h-5"})},a.id)})}),e.jsx("div",{className:"mt-auto pt-4 text-[10px] text-dark-600",children:"v0.1"})]})}function Je(){const[t,n]=d.useState({isRecording:!1,isPaused:!1,steps:[],sessionId:null});d.useEffect(()=>{const l=o=>{switch(o.type){case"recording:state-changed":break;case"recording:step-added":o.step&&n(u=>({...u,steps:[...u.steps,o.step]}));break;case"recording:completed":n(u=>({...u,isRecording:!1,steps:o.steps||u.steps}));break;case"recording:paused":n(u=>({...u,isPaused:!0}));break;case"recording:resumed":n(u=>({...u,isPaused:!1}));break}};return chrome.runtime.onMessage.addListener(l),()=>chrome.runtime.onMessage.removeListener(l)},[]);const a=d.useCallback(async()=>{try{const l=await chrome.runtime.sendMessage({type:"command:start-recording"});l.success?(n({isRecording:!0,isPaused:!1,steps:[],sessionId:crypto.randomUUID()}),f.success("Recording started")):f.error(l.error||"Failed to start recording")}catch(l){console.error("Failed to start recording:",l),f.error("Failed to start recording. Make sure you are on a web page.")}},[]),i=d.useCallback(async()=>{var l;try{const o=await chrome.runtime.sendMessage({type:"command:stop-recording"});return o.success?(n(u=>({...u,isRecording:!1,steps:o.steps||u.steps})),f.success(`Recording stopped. ${((l=o.steps)==null?void 0:l.length)||0} steps captured.`),o.steps||[]):(f.error(o.error||"Failed to stop recording"),[])}catch(o){return console.error("Failed to stop recording:",o),f.error("Failed to stop recording"),[]}},[]),s=d.useCallback(async()=>{await chrome.runtime.sendMessage({type:"command:pause-recording"}),n(l=>({...l,isPaused:!0}))},[]),c=d.useCallback(async()=>{await chrome.runtime.sendMessage({type:"command:resume-recording"}),n(l=>({...l,isPaused:!1}))},[]);return{...t,startRecording:a,stopRecording:i,pauseRecording:s,resumeRecording:c}}const Xe={suites:"Test Suites",tests:"Tests",results:"Results",settings:"Settings"};function Ye({currentView:t}){const{isRecording:n,startRecording:a,stopRecording:i}=Je();return e.jsxs("header",{className:"h-14 bg-dark-850 border-b border-dark-800 px-4 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("h1",{className:"text-lg font-semibold text-dark-100",children:Xe[t]})}),e.jsx("div",{className:"flex items-center gap-2",children:n?e.jsxs("button",{onClick:i,className:"btn btn-sm bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(Se,{className:"w-3 h-3 fill-current"}),"Stop Recording"]}):e.jsxs("button",{onClick:a,className:"btn btn-sm btn-primary",children:[e.jsx(Ce,{className:T("w-3 h-3",n&&"fill-current animate-pulse")}),"Record"]})})]})}class et extends Ae{constructor(){super("QAerxDB");V(this,"suites");V(this,"tests");V(this,"testRuns");V(this,"credentials");V(this,"screenshots");V(this,"settings");this.version(1).stores({suites:"id, parentId, name, updatedAt",tests:"id, suiteId, name, updatedAt, [suiteId+order]",testRuns:"id, testId, suiteId, status, startedAt, [testId+startedAt]",credentials:"id, name, domain",screenshots:"id, testRunId, stepId, timestamp, isBaseline, [testId+isBaseline]",settings:"id"}),this.version(2).stores({suites:"id, parentId, name, order, updatedAt",tests:"id, suiteId, name, updatedAt, [suiteId+order]",testRuns:"id, testId, suiteId, status, startedAt, [testId+startedAt]",credentials:"id, name, domain",screenshots:"id, testRunId, stepId, timestamp, isBaseline, [testId+isBaseline]",settings:"id"})}}const p=new et,$={async create(t){console.log("SuiteRepository.create called with:",t);const n=Date.now(),a={...t,id:se(),createdAt:n,updatedAt:n};return console.log("Creating suite:",a),console.log("Database instance:",p),await p.suites.add(a),console.log("Suite added successfully"),a},async getById(t){return p.suites.get(t)},async getAll(){return p.suites.orderBy("order").toArray()},async getByParent(t){return t===void 0?p.suites.filter(n=>!n.parentId).toArray():p.suites.where("parentId").equals(t).toArray()},async update(t,n){await p.suites.update(t,{...n,updatedAt:Date.now()})},async delete(t){await p.tests.where("suiteId").equals(t).delete();const n=await this.getByParent(t);for(const a of n)await this.delete(a.id);await p.suites.delete(t)},async getTree(){const t=await this.getAll(),n=await p.tests.toArray(),a=new Map;for(const s of n)a.set(s.suiteId,(a.get(s.suiteId)||0)+1);const i=s=>t.filter(c=>c.parentId===s).sort((c,l)=>c.order-l.order).map(c=>({...c,children:i(c.id),tests:a.get(c.id)||0}));return i(void 0)},async createDefault(){return this.create({name:"Default Suite",order:0,hooks:{}})}},L={async create(t){const n=Date.now(),a={...t,id:se(),createdAt:n,updatedAt:n};return await p.tests.add(a),a},async getById(t){return p.tests.get(t)},async getAll(){return p.tests.toArray()},async getBySuite(t){return p.tests.where("suiteId").equals(t).sortBy("order")},async update(t,n){await p.tests.update(t,{...n,updatedAt:Date.now()})},async delete(t){await p.testRuns.where("testId").equals(t).delete(),await p.tests.delete(t)},async addStep(t,n){const a=await this.getById(t);if(!a)throw new Error("Test not found");const i=[...a.steps,n];await this.update(t,{steps:i})},async updateStep(t,n,a){const i=await this.getById(t);if(!i)throw new Error("Test not found");const s=i.steps.map(c=>c.id===n?{...c,...a}:c);await this.update(t,{steps:s})},async deleteStep(t,n){const a=await this.getById(t);if(!a)throw new Error("Test not found");const s=a.steps.filter(c=>c.id!==n).map((c,l)=>({...c,order:l}));await this.update(t,{steps:s})},async reorderSteps(t,n){const a=await this.getById(t);if(!a)throw new Error("Test not found");const i=new Map(a.steps.map(c=>[c.id,c])),s=n.map((c,l)=>{const o=i.get(c);return o?{...o,order:l}:null}).filter(c=>c!==null);await this.update(t,{steps:s})},async createNew(t,n,a){const s=(await this.getBySuite(t)).length;return this.create({suiteId:t,name:n,url:a,order:s,steps:[]})}},tt={async create(t,n){const a={id:se(),testId:t,suiteId:n,startedAt:Date.now(),status:"running",environment:await this.getEnvironment(),stepResults:[],summary:{totalSteps:0,passedSteps:0,failedSteps:0,skippedSteps:0,duration:0}};return await p.testRuns.add(a),a},async getById(t){return p.testRuns.get(t)},async getByTest(t,n=10){return p.testRuns.where("testId").equals(t).reverse().sortBy("startedAt").then(a=>a.slice(0,n))},async getBySuite(t,n=50){return p.testRuns.where("suiteId").equals(t).reverse().sortBy("startedAt").then(a=>a.slice(0,n))},async getRecent(t=20){return p.testRuns.orderBy("startedAt").reverse().limit(t).toArray()},async update(t,n){await p.testRuns.update(t,n)},async addStepResult(t,n){const a=await this.getById(t);if(!a)throw new Error("Test run not found");const i=[...a.stepResults,n],s=this.calculateSummary(i,a.startedAt);await this.update(t,{stepResults:i,summary:s})},async complete(t,n){const a=await this.getById(t);if(!a)throw new Error("Test run not found");const i=Date.now(),s=this.calculateSummary(a.stepResults,a.startedAt,i);await this.update(t,{status:n,completedAt:i,summary:s})},async delete(t){await p.screenshots.where("testRunId").equals(t).delete(),await p.testRuns.delete(t)},async pruneOld(t=30){const n=Date.now()-t*24*60*60*1e3,a=await p.testRuns.where("startedAt").below(n).toArray();for(const i of a)await p.screenshots.where("testRunId").equals(i.id).delete();return p.testRuns.where("startedAt").below(n).delete()},calculateSummary(t,n,a){return{totalSteps:t.length,passedSteps:t.filter(i=>i.status==="passed").length,failedSteps:t.filter(i=>i.status==="failed").length,skippedSteps:t.filter(i=>i.status==="skipped").length,duration:(a||Date.now())-n}},async getEnvironment(){var t,n,a,i;return{browserVersion:((t=navigator.userAgent.match(/Chrome\/(\d+)/))==null?void 0:t[1])||"unknown",extensionVersion:((i=(a=(n=chrome.runtime)==null?void 0:n.getManifest)==null?void 0:a.call(n))==null?void 0:i.version)||"0.1.0",screenSize:{width:window.screen.width,height:window.screen.height},userAgent:navigator.userAgent}}},oe={id:"app-settings",parallelLimit:2,defaultTimeout:3e4,screenshotQuality:80,recordMouseMovements:!1,recordScrollEvents:!0,onboardingCompleted:!1,tutorialProgress:0,theme:"dark"},z={async get(){const t=await p.settings.get("app-settings");return t||(await p.settings.add(oe),oe)},async update(t){const a={...await this.get(),...t};return await p.settings.put(a),a},async setOpenAIKey(t){await this.update({openaiApiKey:t})},async clearOpenAIKey(){await this.update({openaiApiKey:void 0})},async setParallelLimit(t){await this.update({parallelLimit:Math.max(1,Math.min(t,10))})},async completeOnboarding(){await this.update({onboardingCompleted:!0})},async updateTutorialProgress(t){await this.update({tutorialProgress:t})},async setLastOpened(t,n){await this.update({lastOpenedSuiteId:t,lastOpenedTestId:n})}},pe=d.createContext(null);function st({children:t}){const[n,a]=d.useState([]),[i,s]=d.useState([]),[c,l]=d.useState(null),[o,u]=d.useState(!0),j=async()=>{const m=await $.getAll();a(m)},h=async m=>{const r=m?await L.getBySuite(m):await L.getAll();s(r)},S=async()=>{const m=await z.get();l(m)};return d.useEffect(()=>{(async()=>{try{console.log("AppContext init starting..."),u(!0),await Promise.all([j(),h(),S()]),console.log("Initial data loaded");const r=await $.getAll();console.log("All suites:",r),r.length===0&&(console.log("Creating default suite..."),await $.createDefault(),await j()),u(!1),console.log("AppContext init complete")}catch(r){console.error("AppContext init error:",r),u(!1)}})()},[]),e.jsx(pe.Provider,{value:{suites:n,tests:i,settings:c,isLoading:o,refreshSuites:j,refreshTests:h,refreshSettings:S},children:t})}function ge(){const t=d.useContext(pe);if(!t)throw new Error("useApp must be used within AppProvider");return t}function at({selectedSuiteId:t,onSelectSuite:n}){const{suites:a,refreshSuites:i}=ge(),[s,c]=d.useState(!1),[l,o]=d.useState(""),u=async()=>{if(l.trim())try{await $.create({name:l.trim(),order:a.length,hooks:{}}),await i(),o(""),c(!1),f.success("Suite created")}catch(h){console.error("Suite creation error:",h),f.error("Failed to create suite: "+(h instanceof Error?h.message:"Unknown error"))}},j=async h=>{if(confirm("Delete this suite and all its tests?"))try{await $.delete(h),await i(),t===h&&n(null),f.success("Suite deleted")}catch{f.error("Failed to delete suite")}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-sm font-medium text-dark-400 uppercase tracking-wider",children:["Suites (",a.length,")"]}),e.jsxs("button",{onClick:()=>c(!0),className:"btn btn-sm btn-ghost",children:[e.jsx(Te,{className:"w-4 h-4"}),"New Suite"]})]}),s&&e.jsxs("div",{className:"card p-3",children:[e.jsx("input",{type:"text",placeholder:"Suite name",value:l,onChange:h=>o(h.target.value),onKeyDown:h=>{h.key==="Enter"&&u(),h.key==="Escape"&&c(!1)},className:"input mb-2",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:u,className:"btn btn-sm btn-primary",children:"Create"}),e.jsx("button",{onClick:()=>c(!1),className:"btn btn-sm btn-ghost",children:"Cancel"})]})]}),e.jsxs("div",{className:"space-y-1",children:[a.map(h=>e.jsxs("div",{className:T("group flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer transition-colors",t===h.id?"bg-accent/20 text-accent":"hover:bg-dark-800 text-dark-200"),onClick:()=>n(h.id),children:[e.jsx(ce,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"flex-1 truncate",children:h.name}),e.jsx(ae,{className:"w-4 h-4 opacity-0 group-hover:opacity-100"}),e.jsx("button",{onClick:S=>{S.stopPropagation(),j(h.id)},className:"p-1 opacity-0 group-hover:opacity-100 hover:text-red-400",children:e.jsx(K,{className:"w-3 h-3"})})]},h.id)),a.length===0&&!s&&e.jsxs("div",{className:"text-center py-8 text-dark-500",children:[e.jsx(ce,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No test suites yet"}),e.jsx("button",{onClick:()=>c(!0),className:"btn btn-sm btn-primary mt-4",children:"Create your first suite"})]})]})]})}function nt({suiteId:t,selectedTestId:n,onSelectTest:a}){const[i,s]=d.useState([]),[c,l]=d.useState(!1),[o,u]=d.useState(""),[j,h]=d.useState("");d.useEffect(()=>{t?L.getBySuite(t).then(s):L.getAll().then(s)},[t]);const S=async()=>{if(!(!o.trim()||!t))try{await L.createNew(t,o.trim(),j||"https://");const r=await L.getBySuite(t);s(r),u(""),h(""),l(!1),f.success("Test created")}catch{f.error("Failed to create test")}},m=async r=>{if(confirm("Delete this test?"))try{if(await L.delete(r),t){const x=await L.getBySuite(t);s(x)}n===r&&a(null),f.success("Test deleted")}catch{f.error("Failed to delete test")}};return t?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-sm font-medium text-dark-400 uppercase tracking-wider",children:["Tests (",i.length,")"]}),e.jsxs("button",{onClick:()=>l(!0),className:"btn btn-sm btn-ghost",children:[e.jsx(Z,{className:"w-4 h-4"}),"New Test"]})]}),c&&e.jsxs("div",{className:"card p-3 space-y-2",children:[e.jsx("input",{type:"text",placeholder:"Test name",value:o,onChange:r=>u(r.target.value),className:"input",autoFocus:!0}),e.jsx("input",{type:"url",placeholder:"Starting URL (https://...)",value:j,onChange:r=>h(r.target.value),className:"input"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:S,className:"btn btn-sm btn-primary",children:"Create"}),e.jsx("button",{onClick:()=>l(!1),className:"btn btn-sm btn-ghost",children:"Cancel"})]})]}),e.jsxs("div",{className:"space-y-2",children:[i.map(r=>e.jsx("div",{className:T("card p-3 cursor-pointer transition-colors",n===r.id?"ring-2 ring-accent":"hover:bg-dark-750"),onClick:()=>a(r.id),children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-dark-100 truncate",children:r.name}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-dark-500 mt-1",children:[e.jsx(Ie,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:r.url})]}),e.jsxs("div",{className:"text-xs text-dark-500 mt-1",children:[r.steps.length," steps"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:x=>{x.stopPropagation(),f.success("Running test...")},className:"btn btn-icon btn-sm btn-ghost text-accent hover:bg-accent/20",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:x=>{x.stopPropagation(),m(r.id)},className:"btn btn-icon btn-sm btn-ghost text-dark-400 hover:text-red-400",children:e.jsx(K,{className:"w-4 h-4"})})]})]})},r.id)),i.length===0&&!c&&e.jsxs("div",{className:"text-center py-8 text-dark-500",children:[e.jsx(le,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No tests in this suite"}),e.jsx("button",{onClick:()=>l(!0),className:"btn btn-sm btn-primary mt-4",children:"Create your first test"})]})]})]}):e.jsxs("div",{className:"text-center py-12 text-dark-500",children:[e.jsx(le,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Select a suite to view tests"})]})}function rt(t,n){let a=null;const i=function(...s){const c=()=>{a=null,t.apply(this,s)};a&&clearTimeout(a),a=setTimeout(c,n)};return i.cancel=()=>{a&&(clearTimeout(a),a=null)},i}function it(t){const[n,a]=d.useState({isValid:!1,count:0,status:"validating",message:""});return d.useEffect(()=>{if(!t||t.trim()===""){a({isValid:!1,count:0,status:"invalid",message:"Enter a selector"});return}const i=rt(async()=>{var s;try{const[c]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(c!=null&&c.id)){a({isValid:!1,count:0,status:"error",message:"No active tab"});return}let l;try{l=await chrome.tabs.sendMessage(c.id,{type:"selector:validate",selector:t})}catch{try{await chrome.scripting.executeScript({target:{tabId:c.id},files:["content.js"]}),await new Promise(u=>setTimeout(u,300)),l=await chrome.tabs.sendMessage(c.id,{type:"selector:validate",selector:t})}catch{a({isValid:!1,count:0,status:"error",message:"Content script not available"});return}}if(!l){a({isValid:!1,count:0,status:"error",message:"Cannot validate"});return}l.count===0?a({isValid:!1,count:0,status:"invalid",message:"No elements found"}):l.count===1?a({isValid:!0,count:1,status:"valid",message:`Found: ${((s=l.element)==null?void 0:s.tag)||"element"}`}):a({isValid:!0,count:l.count,status:"multiple",message:`${l.count} elements found`})}catch{a({isValid:!1,count:0,status:"error",message:"Validation error"})}},500);return i(),()=>{var s;(s=i.cancel)==null||s.call(i)}},[t]),n}function de({value:t,onChange:n,suggestions:a=[],onSuggestionsRequest:i}){const s=it(t),[c,l]=d.useState(!1),[o,u]=d.useState(!1),j=async()=>{if(t)try{const[r]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(r!=null&&r.id))return;await chrome.tabs.sendMessage(r.id,{type:"ping"}).catch(async()=>{await chrome.scripting.executeScript({target:{tabId:r.id},files:["content.js"]}),await new Promise(x=>setTimeout(x,200))}),await chrome.tabs.sendMessage(r.id,{type:"element:highlight",selector:t})}catch(r){console.error("Failed to highlight element:",r)}},h=async()=>{try{u(!0);const[r]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(r!=null&&r.id))throw new Error("No active tab");await chrome.tabs.sendMessage(r.id,{type:"ping"}).catch(async()=>{await chrome.scripting.executeScript({target:{tabId:r.id},files:["content.js"]}),await new Promise(b=>setTimeout(b,200))}),await chrome.tabs.sendMessage(r.id,{type:"picker:start"});const x=b=>{b.type==="picker:element-selected"&&(b.selectors&&b.selectors.length>0&&(n(b.selectors[0].value,b.selectors),i&&i()),chrome.runtime.onMessage.removeListener(x),u(!1))};chrome.runtime.onMessage.addListener(x),setTimeout(()=>{chrome.runtime.onMessage.removeListener(x),u(!1)},6e4)}catch(r){console.error("Failed to pick element:",r),u(!1)}},S=()=>{switch(s.status){case"validating":return e.jsx(J,{className:"w-4 h-4 animate-spin text-dark-500"});case"valid":return e.jsx(Y,{className:"w-4 h-4 text-green-400"});case"multiple":return e.jsx(_,{className:"w-4 h-4 text-yellow-400"});case"invalid":case"error":return e.jsx(_,{className:"w-4 h-4 text-red-400"})}},m=()=>{switch(s.status){case"valid":return"border-green-400 focus:ring-green-400";case"multiple":return"border-yellow-400 focus:ring-yellow-400";case"invalid":case"error":return"border-red-400 focus:ring-red-400";default:return"border-dark-700"}};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:t,onChange:r=>n(r.target.value),placeholder:"#id, .class, [attr], button[type='submit']",className:T("input pr-10 font-mono text-sm transition-all",m())}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1",children:S()})]}),s.isValid&&e.jsx("button",{onClick:j,className:"btn btn-sm btn-ghost",title:"Preview element on page",children:e.jsx(ne,{className:"w-4 h-4"})}),e.jsxs("button",{onClick:h,disabled:o,className:T("btn btn-sm",o?"btn-ghost animate-pulse":"btn-primary"),title:"Pick element from page",children:[e.jsx(Re,{className:"w-4 h-4"}),o?"Picking...":"Pick"]}),a.length>0&&e.jsx("button",{onClick:()=>l(!c),className:"btn btn-sm btn-ghost",title:"Show selector suggestions",children:c?e.jsx(Ee,{className:"w-4 h-4"}):e.jsx(Q,{className:"w-4 h-4"})})]}),s.message&&e.jsx("p",{className:T("text-xs mt-1",s.status==="valid"?"text-green-400":s.status==="multiple"?"text-yellow-400":"text-red-400"),children:s.message})]}),c&&a.length>0&&e.jsxs("div",{className:"bg-dark-850 border border-dark-700 rounded-lg p-2 space-y-1",children:[e.jsx("div",{className:"text-xs text-dark-400 px-2 py-1",children:"Suggestions (click to use):"}),a.slice(0,5).map((r,x)=>e.jsx("button",{onClick:()=>{n(r.value),l(!1)},className:"w-full text-left px-3 py-2 rounded hover:bg-dark-700 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("code",{className:"text-xs text-dark-200 font-mono",children:r.value}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-dark-500",children:r.type}),e.jsxs("span",{className:T("text-xs px-1.5 py-0.5 rounded",r.confidence>.8?"bg-green-400/20 text-green-400":r.confidence>.6?"bg-yellow-400/20 text-yellow-400":"bg-dark-700 text-dark-400"),children:[Math.round(r.confidence*100),"%"]})]})]})},x))]})]})}function ct(){const[t,n]=d.useState(!0);return t?e.jsx("div",{className:"bg-accent/10 border border-accent/30 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx(De,{className:"w-5 h-5 text-accent flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-accent",children:"Selector Tips"}),e.jsxs("div",{className:"text-xs text-dark-300 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{className:"text-dark-200",children:"1. Use the Pick button"})," - Click on the page element directly"]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-dark-200",children:"2. By ID:"})," ",e.jsx("code",{className:"bg-dark-800 px-1 rounded",children:"#email"})," - Most reliable"]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-dark-200",children:"3. By name:"})," ",e.jsx("code",{className:"bg-dark-800 px-1 rounded",children:'input[name="email"]'})]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-dark-200",children:"4. By type:"})," ",e.jsx("code",{className:"bg-dark-800 px-1 rounded",children:'button[type="submit"]'})]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-dark-200",children:"5. By placeholder:"})," ",e.jsx("code",{className:"bg-dark-800 px-1 rounded",children:'input[placeholder="Email"]'})]})]})]}),e.jsx("button",{onClick:()=>n(!1),className:"btn btn-icon btn-sm btn-ghost flex-shrink-0",children:e.jsx(Pe,{className:"w-4 h-4"})})]})}):null}const lt=[{type:"navigate",label:"Navigate",icon:me,description:"Go to a URL"},{type:"click",label:"Click",icon:re,description:"Click an element"},{type:"type",label:"Type",icon:xe,description:"Enter text into a field"},{type:"select",label:"Select",icon:he,description:"Select from dropdown"},{type:"assert",label:"Assert",icon:ne,description:"Verify element text/visibility"},{type:"wait",label:"Wait",icon:ie,description:"Wait for element or time"}];function ot({steps:t,onStepsChange:n,currentStepId:a,stepResults:i}){const[s,c]=d.useState(null),[l,o]=d.useState(!1),u=r=>i==null?void 0:i.find(x=>x.stepId===r),j=r=>{const x=ut(r,t.length);n([...t,x]),c(x.id),o(!1)},h=(r,x)=>{n(t.map(b=>b.id===r?{...b,...x}:b))},S=r=>{n(t.filter(x=>x.id!==r)),s===r&&c(null)},m=(r,x)=>{const b=x==="up"?r-1:r+1;if(b<0||b>=t.length)return;const R=[...t];[R[r],R[b]]=[R[b],R[r]],R.forEach((g,A)=>g.order=A),n(R)};return e.jsxs("div",{className:"space-y-3",children:[e.jsx(ct,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-medium text-dark-300",children:["Steps (",t.length,")"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>o(!l),className:"btn btn-sm btn-primary",children:[e.jsx(Z,{className:"w-4 h-4"}),"Add Step"]}),l&&e.jsx("div",{className:"absolute right-0 top-full mt-1 w-56 bg-dark-800 border border-dark-700 rounded-lg shadow-xl z-10",children:lt.map(({type:r,label:x,icon:b,description:R})=>e.jsxs("button",{onClick:()=>j(r),className:"w-full flex items-center gap-3 px-3 py-2 hover:bg-dark-700 text-left first:rounded-t-lg last:rounded-b-lg",children:[e.jsx(b,{className:"w-4 h-4 text-accent"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-dark-100",children:x}),e.jsx("div",{className:"text-xs text-dark-500",children:R})]})]},r))})]})]}),t.length===0?e.jsxs("div",{className:"text-center py-8 text-dark-500 border border-dashed border-dark-700 rounded-lg",children:[e.jsx(re,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No steps yet"}),e.jsx("p",{className:"text-xs mt-1",children:'Click "Add Step" to create your first test step'})]}):e.jsx("div",{className:"space-y-2",children:t.map((r,x)=>e.jsx(dt,{step:r,index:x,isExpanded:s===r.id,isCurrent:a===r.id,result:u(r.id),onToggle:()=>c(s===r.id?null:r.id),onUpdate:b=>h(r.id,b),onDelete:()=>S(r.id),onMove:b=>m(x,b),canMoveUp:x>0,canMoveDown:x<t.length-1},r.id))})]})}function dt({step:t,index:n,isExpanded:a,isCurrent:i,result:s,onToggle:c,onUpdate:l,onDelete:o,onMove:u,canMoveUp:j,canMoveDown:h}){var A,D;const m=(()=>{switch(t.action.type){case"navigate":return me;case"click":case"dblclick":return re;case"type":return xe;case"select":return he;case"waitForElement":return ie;default:return ne}})(),r=v=>{l({action:{...t.action,...v}})},x=(v,U)=>{if(U)l({selectors:U});else{const k=t.selectors.length>1?t.selectors:[],P=[{type:"css",value:v,priority:0,confidence:1},...k.slice(1)];l({selectors:P})}},b=()=>i?"border-blue-400 shadow-lg shadow-blue-400/20":(s==null?void 0:s.status)==="passed"?"border-green-400":(s==null?void 0:s.status)==="failed"?"border-red-400":a?"border-accent":"border-dark-700",R=()=>i?"bg-blue-400/5":(s==null?void 0:s.status)==="passed"?"bg-green-400/5":(s==null?void 0:s.status)==="failed"?"bg-red-400/5":a?"bg-dark-850":"bg-dark-800",g=()=>i?e.jsx(J,{className:"w-4 h-4 text-blue-400 animate-spin"}):(s==null?void 0:s.status)==="passed"?e.jsx(Y,{className:"w-4 h-4 text-green-400"}):(s==null?void 0:s.status)==="failed"?e.jsx(X,{className:"w-4 h-4 text-red-400"}):null;return e.jsxs("div",{className:T("border rounded-lg transition-all duration-200",b(),R()),children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 cursor-pointer",onClick:c,children:[e.jsx(Me,{className:"w-4 h-4 text-dark-600 cursor-grab"}),e.jsx("span",{className:T("w-6 h-6 flex items-center justify-center rounded text-xs",i?"bg-blue-400/20 text-blue-400":(s==null?void 0:s.status)==="passed"?"bg-green-400/20 text-green-400":(s==null?void 0:s.status)==="failed"?"bg-red-400/20 text-red-400":"bg-dark-700 text-dark-400"),children:n+1}),e.jsx(m,{className:T("w-4 h-4",i?"text-blue-400":(s==null?void 0:s.status)==="passed"?"text-green-400":(s==null?void 0:s.status)==="failed"?"text-red-400":"text-accent")}),e.jsx("span",{className:T("flex-1 text-sm truncate",i?"text-blue-300 font-medium":(s==null?void 0:s.status)==="passed"?"text-green-300":(s==null?void 0:s.status)==="failed"?"text-red-300":"text-dark-200"),children:t.name}),g(),(s==null?void 0:s.duration)&&e.jsxs("span",{className:"text-xs text-dark-500",children:[s.duration,"ms"]}),a?e.jsx(Q,{className:"w-4 h-4 text-dark-500"}):e.jsx(ae,{className:"w-4 h-4 text-dark-500"})]}),(s==null?void 0:s.error)&&!a&&e.jsx("div",{className:"px-3 pb-2",children:e.jsx("div",{className:"text-xs text-red-400 bg-red-400/10 rounded px-2 py-1",children:s.error})}),a&&e.jsxs("div",{className:"px-3 pb-3 space-y-3 border-t border-dark-700 pt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-dark-400 mb-1",children:"Step Name"}),e.jsx("input",{type:"text",value:t.name,onChange:v=>l({name:v.target.value}),className:"input"})]}),t.action.type==="navigate"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-dark-400 mb-1",children:["URL ",e.jsxs("span",{className:"text-dark-600",children:["(use ","{{variable}}"," for data)"]})]}),e.jsx("input",{type:"text",value:t.action.url||"",onChange:v=>r({url:v.target.value}),placeholder:"https://example.com/{{page}}",className:"input"})]}),["click","type","select","waitForElement"].includes(t.action.type)&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-dark-400 mb-1",children:["Element Selector ",e.jsx("span",{className:"text-dark-600",children:"(CSS selector, or use Pick button)"})]}),e.jsx(de,{value:((A=t.selectors[0])==null?void 0:A.value)||"",onChange:x,suggestions:t.selectors,onSuggestionsRequest:()=>{}})]}),t.action.type==="type"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-dark-400 mb-1",children:["Text to Type ",e.jsxs("span",{className:"text-dark-600",children:["(use ","{{variable}}"," for data)"]})]}),e.jsx("input",{type:"text",value:t.action.text||"",onChange:v=>r({text:v.target.value}),placeholder:"{{email}}",className:"input"})]}),t.action.type==="select"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-dark-400 mb-1",children:["Value to Select ",e.jsxs("span",{className:"text-dark-600",children:["(use ","{{variable}}"," for data)"]})]}),e.jsx("input",{type:"text",value:t.action.value||"",onChange:v=>r({value:v.target.value}),placeholder:"{{option}}",className:"input"})]}),(t.action.type==="waitTime"||t.action.type==="waitForElement")&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-dark-400 mb-2",children:"Wait Type"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>r({type:"waitTime",duration:2e3}),className:T("flex-1 px-3 py-2 rounded-lg text-sm transition-colors",t.action.type==="waitTime"?"bg-accent text-white":"bg-dark-700 text-dark-300 hover:bg-dark-600"),children:"Wait for Time"}),e.jsx("button",{onClick:()=>{r({type:"waitForElement"}),t.selectors.length===0&&l({selectors:[{type:"css",value:"",priority:0,confidence:1}]})},className:T("flex-1 px-3 py-2 rounded-lg text-sm transition-colors",t.action.type==="waitForElement"?"bg-accent text-white":"bg-dark-700 text-dark-300 hover:bg-dark-600"),children:"Wait for Element"})]})]}),t.action.type==="waitTime"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-dark-400 mb-1",children:"Duration (milliseconds)"}),e.jsx("input",{type:"number",value:t.action.duration||2e3,onChange:v=>r({duration:parseInt(v.target.value)||2e3}),placeholder:"2000",min:"100",step:"100",className:"input"}),e.jsxs("p",{className:"text-xs text-dark-500 mt-1",children:[(t.action.duration||2e3)/1e3," seconds"]})]}),t.action.type==="waitForElement"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-dark-400 mb-1",children:["Element Selector ",e.jsx("span",{className:"text-dark-600",children:"(CSS selector, or use Pick button)"})]}),e.jsx(de,{value:((D=t.selectors[0])==null?void 0:D.value)||"",onChange:x,suggestions:t.selectors,onSuggestionsRequest:()=>{}})]})]}),(s==null?void 0:s.error)&&e.jsx("div",{className:"bg-red-400/10 border border-red-400/20 rounded-lg p-3 mb-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-red-300 mb-1",children:"Step Failed"}),e.jsx("div",{className:"text-xs text-red-200",children:s.error}),s.duration&&e.jsxs("div",{className:"text-xs text-red-400/60 mt-1",children:["Failed after ",s.duration,"ms"]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>u("up"),disabled:!j,className:"btn btn-icon btn-sm btn-ghost disabled:opacity-30",title:"Move up",children:e.jsx(Q,{className:"w-4 h-4 rotate-180"})}),e.jsx("button",{onClick:()=>u("down"),disabled:!h,className:"btn btn-icon btn-sm btn-ghost disabled:opacity-30",title:"Move down",children:e.jsx(Q,{className:"w-4 h-4"})})]}),e.jsxs("button",{onClick:o,className:"btn btn-sm btn-ghost text-red-400 hover:bg-red-400/10",children:[e.jsx(K,{className:"w-4 h-4"}),"Delete"]})]})]})]})}function ut(t,n){const i={id:crypto.randomUUID(),type:"ui",order:n,enabled:!0,continueOnFailure:!1,selectors:[]};switch(t){case"navigate":return{...i,name:"Navigate to URL",action:{type:"navigate",url:""},selectors:[]};case"click":return{...i,name:"Click element",action:{type:"click"},selectors:[{type:"css",value:"",priority:0,confidence:1}]};case"type":return{...i,name:"Type text",action:{type:"type",text:""},selectors:[{type:"css",value:"",priority:0,confidence:1}]};case"select":return{...i,name:"Select option",action:{type:"select",value:""},selectors:[{type:"css",value:"",priority:0,confidence:1}]};case"assert":return{...i,name:"Assert element visible",action:{type:"waitForElement"},selectors:[{type:"css",value:"",priority:0,confidence:1}],assertions:[{type:"visibility",expected:"visible"}]};case"wait":return{...i,name:"Wait",action:{type:"waitTime",duration:2e3},selectors:[]};default:return{...i,name:"New step",action:{type:"click"},selectors:[]}}}function mt({dataSets:t,onDataSetsChange:n,onGenerateWithAI:a}){const[i,s]=d.useState(0),[c,l]=d.useState(""),o=t.length>0?t:[{}],u=o[i]||{},j=Array.from(new Set(o.flatMap(g=>Object.keys(g)))),h=g=>{const A=[...o];A[i]={...u,...g},n(A)},S=()=>{c.trim()&&(h({[c.trim()]:""}),l(""))},m=g=>{const A=o.map(D=>{const v={...D};return delete v[g],v});n(A)},r=()=>{const g={};j.forEach(A=>g[A]=""),n([...o,g]),s(o.length)},x=()=>{const g={...u};n([...o,g]),s(o.length)},b=()=>{if(o.length<=1)return;const g=o.filter((A,D)=>D!==i);n(g),s(Math.min(i,g.length-1))},R=g=>{var v;const A=(v=g.target.files)==null?void 0:v[0];if(!A)return;const D=new FileReader;D.onload=U=>{var P;const k=(P=U.target)==null?void 0:P.result;try{const N=JSON.parse(k);Array.isArray(N)?n(N):n([N])}catch{const N=k.trim().split(`
`);if(N.length<2)return;const W=N[0].split(",").map(F=>F.trim()),E=N.slice(1).map(F=>{const H=F.split(",").map(y=>y.trim()),C={};return W.forEach((y,I)=>{C[y]=H[I]||""}),C});n(E)}},D.readAsText(A)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-dark-300",children:"Test Data"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"btn btn-sm btn-ghost cursor-pointer",children:[e.jsx(Le,{className:"w-4 h-4"}),"Import",e.jsx("input",{type:"file",accept:".json,.csv",onChange:R,className:"hidden"})]}),a&&e.jsxs("button",{onClick:a,className:"btn btn-sm btn-ghost text-accent",children:[e.jsx(Fe,{className:"w-4 h-4"}),"AI Generate"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-dark-850 rounded-lg px-3 py-2",children:[e.jsx("button",{onClick:()=>s(Math.max(0,i-1)),disabled:i===0,className:"btn btn-icon btn-sm btn-ghost disabled:opacity-30",children:e.jsx(Be,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm text-dark-300",children:["Data Set ",i+1," of ",o.length]}),e.jsx("button",{onClick:()=>s(Math.min(o.length-1,i+1)),disabled:i===o.length-1,className:"btn btn-icon btn-sm btn-ghost disabled:opacity-30",children:e.jsx(ae,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:r,className:"btn btn-sm btn-ghost flex-1",children:[e.jsx(Z,{className:"w-4 h-4"}),"New Set"]}),e.jsxs("button",{onClick:x,className:"btn btn-sm btn-ghost flex-1",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Duplicate"]}),e.jsx("button",{onClick:b,disabled:o.length<=1,className:"btn btn-sm btn-ghost text-red-400 disabled:opacity-30",children:e.jsx(K,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-2",children:j.length===0?e.jsxs("div",{className:"text-center py-6 text-dark-500 border border-dashed border-dark-700 rounded-lg",children:[e.jsx("p",{className:"text-sm",children:"No variables defined"}),e.jsx("p",{className:"text-xs mt-1",children:"Add variables below to use in your test steps"})]}):j.map(g=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1/3",children:e.jsx("div",{className:"px-3 py-2 bg-dark-850 rounded-lg text-sm text-dark-300 font-mono",children:`{{${g}}}`})}),e.jsx("input",{type:"text",value:u[g]||"",onChange:A=>h({[g]:A.target.value}),placeholder:`Enter ${g}...`,className:"input flex-1"}),e.jsx("button",{onClick:()=>m(g),className:"btn btn-icon btn-sm btn-ghost text-dark-500 hover:text-red-400",children:e.jsx(K,{className:"w-4 h-4"})})]},g))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:c,onChange:g=>l(g.target.value),onKeyDown:g=>g.key==="Enter"&&S(),placeholder:"Variable name (e.g., email, password)",className:"input flex-1"}),e.jsxs("button",{onClick:S,className:"btn btn-sm btn-primary",children:[e.jsx(Z,{className:"w-4 h-4"}),"Add"]})]}),e.jsx("div",{className:"bg-dark-850 rounded-lg px-3 py-2 text-xs text-dark-500",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Tip:"})," Use ",e.jsx("code",{className:"bg-dark-700 px-1 rounded",children:"{{variableName}}"})," in your test steps to substitute these values."]})})]})}function xt({testId:t,onBack:n}){const[a,i]=d.useState(null),[s,c]=d.useState([]),[l,o]=d.useState([{}]),[u,j]=d.useState("steps"),[h,S]=d.useState(!1),[m,r]=d.useState(null),[x,b]=d.useState(!1);d.useEffect(()=>{L.getById(t).then(k=>{var P;k&&(i(k),c(k.steps),o(((P=k.dataSource)==null?void 0:P.data)||[{}]))})},[t]);const R=k=>{c(k),b(!0)},g=k=>{o(k),b(!0)},A=async()=>{if(a)try{await L.update(t,{steps:s,dataSource:{type:"manual",data:l}}),b(!1),f.success("Test saved")}catch{f.error("Failed to save test")}},D=async()=>{var k,P;if(s.length===0){f.error("Add at least one step before running");return}S(!0),r({currentStep:0,total:s.length,currentDataSet:0,totalDataSets:l.length,currentStepId:null,results:[]});try{const[N]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(N!=null&&N.id))throw new Error("No active tab found");const W=async()=>{try{await chrome.tabs.sendMessage(N.id,{type:"ping"})}catch{await chrome.scripting.executeScript({target:{tabId:N.id},files:["content.js"]}),await new Promise(E=>setTimeout(E,300))}};for(let E=0;E<l.length;E++){const F=l[E];if(r(C=>C&&{...C,currentDataSet:E}),a!=null&&a.url&&a.url!=="https://"){let C=a.url;Object.entries(F).forEach(([y,I])=>{C=C.replace(new RegExp(`\\{\\{${y}\\}\\}`,"g"),I)}),await chrome.tabs.update(N.id,{url:C}),await new Promise(y=>setTimeout(y,2500)),await W()}const H=C=>{C.type==="playback:step-start"&&r(y=>y?{...y,currentStepId:C.stepId,currentStep:C.index}:null)};chrome.runtime.onMessage.addListener(H);try{let C=[];for(let y=0;y<s.length;y++){const I=s[y];if(I.action.type==="navigate"||I.action.type==="waitTime"){if(C.length>0){try{const w=await chrome.tabs.sendMessage(N.id,{type:"playback:execute",steps:C,variables:F,timeout:3e4});(k=w==null?void 0:w.result)!=null&&k.stepResults&&w.result.stepResults.forEach(B=>{r(M=>M?{...M,results:[...M.results,{dataSetIndex:E,...B}]}:null)})}catch(w){throw console.error("Error executing steps before navigation:",w),new Error(`Step execution failed: ${w instanceof Error?w.message:String(w)}`)}C=[]}r(w=>w?{...w,currentStepId:I.id,currentStep:y}:null);try{const w=Date.now();if(I.action.type==="navigate"){let q=I.action.url;Object.entries(F).forEach(([G,O])=>{q=q.replace(new RegExp(`\\{\\{${G}\\}\\}`,"g"),O)}),await chrome.tabs.update(N.id,{url:q}),await new Promise(G=>{let O=!1;const be=setTimeout(()=>{O||(O=!0,G())},8e3),ee=(fe,ye)=>{fe===N.id&&ye.status==="complete"&&!O&&(O=!0,clearTimeout(be),chrome.tabs.onUpdated.removeListener(ee),setTimeout(()=>G(),500))};chrome.tabs.onUpdated.addListener(ee),setTimeout(()=>{chrome.tabs.onUpdated.removeListener(ee)},8500)}),await W()}else if(I.action.type==="waitTime"){const M=I.action;await new Promise(q=>setTimeout(q,M.duration))}const B=Date.now()-w;r(M=>M?{...M,currentStepId:null,results:[...M.results,{dataSetIndex:E,stepId:I.id,status:"passed",duration:B}]}:null)}catch(w){throw r(B=>B?{...B,currentStepId:null,results:[...B.results,{dataSetIndex:E,stepId:I.id,status:"failed",error:`${I.action.type==="navigate"?"Navigation":"Wait"} failed: ${w instanceof Error?w.message:String(w)}`,duration:0}]}:null),w}}else C.push(I)}if(C.length>0)try{const y=await chrome.tabs.sendMessage(N.id,{type:"playback:execute",steps:C,variables:F,timeout:3e4});(P=y==null?void 0:y.result)!=null&&P.stepResults&&y.result.stepResults.forEach(I=>{r(w=>w?{...w,results:[...w.results,{dataSetIndex:E,...I}]}:null)})}catch(y){throw console.error("Error executing remaining steps:",y),new Error(`Step execution failed: ${y instanceof Error?y.message:String(y)}`)}}finally{chrome.runtime.onMessage.removeListener(H)}}f.success("Test completed!")}catch(N){console.error("Test execution error:",N),f.error("Test execution failed: "+(N instanceof Error?N.message:"Unknown error"))}finally{S(!1)}};if(!a)return e.jsx("div",{className:"flex items-center justify-center h-full text-dark-500",children:e.jsx(J,{className:"w-6 h-6 animate-spin"})});const v=(m==null?void 0:m.results.filter(k=>k.status==="passed").length)||0,U=(m==null?void 0:m.results.filter(k=>k.status==="failed").length)||0;return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 border-b border-dark-800",children:[e.jsx("button",{onClick:n,className:"btn btn-icon btn-sm btn-ghost",children:e.jsx(Ke,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-lg font-medium text-dark-100 truncate",children:a.name}),e.jsx("p",{className:"text-xs text-dark-500 truncate",children:a.url})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[x&&e.jsxs("button",{onClick:A,className:"btn btn-sm btn-ghost",children:[e.jsx(Ue,{className:"w-4 h-4"}),"Save"]}),e.jsx("button",{onClick:D,disabled:h,className:"btn btn-sm btn-primary",children:h?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4 animate-spin"}),"Running..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4"}),"Run Test"]})})]})]}),m&&e.jsxs("div",{className:"px-4 py-2 bg-dark-850 border-b border-dark-800",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-dark-400 mb-1",children:[e.jsxs("span",{children:["Data Set ",m.currentDataSet+1,"/",m.totalDataSets]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"flex items-center gap-1 text-green-400",children:[e.jsx(Y,{className:"w-3 h-3"})," ",v]}),e.jsxs("span",{className:"flex items-center gap-1 text-red-400",children:[e.jsx(X,{className:"w-3 h-3"})," ",U]})]})]}),e.jsx("div",{className:"h-1 bg-dark-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-accent transition-all",style:{width:`${(m.currentDataSet*s.length+m.results.length)/(m.totalDataSets*s.length)*100}%`}})})]}),e.jsxs("div",{className:"flex border-b border-dark-800",children:[e.jsxs("button",{onClick:()=>j("steps"),className:T("flex-1 flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium transition-colors",u==="steps"?"text-accent border-b-2 border-accent":"text-dark-400 hover:text-dark-200"),children:[e.jsx(Oe,{className:"w-4 h-4"}),"Steps (",s.length,")"]}),e.jsxs("button",{onClick:()=>j("data"),className:T("flex-1 flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium transition-colors",u==="data"?"text-accent border-b-2 border-accent":"text-dark-400 hover:text-dark-200"),children:[e.jsx(qe,{className:"w-4 h-4"}),"Data (",l.length," sets)"]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:u==="steps"?e.jsx(ot,{steps:s,onStepsChange:R,currentStepId:m==null?void 0:m.currentStepId,stepResults:m==null?void 0:m.results}):e.jsx(mt,{dataSets:l,onDataSetsChange:g})})]})}const ht={passed:Y,failed:X,running:ie,error:_,stopped:_},pt={passed:"text-status-pass",failed:"text-status-fail",running:"text-status-running",error:"text-status-fail",stopped:"text-status-pending"};function gt(){const[t,n]=d.useState([]),[a,i]=d.useState(!0);return d.useEffect(()=>{tt.getRecent(50).then(s=>{n(s),i(!1)})},[]),a?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin w-6 h-6 border-2 border-accent border-t-transparent rounded-full"})}):t.length===0?e.jsxs("div",{className:"text-center py-12 text-dark-500",children:[e.jsx(ue,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No test results yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Run some tests to see results here"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-sm font-medium text-dark-400 uppercase tracking-wider",children:["Recent Results (",t.length,")"]}),e.jsx("div",{className:"space-y-2",children:t.map(s=>{const c=ht[s.status],l=pt[s.status];return e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{className:T("w-5 h-5",l)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-dark-100",children:"Test Run"}),e.jsx("span",{className:T("text-xs px-2 py-0.5 rounded-full",l,"bg-current/10"),children:s.status})]}),e.jsx("div",{className:"text-xs text-dark-500 mt-1",children:new Date(s.startedAt).toLocaleString()})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{className:"text-dark-300",children:[s.summary.passedSteps,"/",s.summary.totalSteps," passed"]}),e.jsxs("div",{className:"text-xs text-dark-500",children:[(s.summary.duration/1e3).toFixed(1),"s"]})]})]}),s.summary.failedSteps>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-700",children:e.jsxs("div",{className:"text-xs text-status-fail",children:[s.summary.failedSteps," step",s.summary.failedSteps!==1?"s":""," failed"]})})]},s.id)})})]})}function bt(){const{settings:t,refreshSettings:n}=ge(),[a,i]=d.useState(""),[s,c]=d.useState(!1),[l,o]=d.useState((t==null?void 0:t.parallelLimit)||2),u=async()=>{if(!a.trim()){f.error("Please enter an API key");return}try{await z.setOpenAIKey(a),await n(),i(""),f.success("API key saved")}catch{f.error("Failed to save API key")}},j=async()=>{if(confirm("Remove the OpenAI API key?"))try{await z.clearOpenAIKey(),await n(),f.success("API key removed")}catch{f.error("Failed to remove API key")}},h=async()=>{try{await z.setParallelLimit(l),await n(),f.success("Settings saved")}catch{f.error("Failed to save settings")}},S=async()=>{if(confirm("This will delete ALL data including tests, results, and settings. This cannot be undone. Continue?"))try{await p.delete(),await p.open(),window.location.reload()}catch{f.error("Failed to clear data")}};return e.jsxs("div",{className:"space-y-6 max-w-lg",children:[e.jsxs("section",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"font-medium text-dark-100 flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4"}),"AI Integration"]})}),e.jsxs("div",{className:"card-body space-y-4",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Add your OpenAI API key to enable AI-powered test data generation and self-healing selectors."}),t!=null&&t.openaiApiKey?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 px-3 py-2 bg-dark-900 rounded-lg text-dark-400 text-sm",children:"••••••••••••••••"}),e.jsx("button",{onClick:j,className:"btn btn-sm btn-ghost text-red-400",children:e.jsx(K,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:s?"text":"password",placeholder:"sk-...",value:a,onChange:m=>i(m.target.value),className:"input"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:u,className:"btn btn-sm btn-primary",children:"Save API Key"}),e.jsx("button",{onClick:()=>c(!s),className:"btn btn-sm btn-ghost",children:s?"Hide":"Show"})]})]})]})]}),e.jsxs("section",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"font-medium text-dark-100 flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),"Execution Settings"]})}),e.jsx("div",{className:"card-body space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-dark-400 mb-2",children:"Parallel Test Limit"}),e.jsx("p",{className:"text-xs text-dark-500 mb-2",children:"Maximum number of tests to run simultaneously"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"1",max:"10",value:l,onChange:m=>o(parseInt(m.target.value)||1),className:"input w-20"}),e.jsx("button",{onClick:h,className:"btn btn-sm btn-secondary",children:"Save"})]})]})})]}),e.jsxs("section",{className:"card border-red-900/50",children:[e.jsx("div",{className:"card-header border-red-900/50",children:e.jsx("h3",{className:"font-medium text-red-400",children:"Danger Zone"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("p",{className:"text-sm text-dark-400 mb-4",children:"Permanently delete all data including test suites, tests, and results."}),e.jsxs("button",{onClick:S,className:"btn btn-sm btn-danger",children:[e.jsx(K,{className:"w-4 h-4"}),"Clear All Data"]})]})]}),e.jsx("section",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex items-center gap-2 text-dark-400",children:[e.jsx(He,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"QAerx v0.1.0"})]}),e.jsx("p",{className:"text-xs text-dark-500 mt-2",children:"Automation testing with AI-powered test data generation"})]})})]})}function ft({currentView:t,selectedSuiteId:n,selectedTestId:a,onSelectSuite:i,onSelectTest:s}){return t==="tests"&&a?e.jsx("main",{className:"flex-1 overflow-hidden",children:e.jsx(xt,{testId:a,onBack:()=>s(null)})}):e.jsxs("main",{className:"flex-1 overflow-auto p-4",children:[t==="suites"&&e.jsx(at,{selectedSuiteId:n,onSelectSuite:i}),t==="tests"&&e.jsx(nt,{suiteId:n,selectedTestId:a,onSelectTest:s}),t==="results"&&e.jsx(gt,{}),t==="settings"&&e.jsx(bt,{})]})}function yt(){const[t,n]=d.useState("suites"),[a,i]=d.useState(null),[s,c]=d.useState(null);return e.jsxs(st,{children:[e.jsxs("div",{className:"flex h-screen bg-dark-900",children:[e.jsx(_e,{currentView:t,onViewChange:n}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(Ye,{currentView:t,selectedSuiteId:a,selectedTestId:s}),e.jsx(ft,{currentView:t,selectedSuiteId:a,selectedTestId:s,onSelectSuite:i,onSelectTest:c})]})]}),e.jsx(Ge,{position:"bottom-right",toastOptions:{className:"bg-dark-800 text-dark-100 border border-dark-600",duration:3e3}})]})}Qe.createRoot(document.getElementById("root")).render(e.jsx(ze.StrictMode,{children:e.jsx(yt,{})}));
