var oe=Object.defineProperty;var de=(t,s,a)=>s in t?oe(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a;var D=(t,s,a)=>de(t,typeof s!="symbol"?s+"":s,a);import"./chunks/modulepreload-polyfill.B5Qt9EMX.js";import{j as e,Z as ue,F as me,P as V,H as Y,S as xe,c as A,r as m,z as f,a as pe,C as he,D as ge,v as G,b as be,d as W,e as H,T as E,f as Z,g as M,G as fe,N as ee,M as $,h as te,L as se,E as ae,i as z,k as ye,l as q,U as je,m as we,n as Ne,o as ve,p as _,A as ke,q as Se,s as ne,t as re,u as Ce,w as Ae,x as J,K as Ie,y as Re,I as Te,B as De,J as Ee,R as Pe}from"./chunks/client.CYtTL0Mc.js";const Be=[{id:"suites",icon:me,label:"Suites"},{id:"tests",icon:V,label:"Tests"},{id:"results",icon:Y,label:"Results"},{id:"settings",icon:xe,label:"Settings"}];function Fe({currentView:t,onViewChange:s}){return e.jsxs("aside",{className:"w-16 bg-dark-950 border-r border-dark-800 flex flex-col items-center py-4",children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"w-10 h-10 bg-accent rounded-xl flex items-center justify-center",children:e.jsx(ue,{className:"w-6 h-6 text-white"})})}),e.jsx("nav",{className:"flex-1 flex flex-col gap-2",children:Be.map(a=>{const n=a.icon,r=t===a.id;return e.jsx("button",{onClick:()=>s(a.id),className:A("w-10 h-10 rounded-lg flex items-center justify-center transition-colors",r?"bg-accent text-white":"text-dark-400 hover:text-dark-100 hover:bg-dark-800"),title:a.label,children:e.jsx(n,{className:"w-5 h-5"})},a.id)})}),e.jsx("div",{className:"mt-auto pt-4 text-[10px] text-dark-600",children:"v0.1"})]})}function Me(){const[t,s]=m.useState({isRecording:!1,isPaused:!1,steps:[],sessionId:null});m.useEffect(()=>{const l=d=>{switch(d.type){case"recording:state-changed":break;case"recording:step-added":d.step&&s(x=>({...x,steps:[...x.steps,d.step]}));break;case"recording:completed":s(x=>({...x,isRecording:!1,steps:d.steps||x.steps}));break;case"recording:paused":s(x=>({...x,isPaused:!0}));break;case"recording:resumed":s(x=>({...x,isPaused:!1}));break}};return chrome.runtime.onMessage.addListener(l),()=>chrome.runtime.onMessage.removeListener(l)},[]);const a=m.useCallback(async()=>{try{const l=await chrome.runtime.sendMessage({type:"command:start-recording"});l.success?(s({isRecording:!0,isPaused:!1,steps:[],sessionId:crypto.randomUUID()}),f.success("Recording started")):f.error(l.error||"Failed to start recording")}catch(l){console.error("Failed to start recording:",l),f.error("Failed to start recording. Make sure you are on a web page.")}},[]),n=m.useCallback(async()=>{var l;try{const d=await chrome.runtime.sendMessage({type:"command:stop-recording"});return d.success?(s(x=>({...x,isRecording:!1,steps:d.steps||x.steps})),f.success(`Recording stopped. ${((l=d.steps)==null?void 0:l.length)||0} steps captured.`),d.steps||[]):(f.error(d.error||"Failed to stop recording"),[])}catch(d){return console.error("Failed to stop recording:",d),f.error("Failed to stop recording"),[]}},[]),r=m.useCallback(async()=>{await chrome.runtime.sendMessage({type:"command:pause-recording"}),s(l=>({...l,isPaused:!0}))},[]),c=m.useCallback(async()=>{await chrome.runtime.sendMessage({type:"command:resume-recording"}),s(l=>({...l,isPaused:!1}))},[]);return{...t,startRecording:a,stopRecording:n,pauseRecording:r,resumeRecording:c}}const Le={suites:"Test Suites",tests:"Tests",results:"Results",settings:"Settings"};function Ke({currentView:t}){const{isRecording:s,startRecording:a,stopRecording:n}=Me();return e.jsxs("header",{className:"h-14 bg-dark-850 border-b border-dark-800 px-4 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("h1",{className:"text-lg font-semibold text-dark-100",children:Le[t]})}),e.jsx("div",{className:"flex items-center gap-2",children:s?e.jsxs("button",{onClick:n,className:"btn btn-sm bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(pe,{className:"w-3 h-3 fill-current"}),"Stop Recording"]}):e.jsxs("button",{onClick:a,className:"btn btn-sm btn-primary",children:[e.jsx(he,{className:A("w-3 h-3",s&&"fill-current animate-pulse")}),"Record"]})})]})}class Ue extends ge{constructor(){super("QAerxDB");D(this,"suites");D(this,"tests");D(this,"testRuns");D(this,"credentials");D(this,"screenshots");D(this,"settings");this.version(1).stores({suites:"id, parentId, name, updatedAt",tests:"id, suiteId, name, updatedAt, [suiteId+order]",testRuns:"id, testId, suiteId, status, startedAt, [testId+startedAt]",credentials:"id, name, domain",screenshots:"id, testRunId, stepId, timestamp, isBaseline, [testId+isBaseline]",settings:"id"}),this.version(2).stores({suites:"id, parentId, name, order, updatedAt",tests:"id, suiteId, name, updatedAt, [suiteId+order]",testRuns:"id, testId, suiteId, status, startedAt, [testId+startedAt]",credentials:"id, name, domain",screenshots:"id, testRunId, stepId, timestamp, isBaseline, [testId+isBaseline]",settings:"id"})}}const h=new Ue,P={async create(t){console.log("SuiteRepository.create called with:",t);const s=Date.now(),a={...t,id:G(),createdAt:s,updatedAt:s};return console.log("Creating suite:",a),console.log("Database instance:",h),await h.suites.add(a),console.log("Suite added successfully"),a},async getById(t){return h.suites.get(t)},async getAll(){return h.suites.orderBy("order").toArray()},async getByParent(t){return t===void 0?h.suites.filter(s=>!s.parentId).toArray():h.suites.where("parentId").equals(t).toArray()},async update(t,s){await h.suites.update(t,{...s,updatedAt:Date.now()})},async delete(t){await h.tests.where("suiteId").equals(t).delete();const s=await this.getByParent(t);for(const a of s)await this.delete(a.id);await h.suites.delete(t)},async getTree(){const t=await this.getAll(),s=await h.tests.toArray(),a=new Map;for(const r of s)a.set(r.suiteId,(a.get(r.suiteId)||0)+1);const n=r=>t.filter(c=>c.parentId===r).sort((c,l)=>c.order-l.order).map(c=>({...c,children:n(c.id),tests:a.get(c.id)||0}));return n(void 0)},async createDefault(){return this.create({name:"Default Suite",order:0,hooks:{}})}},C={async create(t){const s=Date.now(),a={...t,id:G(),createdAt:s,updatedAt:s};return await h.tests.add(a),a},async getById(t){return h.tests.get(t)},async getAll(){return h.tests.toArray()},async getBySuite(t){return h.tests.where("suiteId").equals(t).sortBy("order")},async update(t,s){await h.tests.update(t,{...s,updatedAt:Date.now()})},async delete(t){await h.testRuns.where("testId").equals(t).delete(),await h.tests.delete(t)},async addStep(t,s){const a=await this.getById(t);if(!a)throw new Error("Test not found");const n=[...a.steps,s];await this.update(t,{steps:n})},async updateStep(t,s,a){const n=await this.getById(t);if(!n)throw new Error("Test not found");const r=n.steps.map(c=>c.id===s?{...c,...a}:c);await this.update(t,{steps:r})},async deleteStep(t,s){const a=await this.getById(t);if(!a)throw new Error("Test not found");const r=a.steps.filter(c=>c.id!==s).map((c,l)=>({...c,order:l}));await this.update(t,{steps:r})},async reorderSteps(t,s){const a=await this.getById(t);if(!a)throw new Error("Test not found");const n=new Map(a.steps.map(c=>[c.id,c])),r=s.map((c,l)=>{const d=n.get(c);return d?{...d,order:l}:null}).filter(c=>c!==null);await this.update(t,{steps:r})},async createNew(t,s,a){const r=(await this.getBySuite(t)).length;return this.create({suiteId:t,name:s,url:a,order:r,steps:[]})}},Oe={async create(t,s){const a={id:G(),testId:t,suiteId:s,startedAt:Date.now(),status:"running",environment:await this.getEnvironment(),stepResults:[],summary:{totalSteps:0,passedSteps:0,failedSteps:0,skippedSteps:0,duration:0}};return await h.testRuns.add(a),a},async getById(t){return h.testRuns.get(t)},async getByTest(t,s=10){return h.testRuns.where("testId").equals(t).reverse().sortBy("startedAt").then(a=>a.slice(0,s))},async getBySuite(t,s=50){return h.testRuns.where("suiteId").equals(t).reverse().sortBy("startedAt").then(a=>a.slice(0,s))},async getRecent(t=20){return h.testRuns.orderBy("startedAt").reverse().limit(t).toArray()},async update(t,s){await h.testRuns.update(t,s)},async addStepResult(t,s){const a=await this.getById(t);if(!a)throw new Error("Test run not found");const n=[...a.stepResults,s],r=this.calculateSummary(n,a.startedAt);await this.update(t,{stepResults:n,summary:r})},async complete(t,s){const a=await this.getById(t);if(!a)throw new Error("Test run not found");const n=Date.now(),r=this.calculateSummary(a.stepResults,a.startedAt,n);await this.update(t,{status:s,completedAt:n,summary:r})},async delete(t){await h.screenshots.where("testRunId").equals(t).delete(),await h.testRuns.delete(t)},async pruneOld(t=30){const s=Date.now()-t*24*60*60*1e3,a=await h.testRuns.where("startedAt").below(s).toArray();for(const n of a)await h.screenshots.where("testRunId").equals(n.id).delete();return h.testRuns.where("startedAt").below(s).delete()},calculateSummary(t,s,a){return{totalSteps:t.length,passedSteps:t.filter(n=>n.status==="passed").length,failedSteps:t.filter(n=>n.status==="failed").length,skippedSteps:t.filter(n=>n.status==="skipped").length,duration:(a||Date.now())-s}},async getEnvironment(){var t,s,a,n;return{browserVersion:((t=navigator.userAgent.match(/Chrome\/(\d+)/))==null?void 0:t[1])||"unknown",extensionVersion:((n=(a=(s=chrome.runtime)==null?void 0:s.getManifest)==null?void 0:a.call(s))==null?void 0:n.version)||"0.1.0",screenSize:{width:window.screen.width,height:window.screen.height},userAgent:navigator.userAgent}}},X={id:"app-settings",parallelLimit:2,defaultTimeout:3e4,screenshotQuality:80,recordMouseMovements:!1,recordScrollEvents:!0,onboardingCompleted:!1,tutorialProgress:0,theme:"dark"},F={async get(){const t=await h.settings.get("app-settings");return t||(await h.settings.add(X),X)},async update(t){const a={...await this.get(),...t};return await h.settings.put(a),a},async setOpenAIKey(t){await this.update({openaiApiKey:t})},async clearOpenAIKey(){await this.update({openaiApiKey:void 0})},async setParallelLimit(t){await this.update({parallelLimit:Math.max(1,Math.min(t,10))})},async completeOnboarding(){await this.update({onboardingCompleted:!0})},async updateTutorialProgress(t){await this.update({tutorialProgress:t})},async setLastOpened(t,s){await this.update({lastOpenedSuiteId:t,lastOpenedTestId:s})}},ie=m.createContext(null);function qe({children:t}){const[s,a]=m.useState([]),[n,r]=m.useState([]),[c,l]=m.useState(null),[d,x]=m.useState(!0),j=async()=>{const o=await P.getAll();a(o)},i=async o=>{const u=o?await C.getBySuite(o):await C.getAll();r(u)},p=async()=>{const o=await F.get();l(o)};return m.useEffect(()=>{(async()=>{try{console.log("AppContext init starting..."),x(!0),await Promise.all([j(),i(),p()]),console.log("Initial data loaded");const u=await P.getAll();console.log("All suites:",u),u.length===0&&(console.log("Creating default suite..."),await P.createDefault(),await j()),x(!1),console.log("AppContext init complete")}catch(u){console.error("AppContext init error:",u),x(!1)}})()},[]),e.jsx(ie.Provider,{value:{suites:s,tests:n,settings:c,isLoading:d,refreshSuites:j,refreshTests:i,refreshSettings:p},children:t})}function ce(){const t=m.useContext(ie);if(!t)throw new Error("useApp must be used within AppProvider");return t}function Ve({selectedSuiteId:t,onSelectSuite:s}){const{suites:a,refreshSuites:n}=ce(),[r,c]=m.useState(!1),[l,d]=m.useState(""),x=async()=>{if(l.trim())try{await P.create({name:l.trim(),order:a.length,hooks:{}}),await n(),d(""),c(!1),f.success("Suite created")}catch(i){console.error("Suite creation error:",i),f.error("Failed to create suite: "+(i instanceof Error?i.message:"Unknown error"))}},j=async i=>{if(confirm("Delete this suite and all its tests?"))try{await P.delete(i),await n(),t===i&&s(null),f.success("Suite deleted")}catch{f.error("Failed to delete suite")}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-sm font-medium text-dark-400 uppercase tracking-wider",children:["Suites (",a.length,")"]}),e.jsxs("button",{onClick:()=>c(!0),className:"btn btn-sm btn-ghost",children:[e.jsx(be,{className:"w-4 h-4"}),"New Suite"]})]}),r&&e.jsxs("div",{className:"card p-3",children:[e.jsx("input",{type:"text",placeholder:"Suite name",value:l,onChange:i=>d(i.target.value),onKeyDown:i=>{i.key==="Enter"&&x(),i.key==="Escape"&&c(!1)},className:"input mb-2",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:x,className:"btn btn-sm btn-primary",children:"Create"}),e.jsx("button",{onClick:()=>c(!1),className:"btn btn-sm btn-ghost",children:"Cancel"})]})]}),e.jsxs("div",{className:"space-y-1",children:[a.map(i=>e.jsxs("div",{className:A("group flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer transition-colors",t===i.id?"bg-accent/20 text-accent":"hover:bg-dark-800 text-dark-200"),onClick:()=>s(i.id),children:[e.jsx(W,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"flex-1 truncate",children:i.name}),e.jsx(H,{className:"w-4 h-4 opacity-0 group-hover:opacity-100"}),e.jsx("button",{onClick:p=>{p.stopPropagation(),j(i.id)},className:"p-1 opacity-0 group-hover:opacity-100 hover:text-red-400",children:e.jsx(E,{className:"w-3 h-3"})})]},i.id)),a.length===0&&!r&&e.jsxs("div",{className:"text-center py-8 text-dark-500",children:[e.jsx(W,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No test suites yet"}),e.jsx("button",{onClick:()=>c(!0),className:"btn btn-sm btn-primary mt-4",children:"Create your first suite"})]})]})]})}function Ge({suiteId:t,selectedTestId:s,onSelectTest:a}){const[n,r]=m.useState([]),[c,l]=m.useState(!1),[d,x]=m.useState(""),[j,i]=m.useState("");m.useEffect(()=>{t?C.getBySuite(t).then(r):C.getAll().then(r)},[t]);const p=async()=>{if(!(!d.trim()||!t))try{await C.createNew(t,d.trim(),j||"https://");const u=await C.getBySuite(t);r(u),x(""),i(""),l(!1),f.success("Test created")}catch{f.error("Failed to create test")}},o=async u=>{if(confirm("Delete this test?"))try{if(await C.delete(u),t){const y=await C.getBySuite(t);r(y)}s===u&&a(null),f.success("Test deleted")}catch{f.error("Failed to delete test")}};return t?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-sm font-medium text-dark-400 uppercase tracking-wider",children:["Tests (",n.length,")"]}),e.jsxs("button",{onClick:()=>l(!0),className:"btn btn-sm btn-ghost",children:[e.jsx(M,{className:"w-4 h-4"}),"New Test"]})]}),c&&e.jsxs("div",{className:"card p-3 space-y-2",children:[e.jsx("input",{type:"text",placeholder:"Test name",value:d,onChange:u=>x(u.target.value),className:"input",autoFocus:!0}),e.jsx("input",{type:"url",placeholder:"Starting URL (https://...)",value:j,onChange:u=>i(u.target.value),className:"input"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:p,className:"btn btn-sm btn-primary",children:"Create"}),e.jsx("button",{onClick:()=>l(!1),className:"btn btn-sm btn-ghost",children:"Cancel"})]})]}),e.jsxs("div",{className:"space-y-2",children:[n.map(u=>e.jsx("div",{className:A("card p-3 cursor-pointer transition-colors",s===u.id?"ring-2 ring-accent":"hover:bg-dark-750"),onClick:()=>a(u.id),children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-dark-100 truncate",children:u.name}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-dark-500 mt-1",children:[e.jsx(fe,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:u.url})]}),e.jsxs("div",{className:"text-xs text-dark-500 mt-1",children:[u.steps.length," steps"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:y=>{y.stopPropagation(),f.success("Running test...")},className:"btn btn-icon btn-sm btn-ghost text-accent hover:bg-accent/20",children:e.jsx(V,{className:"w-4 h-4"})}),e.jsx("button",{onClick:y=>{y.stopPropagation(),o(u.id)},className:"btn btn-icon btn-sm btn-ghost text-dark-400 hover:text-red-400",children:e.jsx(E,{className:"w-4 h-4"})})]})]})},u.id)),n.length===0&&!c&&e.jsxs("div",{className:"text-center py-8 text-dark-500",children:[e.jsx(Z,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No tests in this suite"}),e.jsx("button",{onClick:()=>l(!0),className:"btn btn-sm btn-primary mt-4",children:"Create your first test"})]})]})]}):e.jsxs("div",{className:"text-center py-12 text-dark-500",children:[e.jsx(Z,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Select a suite to view tests"})]})}const He=[{type:"navigate",label:"Navigate",icon:ee,description:"Go to a URL"},{type:"click",label:"Click",icon:$,description:"Click an element"},{type:"type",label:"Type",icon:te,description:"Enter text into a field"},{type:"select",label:"Select",icon:se,description:"Select from dropdown"},{type:"assert",label:"Assert",icon:ae,description:"Verify element text/visibility"},{type:"wait",label:"Wait",icon:z,description:"Wait for element or time"}];function $e({steps:t,onStepsChange:s}){const[a,n]=m.useState(null),[r,c]=m.useState(!1),l=i=>{const p=Qe(i,t.length);s([...t,p]),n(p.id),c(!1)},d=(i,p)=>{s(t.map(o=>o.id===i?{...o,...p}:o))},x=i=>{s(t.filter(p=>p.id!==i)),a===i&&n(null)},j=(i,p)=>{const o=p==="up"?i-1:i+1;if(o<0||o>=t.length)return;const u=[...t];[u[i],u[o]]=[u[o],u[i]],u.forEach((y,I)=>y.order=I),s(u)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-medium text-dark-300",children:["Steps (",t.length,")"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>c(!r),className:"btn btn-sm btn-primary",children:[e.jsx(M,{className:"w-4 h-4"}),"Add Step"]}),r&&e.jsx("div",{className:"absolute right-0 top-full mt-1 w-56 bg-dark-800 border border-dark-700 rounded-lg shadow-xl z-10",children:He.map(({type:i,label:p,icon:o,description:u})=>e.jsxs("button",{onClick:()=>l(i),className:"w-full flex items-center gap-3 px-3 py-2 hover:bg-dark-700 text-left first:rounded-t-lg last:rounded-b-lg",children:[e.jsx(o,{className:"w-4 h-4 text-accent"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-dark-100",children:p}),e.jsx("div",{className:"text-xs text-dark-500",children:u})]})]},i))})]})]}),t.length===0?e.jsxs("div",{className:"text-center py-8 text-dark-500 border border-dashed border-dark-700 rounded-lg",children:[e.jsx($,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No steps yet"}),e.jsx("p",{className:"text-xs mt-1",children:'Click "Add Step" to create your first test step'})]}):e.jsx("div",{className:"space-y-2",children:t.map((i,p)=>e.jsx(ze,{step:i,index:p,isExpanded:a===i.id,onToggle:()=>n(a===i.id?null:i.id),onUpdate:o=>d(i.id,o),onDelete:()=>x(i.id),onMove:o=>j(p,o),canMoveUp:p>0,canMoveDown:p<t.length-1},i.id))})]})}function ze({step:t,index:s,isExpanded:a,onToggle:n,onUpdate:r,onDelete:c,onMove:l,canMoveUp:d,canMoveDown:x}){var u;const i=(()=>{switch(t.action.type){case"navigate":return ee;case"click":case"dblclick":return $;case"type":return te;case"select":return se;case"waitForElement":return z;default:return ae}})(),p=y=>{r({action:{...t.action,...y}})},o=y=>{r({selectors:[{type:"css",value:y,priority:0,confidence:1}]})};return e.jsxs("div",{className:A("border rounded-lg transition-colors",a?"border-accent bg-dark-850":"border-dark-700 bg-dark-800"),children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 cursor-pointer",onClick:n,children:[e.jsx(ye,{className:"w-4 h-4 text-dark-600 cursor-grab"}),e.jsx("span",{className:"w-6 h-6 flex items-center justify-center bg-dark-700 rounded text-xs text-dark-400",children:s+1}),e.jsx(i,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"flex-1 text-sm text-dark-200 truncate",children:t.name}),a?e.jsx(q,{className:"w-4 h-4 text-dark-500"}):e.jsx(H,{className:"w-4 h-4 text-dark-500"})]}),a&&e.jsxs("div",{className:"px-3 pb-3 space-y-3 border-t border-dark-700 pt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-dark-400 mb-1",children:"Step Name"}),e.jsx("input",{type:"text",value:t.name,onChange:y=>r({name:y.target.value}),className:"input"})]}),t.action.type==="navigate"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-dark-400 mb-1",children:["URL ",e.jsxs("span",{className:"text-dark-600",children:["(use ","{{variable}}"," for data)"]})]}),e.jsx("input",{type:"text",value:t.action.url||"",onChange:y=>p({url:y.target.value}),placeholder:"https://example.com/{{page}}",className:"input"})]}),["click","type","select","waitForElement"].includes(t.action.type)&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-dark-400 mb-1",children:["Element Selector ",e.jsx("span",{className:"text-dark-600",children:"(CSS selector)"})]}),e.jsx("input",{type:"text",value:((u=t.selectors[0])==null?void 0:u.value)||"",onChange:y=>o(y.target.value),placeholder:"#email, .btn-submit, [data-testid='login']",className:"input font-mono text-sm"})]}),t.action.type==="type"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-dark-400 mb-1",children:["Text to Type ",e.jsxs("span",{className:"text-dark-600",children:["(use ","{{variable}}"," for data)"]})]}),e.jsx("input",{type:"text",value:t.action.text||"",onChange:y=>p({text:y.target.value}),placeholder:"{{email}}",className:"input"})]}),t.action.type==="select"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-dark-400 mb-1",children:["Value to Select ",e.jsxs("span",{className:"text-dark-600",children:["(use ","{{variable}}"," for data)"]})]}),e.jsx("input",{type:"text",value:t.action.value||"",onChange:y=>p({value:y.target.value}),placeholder:"{{option}}",className:"input"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>l("up"),disabled:!d,className:"btn btn-icon btn-sm btn-ghost disabled:opacity-30",title:"Move up",children:e.jsx(q,{className:"w-4 h-4 rotate-180"})}),e.jsx("button",{onClick:()=>l("down"),disabled:!x,className:"btn btn-icon btn-sm btn-ghost disabled:opacity-30",title:"Move down",children:e.jsx(q,{className:"w-4 h-4"})})]}),e.jsxs("button",{onClick:c,className:"btn btn-sm btn-ghost text-red-400 hover:bg-red-400/10",children:[e.jsx(E,{className:"w-4 h-4"}),"Delete"]})]})]})]})}function Qe(t,s){const n={id:crypto.randomUUID(),type:"ui",order:s,enabled:!0,continueOnFailure:!1,selectors:[]};switch(t){case"navigate":return{...n,name:"Navigate to URL",action:{type:"navigate",url:""},selectors:[]};case"click":return{...n,name:"Click element",action:{type:"click"},selectors:[{type:"css",value:"",priority:0,confidence:1}]};case"type":return{...n,name:"Type text",action:{type:"type",text:""},selectors:[{type:"css",value:"",priority:0,confidence:1}]};case"select":return{...n,name:"Select option",action:{type:"select",value:""},selectors:[{type:"css",value:"",priority:0,confidence:1}]};case"assert":return{...n,name:"Assert element visible",action:{type:"waitForElement"},selectors:[{type:"css",value:"",priority:0,confidence:1}],assertions:[{type:"visibility",expected:"visible"}]};case"wait":return{...n,name:"Wait for element",action:{type:"waitForElement"},selectors:[{type:"css",value:"",priority:0,confidence:1}],waitConfig:{strategy:"visible",timeout:3e4}};default:return{...n,name:"New step",action:{type:"click"},selectors:[]}}}function We({dataSets:t,onDataSetsChange:s,onGenerateWithAI:a}){const[n,r]=m.useState(0),[c,l]=m.useState(""),d=t.length>0?t:[{}],x=d[n]||{},j=Array.from(new Set(d.flatMap(b=>Object.keys(b)))),i=b=>{const w=[...d];w[n]={...x,...b},s(w)},p=()=>{c.trim()&&(i({[c.trim()]:""}),l(""))},o=b=>{const w=d.map(R=>{const T={...R};return delete T[b],T});s(w)},u=()=>{const b={};j.forEach(w=>b[w]=""),s([...d,b]),r(d.length)},y=()=>{const b={...x};s([...d,b]),r(d.length)},I=()=>{if(d.length<=1)return;const b=d.filter((w,R)=>R!==n);s(b),r(Math.min(n,b.length-1))},L=b=>{var T;const w=(T=b.target.files)==null?void 0:T[0];if(!w)return;const R=new FileReader;R.onload=K=>{var N;const g=(N=K.target)==null?void 0:N.result;try{const k=JSON.parse(g);Array.isArray(k)?s(k):s([k])}catch{const k=g.trim().split(`
`);if(k.length<2)return;const B=k[0].split(",").map(v=>v.trim()),S=k.slice(1).map(v=>{const U=v.split(",").map(O=>O.trim()),Q={};return B.forEach((O,le)=>{Q[O]=U[le]||""}),Q});s(S)}},R.readAsText(w)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-dark-300",children:"Test Data"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"btn btn-sm btn-ghost cursor-pointer",children:[e.jsx(je,{className:"w-4 h-4"}),"Import",e.jsx("input",{type:"file",accept:".json,.csv",onChange:L,className:"hidden"})]}),a&&e.jsxs("button",{onClick:a,className:"btn btn-sm btn-ghost text-accent",children:[e.jsx(we,{className:"w-4 h-4"}),"AI Generate"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-dark-850 rounded-lg px-3 py-2",children:[e.jsx("button",{onClick:()=>r(Math.max(0,n-1)),disabled:n===0,className:"btn btn-icon btn-sm btn-ghost disabled:opacity-30",children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm text-dark-300",children:["Data Set ",n+1," of ",d.length]}),e.jsx("button",{onClick:()=>r(Math.min(d.length-1,n+1)),disabled:n===d.length-1,className:"btn btn-icon btn-sm btn-ghost disabled:opacity-30",children:e.jsx(H,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:u,className:"btn btn-sm btn-ghost flex-1",children:[e.jsx(M,{className:"w-4 h-4"}),"New Set"]}),e.jsxs("button",{onClick:y,className:"btn btn-sm btn-ghost flex-1",children:[e.jsx(ve,{className:"w-4 h-4"}),"Duplicate"]}),e.jsx("button",{onClick:I,disabled:d.length<=1,className:"btn btn-sm btn-ghost text-red-400 disabled:opacity-30",children:e.jsx(E,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-2",children:j.length===0?e.jsxs("div",{className:"text-center py-6 text-dark-500 border border-dashed border-dark-700 rounded-lg",children:[e.jsx("p",{className:"text-sm",children:"No variables defined"}),e.jsx("p",{className:"text-xs mt-1",children:"Add variables below to use in your test steps"})]}):j.map(b=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1/3",children:e.jsx("div",{className:"px-3 py-2 bg-dark-850 rounded-lg text-sm text-dark-300 font-mono",children:`{{${b}}}`})}),e.jsx("input",{type:"text",value:x[b]||"",onChange:w=>i({[b]:w.target.value}),placeholder:`Enter ${b}...`,className:"input flex-1"}),e.jsx("button",{onClick:()=>o(b),className:"btn btn-icon btn-sm btn-ghost text-dark-500 hover:text-red-400",children:e.jsx(E,{className:"w-4 h-4"})})]},b))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:c,onChange:b=>l(b.target.value),onKeyDown:b=>b.key==="Enter"&&p(),placeholder:"Variable name (e.g., email, password)",className:"input flex-1"}),e.jsxs("button",{onClick:p,className:"btn btn-sm btn-primary",children:[e.jsx(M,{className:"w-4 h-4"}),"Add"]})]}),e.jsx("div",{className:"bg-dark-850 rounded-lg px-3 py-2 text-xs text-dark-500",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Tip:"})," Use ",e.jsx("code",{className:"bg-dark-700 px-1 rounded",children:"{{variableName}}"})," in your test steps to substitute these values."]})})]})}function Ze({testId:t,onBack:s}){const[a,n]=m.useState(null),[r,c]=m.useState([]),[l,d]=m.useState([{}]),[x,j]=m.useState("steps"),[i,p]=m.useState(!1),[o,u]=m.useState(null),[y,I]=m.useState(!1);m.useEffect(()=>{C.getById(t).then(g=>{var N;g&&(n(g),c(g.steps),d(((N=g.dataSource)==null?void 0:N.data)||[{}]))})},[t]);const L=g=>{c(g),I(!0)},b=g=>{d(g),I(!0)},w=async()=>{if(a)try{await C.update(t,{steps:r,dataSource:{type:"manual",data:l}}),I(!1),f.success("Test saved")}catch{f.error("Failed to save test")}},R=async()=>{if(r.length===0){f.error("Add at least one step before running");return}p(!0),u({currentStep:0,total:r.length,currentDataSet:0,totalDataSets:l.length,results:[]});try{const[g]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(g!=null&&g.id))throw new Error("No active tab found");await chrome.tabs.sendMessage(g.id,{type:"ping"}).catch(async()=>{await chrome.scripting.executeScript({target:{tabId:g.id},files:["content.js"]}),await new Promise(N=>setTimeout(N,200))});for(let N=0;N<l.length;N++){const k=l[N];if(u(S=>S&&{...S,currentDataSet:N}),a!=null&&a.url&&a.url!=="https://"){let S=a.url;Object.entries(k).forEach(([v,U])=>{S=S.replace(new RegExp(`\\{\\{${v}\\}\\}`,"g"),U)}),await chrome.tabs.update(g.id,{url:S}),await new Promise(v=>setTimeout(v,2e3)),await chrome.scripting.executeScript({target:{tabId:g.id},files:["content.js"]}),await new Promise(v=>setTimeout(v,200))}const B=await chrome.tabs.sendMessage(g.id,{type:"playback:execute",steps:r,variables:k,timeout:3e4});B.result&&B.result.stepResults.forEach(S=>{u(v=>v?{...v,results:[...v.results,{dataSetIndex:N,...S}]}:null)})}f.success("Test completed!")}catch(g){console.error("Test execution error:",g),f.error("Test execution failed: "+(g instanceof Error?g.message:"Unknown error"))}finally{p(!1)}};if(!a)return e.jsx("div",{className:"flex items-center justify-center h-full text-dark-500",children:e.jsx(_,{className:"w-6 h-6 animate-spin"})});const T=(o==null?void 0:o.results.filter(g=>g.status==="passed").length)||0,K=(o==null?void 0:o.results.filter(g=>g.status==="failed").length)||0;return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 border-b border-dark-800",children:[e.jsx("button",{onClick:s,className:"btn btn-icon btn-sm btn-ghost",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-lg font-medium text-dark-100 truncate",children:a.name}),e.jsx("p",{className:"text-xs text-dark-500 truncate",children:a.url})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[y&&e.jsxs("button",{onClick:w,className:"btn btn-sm btn-ghost",children:[e.jsx(Se,{className:"w-4 h-4"}),"Save"]}),e.jsx("button",{onClick:R,disabled:i,className:"btn btn-sm btn-primary",children:i?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-4 h-4 animate-spin"}),"Running..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4"}),"Run Test"]})})]})]}),o&&e.jsxs("div",{className:"px-4 py-2 bg-dark-850 border-b border-dark-800",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-dark-400 mb-1",children:[e.jsxs("span",{children:["Data Set ",o.currentDataSet+1,"/",o.totalDataSets]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"flex items-center gap-1 text-green-400",children:[e.jsx(ne,{className:"w-3 h-3"})," ",T]}),e.jsxs("span",{className:"flex items-center gap-1 text-red-400",children:[e.jsx(re,{className:"w-3 h-3"})," ",K]})]})]}),e.jsx("div",{className:"h-1 bg-dark-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-accent transition-all",style:{width:`${(o.currentDataSet*r.length+o.results.length)/(o.totalDataSets*r.length)*100}%`}})})]}),e.jsxs("div",{className:"flex border-b border-dark-800",children:[e.jsxs("button",{onClick:()=>j("steps"),className:A("flex-1 flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium transition-colors",x==="steps"?"text-accent border-b-2 border-accent":"text-dark-400 hover:text-dark-200"),children:[e.jsx(Ce,{className:"w-4 h-4"}),"Steps (",r.length,")"]}),e.jsxs("button",{onClick:()=>j("data"),className:A("flex-1 flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium transition-colors",x==="data"?"text-accent border-b-2 border-accent":"text-dark-400 hover:text-dark-200"),children:[e.jsx(Ae,{className:"w-4 h-4"}),"Data (",l.length," sets)"]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:x==="steps"?e.jsx($e,{steps:r,onStepsChange:L}):e.jsx(We,{dataSets:l,onDataSetsChange:b})})]})}const _e={passed:ne,failed:re,running:z,error:J,stopped:J},Je={passed:"text-status-pass",failed:"text-status-fail",running:"text-status-running",error:"text-status-fail",stopped:"text-status-pending"};function Xe(){const[t,s]=m.useState([]),[a,n]=m.useState(!0);return m.useEffect(()=>{Oe.getRecent(50).then(r=>{s(r),n(!1)})},[]),a?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin w-6 h-6 border-2 border-accent border-t-transparent rounded-full"})}):t.length===0?e.jsxs("div",{className:"text-center py-12 text-dark-500",children:[e.jsx(Y,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No test results yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Run some tests to see results here"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-sm font-medium text-dark-400 uppercase tracking-wider",children:["Recent Results (",t.length,")"]}),e.jsx("div",{className:"space-y-2",children:t.map(r=>{const c=_e[r.status],l=Je[r.status];return e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{className:A("w-5 h-5",l)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-dark-100",children:"Test Run"}),e.jsx("span",{className:A("text-xs px-2 py-0.5 rounded-full",l,"bg-current/10"),children:r.status})]}),e.jsx("div",{className:"text-xs text-dark-500 mt-1",children:new Date(r.startedAt).toLocaleString()})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{className:"text-dark-300",children:[r.summary.passedSteps,"/",r.summary.totalSteps," passed"]}),e.jsxs("div",{className:"text-xs text-dark-500",children:[(r.summary.duration/1e3).toFixed(1),"s"]})]})]}),r.summary.failedSteps>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-dark-700",children:e.jsxs("div",{className:"text-xs text-status-fail",children:[r.summary.failedSteps," step",r.summary.failedSteps!==1?"s":""," failed"]})})]},r.id)})})]})}function Ye(){const{settings:t,refreshSettings:s}=ce(),[a,n]=m.useState(""),[r,c]=m.useState(!1),[l,d]=m.useState((t==null?void 0:t.parallelLimit)||2),x=async()=>{if(!a.trim()){f.error("Please enter an API key");return}try{await F.setOpenAIKey(a),await s(),n(""),f.success("API key saved")}catch{f.error("Failed to save API key")}},j=async()=>{if(confirm("Remove the OpenAI API key?"))try{await F.clearOpenAIKey(),await s(),f.success("API key removed")}catch{f.error("Failed to remove API key")}},i=async()=>{try{await F.setParallelLimit(l),await s(),f.success("Settings saved")}catch{f.error("Failed to save settings")}},p=async()=>{if(confirm("This will delete ALL data including tests, results, and settings. This cannot be undone. Continue?"))try{await h.delete(),await h.open(),window.location.reload()}catch{f.error("Failed to clear data")}};return e.jsxs("div",{className:"space-y-6 max-w-lg",children:[e.jsxs("section",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"font-medium text-dark-100 flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4"}),"AI Integration"]})}),e.jsxs("div",{className:"card-body space-y-4",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Add your OpenAI API key to enable AI-powered test data generation and self-healing selectors."}),t!=null&&t.openaiApiKey?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 px-3 py-2 bg-dark-900 rounded-lg text-dark-400 text-sm",children:"••••••••••••••••"}),e.jsx("button",{onClick:j,className:"btn btn-sm btn-ghost text-red-400",children:e.jsx(E,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:r?"text":"password",placeholder:"sk-...",value:a,onChange:o=>n(o.target.value),className:"input"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:x,className:"btn btn-sm btn-primary",children:"Save API Key"}),e.jsx("button",{onClick:()=>c(!r),className:"btn btn-sm btn-ghost",children:r?"Hide":"Show"})]})]})]})]}),e.jsxs("section",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"font-medium text-dark-100 flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4"}),"Execution Settings"]})}),e.jsx("div",{className:"card-body space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-dark-400 mb-2",children:"Parallel Test Limit"}),e.jsx("p",{className:"text-xs text-dark-500 mb-2",children:"Maximum number of tests to run simultaneously"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"1",max:"10",value:l,onChange:o=>d(parseInt(o.target.value)||1),className:"input w-20"}),e.jsx("button",{onClick:i,className:"btn btn-sm btn-secondary",children:"Save"})]})]})})]}),e.jsxs("section",{className:"card border-red-900/50",children:[e.jsx("div",{className:"card-header border-red-900/50",children:e.jsx("h3",{className:"font-medium text-red-400",children:"Danger Zone"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("p",{className:"text-sm text-dark-400 mb-4",children:"Permanently delete all data including test suites, tests, and results."}),e.jsxs("button",{onClick:p,className:"btn btn-sm btn-danger",children:[e.jsx(E,{className:"w-4 h-4"}),"Clear All Data"]})]})]}),e.jsx("section",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex items-center gap-2 text-dark-400",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"QAerx v0.1.0"})]}),e.jsx("p",{className:"text-xs text-dark-500 mt-2",children:"Automation testing with AI-powered test data generation"})]})})]})}function et({currentView:t,selectedSuiteId:s,selectedTestId:a,onSelectSuite:n,onSelectTest:r}){return t==="tests"&&a?e.jsx("main",{className:"flex-1 overflow-hidden",children:e.jsx(Ze,{testId:a,onBack:()=>r(null)})}):e.jsxs("main",{className:"flex-1 overflow-auto p-4",children:[t==="suites"&&e.jsx(Ve,{selectedSuiteId:s,onSelectSuite:n}),t==="tests"&&e.jsx(Ge,{suiteId:s,selectedTestId:a,onSelectTest:r}),t==="results"&&e.jsx(Xe,{}),t==="settings"&&e.jsx(Ye,{})]})}function tt(){const[t,s]=m.useState("suites"),[a,n]=m.useState(null),[r,c]=m.useState(null);return e.jsxs(qe,{children:[e.jsxs("div",{className:"flex h-screen bg-dark-900",children:[e.jsx(Fe,{currentView:t,onViewChange:s}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(Ke,{currentView:t,selectedSuiteId:a,selectedTestId:r}),e.jsx(et,{currentView:t,selectedSuiteId:a,selectedTestId:r,onSelectSuite:n,onSelectTest:c})]})]}),e.jsx(De,{position:"bottom-right",toastOptions:{className:"bg-dark-800 text-dark-100 border border-dark-600",duration:3e3}})]})}Ee.createRoot(document.getElementById("root")).render(e.jsx(Pe.StrictMode,{children:e.jsx(tt,{})}));
