var I=Object.defineProperty;var B=(i,e,t)=>e in i?I(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var f=(i,e,t)=>B(i,typeof e!="symbol"?e+"":e,t);class P{constructor(e){f(this,"handler");f(this,"isAttached",!1);f(this,"boundHandlers",new Map);this.handler=e}attach(){if(this.isAttached)return;const e=["click","dblclick","input","change","keydown","scroll"];for(const t of e){const s=this.createHandler(t);this.boundHandlers.set(t,s),document.addEventListener(t,s,{capture:!0,passive:!0})}this.isAttached=!0}detach(){if(this.isAttached){for(const[e,t]of this.boundHandlers)document.removeEventListener(e,t,{capture:!0});this.boundHandlers.clear(),this.isAttached=!1}}createHandler(e){return t=>{const s=this.captureEvent(e,t);s&&this.handler(s)}}captureEvent(e,t){const s=t.target;if(!s||!(s instanceof Element)||s.closest("[data-qaerx-extension]"))return null;const r={timestamp:Date.now(),target:s,frameSelector:this.getFrameSelector(s)};switch(e){case"click":case"dblclick":{const n=t;return{...r,type:e,target:s,timestamp:r.timestamp,button:this.getMouseButton(n.button)}}case"input":{const n=s;return"value"in n?{...r,type:"input",target:s,timestamp:r.timestamp,value:n.value}:null}case"change":{const n=s;return n.tagName==="SELECT"?{...r,type:"change",target:s,timestamp:r.timestamp,value:n.value}:n.type==="checkbox"||n.type==="radio"?{...r,type:"change",target:s,timestamp:r.timestamp,checked:n.checked}:null}case"keydown":{const n=t;return this.isSpecialKey(n.key)?{...r,type:"keydown",target:s,timestamp:r.timestamp,key:n.key,modifiers:this.getModifiers(n)}:null}case"scroll":return{...r,type:"scroll",target:s,timestamp:r.timestamp,scrollX:window.scrollX,scrollY:window.scrollY};default:return null}}getMouseButton(e){switch(e){case 0:return"left";case 1:return"middle";case 2:return"right";default:return"left"}}isSpecialKey(e){return["Enter","Tab","Escape","Backspace","Delete","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Home","End","PageUp","PageDown","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12"].includes(e)}getModifiers(e){const t=[];return e.ctrlKey&&t.push("Ctrl"),e.shiftKey&&t.push("Shift"),e.altKey&&t.push("Alt"),e.metaKey&&t.push("Meta"),t}getFrameSelector(e){const t=e.ownerDocument.defaultView;if(t===window)return;const s=document.querySelectorAll("iframe");for(const r of s)if(r.contentWindow===t){const n=r.id?`#${r.id}`:"",a=r.name?`[name="${r.name}"]`:"";return n?`iframe${n}`:a?`iframe${a}`:`iframe[src="${r.src}"]`}}}class T{generate(e){const t=[];let s=0;const r=e.getAttribute("data-testid");r&&t.push({type:"data-testid",value:`[data-testid="${r}"]`,priority:s++,confidence:.95});const n=e.getAttribute("data-cy");n&&t.push({type:"data-cy",value:`[data-cy="${n}"]`,priority:s++,confidence:.95});const a=e.getAttribute("aria-label");a&&t.push({type:"aria",value:`[aria-label="${a}"]`,priority:s++,confidence:.85});const o=e.getAttribute("role");o&&e.id&&this.isStableId(e.id)&&t.push({type:"aria",value:`[role="${o}"]#${e.id}`,priority:s++,confidence:.8}),e.id&&this.isStableId(e.id)&&t.push({type:"css",value:`#${CSS.escape(e.id)}`,priority:s++,confidence:.95});const u=e.getAttribute("name");u&&this.isStableName(u)&&t.push({type:"css",value:`[name="${CSS.escape(u)}"]`,priority:s++,confidence:.9});const d=e.getAttribute("type");d&&u&&this.isStableName(u)&&t.push({type:"css",value:`input[type="${d}"][name="${CSS.escape(u)}"]`,priority:s++,confidence:.92});const p=e.getAttribute("placeholder");p&&p.length<50&&t.push({type:"css",value:`[placeholder="${CSS.escape(p)}"]`,priority:s++,confidence:.75});const c=this.generateSemanticCSS(e);c&&t.push({type:"css",value:c,priority:s++,confidence:.7});const m=this.getUniqueTextContent(e);m&&t.push({type:"text",value:m,priority:s++,confidence:.5});const h=this.generateFullCSSPath(e);return t.push({type:"css",value:h,priority:s++,confidence:.4}),t}isStableId(e){return![/^[a-f0-9]{8}-[a-f0-9]{4}/i,/^:r[0-9]+:/,/^ember\d+$/,/^ng-\d+$/,/^\d+$/,/^[a-z]+_[a-f0-9]{6,}$/i,/^mui-\d+$/,/^headlessui-/].some(s=>s.test(e))}isStableName(e){const t=[/^[a-f0-9]{8,}$/i,/^\d+$/];return e.length>0&&!t.some(s=>s.test(e))}generateSemanticCSS(e){const t=e.tagName.toLowerCase(),s=Array.from(e.classList).filter(a=>this.isSemanticClass(a)).slice(0,2);if(s.length===0)return null;const r=`${t}.${s.join(".")}`;if(document.querySelectorAll(r).length===1)return r;const n=e.parentElement;if(n&&n.tagName!=="BODY"){const a=n.tagName.toLowerCase(),o=Array.from(n.classList).filter(u=>this.isSemanticClass(u)).slice(0,1);if(o.length>0){const u=`${a}.${o[0]} > ${r}`;if(document.querySelectorAll(u).length===1)return u}}return null}isSemanticClass(e){const t=[/^[a-z]{1,2}-\d+$/,/^[a-f0-9]{6,}$/i,/^css-[a-z0-9]+$/i,/^sc-[a-zA-Z]+$/,/^emotion-[0-9]+$/,/^_[a-zA-Z0-9]+$/,/^[a-z]+__[a-z]+--/];return e.length>2&&!t.some(s=>s.test(e))}generateFullCSSPath(e){const t=[];let s=e;for(;s&&s.tagName!=="HTML";){let r=s.tagName.toLowerCase();if(s.id&&this.isStableId(s.id)){r=`#${CSS.escape(s.id)}`,t.unshift(r);break}const n=s.parentElement;if(n){const a=s.tagName,o=n.children,u=[];for(let d=0;d<o.length;d++)o[d].tagName===a&&u.push(o[d]);if(u.length>1){const d=u.indexOf(s)+1;r+=`:nth-of-type(${d})`}t.unshift(r),s=n}else{t.unshift(r);break}}return t.join(" > ")}getUniqueTextContent(e){var r;if(!["BUTTON","A","LABEL","H1","H2","H3","H4","H5","H6"].includes(e.tagName))return null;const s=(r=e.textContent)==null?void 0:r.trim();return!s||s.length<2||s.length>50?null:s}getElementDescription(e){if(e.type==="text")return`"${e.value.substring(0,20)}${e.value.length>20?"...":""}"`;if(e.type==="data-testid"||e.type==="data-cy"){const t=e.value.match(/\[data-(?:testid|cy)="([^"]+)"\]/);return t?t[1]:e.value}if(e.type==="aria"){const t=e.value.match(/\[aria-label="([^"]+)"\]/);return t?t[1]:e.value}return e.type==="css"&&e.value.startsWith("#")?e.value.substring(1):e.value.split(" > ").pop()||e.value}}class F{constructor(){f(this,"SCROLL_DEBOUNCE_MS",300)}filter(e){let t=e;return t=this.dedupeScrolls(t),t=this.collapseInputs(t),t=t.filter(s=>s.type!=="focus"&&s.type!=="blur"),t=t.filter(s=>!this.isExtensionElement(s.target)),t}dedupeScrolls(e){const t=[];let s=null,r=0;for(const n of e)n.type==="scroll"?(s&&n.timestamp-r<this.SCROLL_DEBOUNCE_MS?t[t.length-1]=n:t.push(n),s=n,r=n.timestamp):(t.push(n),s=null);return t}collapseInputs(e){const t=[];let s=[],r=null;const n=()=>{if(s.length>0){const a=s[s.length-1];t.push(a),s=[]}};for(const a of e)a.type==="input"?(r!==a.target&&(n(),r=a.target),s.push(a)):(n(),r=null,t.push(a));return n(),t}isExtensionElement(e){return e.closest("[data-qaerx-extension]")!==null}}const q=()=>crypto.randomUUID();function N(i,e){let t;return(...s)=>{clearTimeout(t),t=setTimeout(()=>i(...s),e)}}class D{constructor(){f(this,"session",null);f(this,"eventCapture");f(this,"selectorGenerator");f(this,"actionFilter");f(this,"debouncedProcessEvents");this.eventCapture=new P(this.handleEvent.bind(this)),this.selectorGenerator=new T,this.actionFilter=new F,this.debouncedProcessEvents=N(()=>this.processPendingEvents(),100)}start(e){if(this.session)throw new Error("Recording already in progress");this.session={id:e,startedAt:Date.now(),isPaused:!1,steps:[],pendingEvents:[]},this.eventCapture.attach(),this.sendToBackground({type:"recording:started",sessionId:e})}pause(){this.session&&(this.session.isPaused=!0,this.sendToBackground({type:"recording:paused"}))}resume(){this.session&&(this.session.isPaused=!1,this.sendToBackground({type:"recording:resumed"}))}stop(){if(!this.session)return[];this.eventCapture.detach(),this.processPendingEvents();const e=this.session.steps,t=this.session.id;return this.session=null,this.sendToBackground({type:"recording:stopped",sessionId:t,steps:e}),e}getSteps(){var e;return((e=this.session)==null?void 0:e.steps)||[]}isRecording(){return this.session!==null&&!this.session.isPaused}handleEvent(e){!this.session||this.session.isPaused||(this.session.pendingEvents.push(e),this.debouncedProcessEvents())}processPendingEvents(){if(!this.session||this.session.pendingEvents.length===0)return;const e=this.session.pendingEvents;this.session.pendingEvents=[];const t=this.actionFilter.filter(e);for(const s of t){const r=this.createStep(s);r&&(this.session.steps.push(r),this.sendToBackground({type:"recording:step-added",step:r}))}}createStep(e){const t=this.selectorGenerator.generate(e.target);if(t.length===0)return console.warn("Could not generate selectors for element:",e.target),null;const s=this.mapEventToAction(e);return s?{id:q(),type:"ui",order:this.session.steps.length,name:this.generateStepName(s,t[0]),enabled:!0,continueOnFailure:!1,action:s,selectors:e.frameSelector?t.map(n=>({...n,frameSelector:e.frameSelector})):t}:null}mapEventToAction(e){switch(e.type){case"click":return{type:"click",button:e.button};case"dblclick":return{type:"dblclick"};case"input":return{type:"type",text:e.value||""};case"change":return e.target.tagName==="SELECT"?{type:"select",value:e.value||""}:e.target instanceof HTMLInputElement&&(e.target.type==="checkbox"||e.target.type==="radio")?e.checked?{type:"check"}:{type:"uncheck"}:null;case"scroll":return{type:"scroll",x:e.scrollX,y:e.scrollY};case"keydown":return e.key?{type:"press",key:e.key,modifiers:e.modifiers}:null;default:return null}}generateStepName(e,t){var r;const s=this.selectorGenerator.getElementDescription(t);switch(e.type){case"click":return`Click ${s}`;case"dblclick":return`Double-click ${s}`;case"type":return`Type "${e.text.length>20?e.text.substring(0,20)+"...":e.text}" into ${s}`;case"select":return`Select "${e.value}" in ${s}`;case"check":return`Check ${s}`;case"uncheck":return`Uncheck ${s}`;case"scroll":return"Scroll page";case"press":const a=((r=e.modifiers)==null?void 0:r.join("+"))||"";return`Press ${a?a+"+":""}${e.key}`;default:return`${e.type} on ${s}`}}sendToBackground(e){try{chrome.runtime.sendMessage(e)}catch(t){console.error("Failed to send message to background:",t)}}}let x=null;function M(){return x||(x=new D),x}const H=3e4;class _{constructor(){f(this,"shouldStop",!1)}async execute(e,t={}){const{timeout:s=H,variables:r={},onStepStart:n,onStepComplete:a}=t;this.shouldStop=!1;const o={status:"passed",startedAt:Date.now(),completedAt:0,stepResults:[]};for(let u=0;u<e.length&&!this.shouldStop;u++){const d=e[u];if(!d.enabled){o.stepResults.push({stepId:d.id,status:"skipped",duration:0});continue}n==null||n(d,u);const p=Date.now(),c=await this.executeStep(d,s,r);if(c.duration=Date.now()-p,o.stepResults.push(c),a==null||a(d,c),c.status==="failed"&&!d.continueOnFailure){o.status="failed";break}}return o.completedAt=Date.now(),o}stop(){this.shouldStop=!0}async executeStep(e,t,s){const r=this.substituteVariables(e.action,s);try{switch(r.type){case"navigate":await this.navigate(r.url,t);break;case"click":await this.click(e.selectors,t);break;case"dblclick":await this.dblclick(e.selectors,t);break;case"type":await this.type(e.selectors,r.text,t);break;case"select":await this.select(e.selectors,r.value,t);break;case"check":await this.check(e.selectors,!0,t);break;case"uncheck":await this.check(e.selectors,!1,t);break;case"waitForElement":await this.waitForElement(e.selectors,t);break;case"waitTime":await this.waitTime(r.duration);break;case"scroll":await this.scroll(r.x||0,r.y||0);break;default:throw new Error(`Unknown action type: ${r.type}`)}await this.sleep(500);const n=this.capturePageResponse(r.type);return n&&n.startsWith("Error:")?{stepId:e.id,status:"failed",duration:0,error:n.replace("Error: ",""),pageResponse:n}:{stepId:e.id,status:"passed",duration:0,pageResponse:n}}catch(n){const a=this.capturePageResponse(r.type,!0);return{stepId:e.id,status:"failed",duration:0,error:n instanceof Error?n.message:String(n),pageResponse:a}}}capturePageResponse(e,t=!1){var s,r,n;try{const a=[".error",".error-message",".alert-error",".alert-danger",".alert-warning",'[role="alert"]',".toast-error",".notification-error",".invalid-feedback",".form-error",".validation-error",".field-error",".text-red-500",".text-red-600",".text-danger",".text-error",'[class*="error"]','[class*="invalid"]','[class*="danger"]',".MuiAlert-standardError",".ant-alert-error",".chakra-alert--error",".Toastify__toast--error",".swal2-error",".help-block",".error-text",".error-msg",".errormsg",".snackbar-error",".notification.error",".message-error"],o=[".success",".success-message",".alert-success",".toast-success",".notification-success",".text-green-500",".text-green-600",".text-success",'[class*="success"]',".MuiAlert-standardSuccess",".ant-alert-success",".chakra-alert--success",".Toastify__toast--success",".swal2-success",".snackbar-success",".notification.success",".message-success"],u=["invalid","error","failed","incorrect","wrong","not found","denied","unauthorized","forbidden","required","missing","unable","cannot","couldn't","can't","problem","please try","try again","not valid","does not match","already exists","not exist","expired","timeout"],d=["success","logged in","welcome","created","saved","completed","submitted","updated","deleted","confirmed","verified","thank you","thanks","done","successful","approved"];for(const c of a)try{const m=document.querySelectorAll(c);for(const h of m){const l=(s=h.textContent)==null?void 0:s.trim();if(l&&l.length>2&&l.length<300&&this.isElementVisible(h)){const g=l.toLowerCase();if(u.some(y=>g.includes(y)))return`Error: ${l.substring(0,150)}`;if(c.includes("error")||c.includes("danger")||c.includes("invalid"))return`Error: ${l.substring(0,150)}`}}}catch{}try{const c=document.querySelectorAll("p, span, div, li");for(const m of c){const h=(r=m.textContent)==null?void 0:r.trim();if(h&&h.length>5&&h.length<150&&this.isElementVisible(m)){const l=h.toLowerCase();if(l.includes("invalid")&&(l.includes("password")||l.includes("email")||l.includes("credentials"))||l.includes("incorrect")&&(l.includes("password")||l.includes("email"))||l.includes("login failed")||l.includes("authentication failed"))return`Error: ${h}`}}}catch{}if(!t)for(const c of o)try{const m=document.querySelectorAll(c);for(const h of m){const l=(n=h.textContent)==null?void 0:n.trim();if(l&&l.length>2&&l.length<300&&this.isElementVisible(h)){const g=l.toLowerCase();if(d.some(y=>g.includes(y)))return`Success: ${l.substring(0,150)}`;if(c.includes("success"))return`Success: ${l.substring(0,150)}`}}}catch{}if(e==="click"){const c=window.location.pathname,m=window.location.search.toLowerCase();if(c.includes("dashboard")||c.includes("home")||c.includes("main")||c.includes("profile")||c.includes("account")||c.includes("admin"))return"Success: Redirected to dashboard";if(c.includes("error")||m.includes("error")||m.includes("failed"))return"Error: Redirected to error page";if((c.includes("login")||c.includes("signin"))&&(m.includes("error")||m.includes("failed")||m.includes("invalid")))return"Error: Login failed - redirected back to login"}const p=document.title.toLowerCase();return p.includes("error")||p.includes("404")||p.includes("denied")||p.includes("failed")?`Error: Page shows "${document.title}"`:p.includes("dashboard")||p.includes("welcome")||p.includes("home")||p.includes("success")?`Success: Page shows "${document.title}"`:void 0}catch{return}}substituteVariables(e,t){const s=n=>n.replace(/\{\{(\w+)\}\}/g,(a,o)=>t[o]??`{{${o}}}`),r={...e};return"url"in r&&typeof r.url=="string"&&(r.url=s(r.url)),"text"in r&&typeof r.text=="string"&&(r.text=s(r.text)),"value"in r&&typeof r.value=="string"&&(r.value=s(r.value)),r}async navigate(e,t){window.location.href=e,await this.waitForLoad(t)}async waitForLoad(e){return new Promise((t,s)=>{const r=setTimeout(()=>s(new Error("Page load timeout")),e);if(document.readyState==="complete"){clearTimeout(r),t();return}window.addEventListener("load",()=>{clearTimeout(r),t()},{once:!0})})}async findElement(e,t){const s=Date.now();for(;Date.now()-s<t;){for(const r of e)try{let n=null;switch(r.type){case"css":case"data-testid":case"data-cy":case"aria":n=document.querySelector(r.value);break;case"xpath":n=document.evaluate(r.value,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;break;case"text":n=this.findByText(r.value);break}if(n&&this.isElementVisible(n))return n}catch{}await this.sleep(100)}throw new Error(`Element not found with selectors: ${e.map(r=>r.value).join(", ")}`)}findByText(e){var r;const t=document.createTreeWalker(document.body,NodeFilter.SHOW_ELEMENT);let s;for(;s=t.nextNode();){const n=s;if(((r=n.textContent)==null?void 0:r.trim())===e)return n}return null}isElementVisible(e){const t=e.getBoundingClientRect(),s=window.getComputedStyle(e);return t.width>0&&t.height>0&&s.visibility!=="hidden"&&s.display!=="none"&&s.opacity!=="0"}async click(e,t){const s=await this.findElement(e,t);this.scrollIntoView(s),s.click()}async dblclick(e,t){const s=await this.findElement(e,t);this.scrollIntoView(s),s.dispatchEvent(new MouseEvent("dblclick",{bubbles:!0}))}async type(e,t,s){const r=await this.findElement(e,s);if(this.scrollIntoView(r),r instanceof HTMLInputElement||r instanceof HTMLTextAreaElement){r.focus(),r.value="";for(const n of t)r.value+=n,r.dispatchEvent(new Event("input",{bubbles:!0})),await this.sleep(10);r.dispatchEvent(new Event("change",{bubbles:!0}))}else throw new Error("Element is not an input or textarea")}async select(e,t,s){const r=await this.findElement(e,s);if(r instanceof HTMLSelectElement)r.value=t,r.dispatchEvent(new Event("change",{bubbles:!0}));else throw new Error("Element is not a select")}async check(e,t,s){const r=await this.findElement(e,s);if(r instanceof HTMLInputElement&&(r.type==="checkbox"||r.type==="radio"))r.checked!==t&&r.click();else throw new Error("Element is not a checkbox or radio")}async waitForElement(e,t){await this.findElement(e,t)}async waitTime(e){await this.sleep(e)}async scroll(e,t){window.scrollTo(e,t)}scrollIntoView(e){e.scrollIntoView({behavior:"smooth",block:"center"})}sleep(e){return new Promise(t=>setTimeout(t,e))}}let v=null;function z(){return v||(v=new _),v}class O{constructor(){f(this,"isActive",!1);f(this,"overlay",null);f(this,"highlightBox",null);f(this,"tooltip",null);f(this,"currentElement",null);f(this,"selectorGenerator",new T);f(this,"onElementSelected");f(this,"handleMouseMove",e=>{var s;const t=document.elementFromPoint(e.clientX,e.clientY);!t||(s=t.id)!=null&&s.startsWith("qaerx-picker")||(this.currentElement=t,this.highlightElement(t,e.clientX,e.clientY))});f(this,"handleClick",e=>{var r;if(e.preventDefault(),e.stopPropagation(),!this.currentElement||(r=e.target.id)!=null&&r.startsWith("qaerx-picker"))return;const s=this.selectorGenerator.generate(this.currentElement);this.stop(),this.onElementSelected&&this.onElementSelected(s)});f(this,"handleKeyDown",e=>{e.key==="Escape"&&this.stop()})}start(e){this.isActive||(this.isActive=!0,this.onElementSelected=e,this.createUI(),this.attachListeners(),document.body.style.cursor="crosshair")}stop(){this.isActive&&(this.isActive=!1,this.removeUI(),this.detachListeners(),document.body.style.cursor="")}createUI(){this.overlay=document.createElement("div"),this.overlay.id="qaerx-picker-overlay",this.overlay.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 999998;
      pointer-events: none;
    `,document.body.appendChild(this.overlay),this.highlightBox=document.createElement("div"),this.highlightBox.style.cssText=`
      position: absolute;
      pointer-events: none;
      border: 2px solid #10b981;
      background: rgba(16, 185, 129, 0.1);
      border-radius: 4px;
      transition: all 0.1s ease;
      z-index: 999999;
    `,document.body.appendChild(this.highlightBox),this.tooltip=document.createElement("div"),this.tooltip.style.cssText=`
      position: absolute;
      pointer-events: none;
      background: #1f2937;
      color: #f9fafb;
      padding: 8px 12px;
      border-radius: 6px;
      font-family: ui-monospace, monospace;
      font-size: 12px;
      white-space: nowrap;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
      z-index: 1000000;
      max-width: 400px;
      overflow: hidden;
      text-overflow: ellipsis;
    `,document.body.appendChild(this.tooltip);const e=document.createElement("div");e.style.cssText=`
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #1f2937;
      color: #f9fafb;
      padding: 12px 20px;
      border-radius: 8px;
      font-family: system-ui, -apple-system, sans-serif;
      font-size: 14px;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
      z-index: 1000001;
      display: flex;
      align-items: center;
      gap: 12px;
    `,e.innerHTML=`
      <span>ðŸŽ¯ Click on any element to select it</span>
      <button style="
        background: #ef4444;
        color: white;
        border: none;
        padding: 4px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      " id="qaerx-picker-cancel">Cancel (ESC)</button>
    `,document.body.appendChild(e);const t=e.querySelector("#qaerx-picker-cancel");t&&t.addEventListener("click",()=>this.stop()),this.overlay.dataset.banner="true",this.overlay.appendChild(e)}removeUI(){this.overlay&&(this.overlay.remove(),this.overlay=null),this.highlightBox&&(this.highlightBox.remove(),this.highlightBox=null),this.tooltip&&(this.tooltip.remove(),this.tooltip=null)}attachListeners(){document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("click",this.handleClick,!0),document.addEventListener("keydown",this.handleKeyDown)}detachListeners(){document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("click",this.handleClick,!0),document.removeEventListener("keydown",this.handleKeyDown)}highlightElement(e,t,s){if(!this.highlightBox||!this.tooltip)return;const r=e.getBoundingClientRect(),n=window.scrollX||window.pageXOffset,a=window.scrollY||window.pageYOffset;this.highlightBox.style.top=`${r.top+a}px`,this.highlightBox.style.left=`${r.left+n}px`,this.highlightBox.style.width=`${r.width}px`,this.highlightBox.style.height=`${r.height}px`;const u=this.selectorGenerator.generate(e)[0],d=this.formatSelectorForDisplay(u),p=t+15,c=s+15;this.tooltip.textContent=d,this.tooltip.style.left=`${p}px`,this.tooltip.style.top=`${c}px`}formatSelectorForDisplay(e){var a,o,u;const t=((a=this.currentElement)==null?void 0:a.tagName.toLowerCase())||"",s=((o=this.currentElement)==null?void 0:o.getAttribute("type"))||"",r=((u=this.currentElement)==null?void 0:u.getAttribute("name"))||"";let n=`${t}`;return s&&(n+=`[type="${s}"]`),r&&(n+=` (name="${r}")`),`${n} â†’ ${e.value}`}}let E=null;function U(){return E||(E=new O),E}class V{constructor(){f(this,"highlightBox",null)}highlight(e){this.clear();try{const t=document.querySelector(e);if(!t)return;this.createHighlightBox(t)}catch{}}clear(){this.highlightBox&&(this.highlightBox.remove(),this.highlightBox=null)}createHighlightBox(e){const t=e.getBoundingClientRect(),s=window.scrollX||window.pageXOffset,r=window.scrollY||window.pageYOffset;if(this.highlightBox=document.createElement("div"),this.highlightBox.id="qaerx-highlight-box",this.highlightBox.style.cssText=`
      position: absolute;
      top: ${t.top+r}px;
      left: ${t.left+s}px;
      width: ${t.width}px;
      height: ${t.height}px;
      pointer-events: none;
      border: 2px solid #3b82f6;
      background: rgba(59, 130, 246, 0.1);
      border-radius: 4px;
      z-index: 999999;
      animation: qaerx-pulse 2s ease-in-out infinite;
    `,!document.getElementById("qaerx-highlight-styles")){const n=document.createElement("style");n.id="qaerx-highlight-styles",n.textContent=`
        @keyframes qaerx-pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
      `,document.head.appendChild(n)}document.body.appendChild(this.highlightBox),e.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>this.clear(),3e3)}}let k=null;function X(){return k||(k=new V),k}function A(){const i={url:window.location.href,title:document.title,forms:[],buttons:[],links:[],inputs:[],metadata:{hasLogin:!1,hasSignup:!1,hasSearch:!1,hasCheckout:!1}};return document.querySelectorAll("form").forEach((n,a)=>{const o={id:n.id||void 0,name:n.getAttribute("name")||void 0,action:n.action||void 0,method:n.method||void 0,fields:[]};n.querySelectorAll("input, textarea, select").forEach((d,p)=>{const c=d;if(c.type==="hidden"||c.type==="submit")return;const m=S(c),h=w(c),l={type:c.type||"text",name:c.name||void 0,id:c.id||void 0,placeholder:c.placeholder||void 0,label:m||void 0,required:c.required||!1,selector:h};o.fields.push(l)}),i.forms.push(o)}),document.querySelectorAll("input:not(form input), textarea:not(form textarea), select:not(form select)").forEach((n,a)=>{const o=n;if(o.type==="hidden")return;const u=S(o),d=w(o);i.inputs.push({type:o.type||"text",name:o.name||void 0,id:o.id||void 0,placeholder:o.placeholder||void 0,label:u||void 0,required:o.required||!1,selector:d})}),document.querySelectorAll('button, input[type="submit"], input[type="button"]').forEach((n,a)=>{var p;const o=n,u=((p=o.textContent)==null?void 0:p.trim())||o.value||"Button",d=w(o);i.buttons.push({text:u,type:o.type||void 0,id:o.id||void 0,class:o.className||void 0,selector:d})}),Array.from(document.querySelectorAll("a[href]")).slice(0,20).forEach((n,a)=>{var p;const o=n,u=((p=o.textContent)==null?void 0:p.trim())||"Link",d=w(o);o.href&&!o.href.startsWith("javascript:")&&i.links.push({text:u,href:o.href,selector:d})}),i.metadata=Y(i),i}function S(i){var r,n,a;if(i.id){const o=document.querySelector(`label[for="${i.id}"]`);if(o)return((r=o.textContent)==null?void 0:r.trim())||null}const e=i.closest("label");if(e){const o=e.cloneNode(!0);return o.querySelectorAll("input, textarea, select").forEach(d=>d.remove()),((n=o.textContent)==null?void 0:n.trim())||null}const t=i.getAttribute("aria-label");if(t)return t;const s=i.previousSibling;if(s&&s.nodeType===Node.TEXT_NODE){const o=(a=s.textContent)==null?void 0:a.trim();if(o&&o.length<50)return o.replace(/:$/,"")}return null}function w(i,e,t){var a;if(i.id)return`#${i.id}`;if(i.getAttribute("name"))return`[name="${i.getAttribute("name")}"]`;if(i.getAttribute("data-testid"))return`[data-testid="${i.getAttribute("data-testid")}"]`;if(i instanceof HTMLInputElement&&i.placeholder)return`input[type="${i.type}"][placeholder="${i.placeholder}"]`;const s=i.tagName.toLowerCase();if(i.className&&!i.className.includes(" "))return`${s}.${i.className}`;const n=Array.from(((a=i.parentElement)==null?void 0:a.children)||[]).filter(o=>o.tagName===i.tagName).indexOf(i)+1;return`${s}:nth-of-type(${n})`}function Y(i){var m;const e={hasLogin:!1,hasSignup:!1,hasSearch:!1,hasCheckout:!1},t=((m=document.body.textContent)==null?void 0:m.toLowerCase())||"",s=window.location.href.toLowerCase(),r=i.forms.some(h=>h.fields.some(l=>l.type==="password")),n=i.forms.some(h=>h.fields.some(l=>{var g,y;return l.type==="email"||((g=l.name)==null?void 0:g.toLowerCase().includes("email"))||((y=l.id)==null?void 0:y.toLowerCase().includes("email"))})),a=t.includes("login")||t.includes("sign in")||s.includes("login");e.hasLogin=r&&(n||a);const o=i.forms.some(h=>h.fields.some(l=>{var g,y;return((g=l.name)==null?void 0:g.toLowerCase().includes("confirm"))||((y=l.id)==null?void 0:y.toLowerCase().includes("confirm"))})),u=t.includes("sign up")||t.includes("register")||s.includes("signup")||s.includes("register");e.hasSignup=r&&(o||u);const d=i.inputs.some(h=>{var l,g;return h.type==="search"||((l=h.name)==null?void 0:l.toLowerCase().includes("search"))||((g=h.placeholder)==null?void 0:g.toLowerCase().includes("search"))});e.hasSearch=d||t.includes("search");const p=s.includes("checkout")||s.includes("cart")||t.includes("checkout")||t.includes("payment"),c=i.forms.some(h=>h.fields.some(l=>{var g,y;return((g=l.name)==null?void 0:g.toLowerCase().includes("card"))||((y=l.placeholder)==null?void 0:y.toLowerCase().includes("card"))}));return e.hasCheckout=p||c,e}function K(){const i=A();let e=`URL: ${i.url}
Title: ${i.title}

`;return i.forms.length>0&&(e+=`Forms (${i.forms.length}):
`,i.forms.forEach((t,s)=>{e+=`  Form ${s+1}${t.id?` (id="${t.id}")`:""}:
`,t.fields.forEach(r=>{const n=r.label||r.placeholder||r.name||"field";e+=`    - ${r.type}: ${n} [${r.selector}]${r.required?" *required":""}
`})})),i.buttons.length>0&&(e+=`
Buttons (${Math.min(i.buttons.length,10)}):
`,i.buttons.slice(0,10).forEach(t=>{e+=`  - "${t.text}" [${t.selector}]
`})),i.links.length>0&&(e+=`
Links (${Math.min(i.links.length,10)}):
`,i.links.slice(0,10).forEach(t=>{e+=`  - "${t.text}" -> ${t.href}
`})),i.metadata.hasLogin&&(e+=`
Detected: Login page
`),i.metadata.hasSignup&&(e+=`Detected: Signup page
`),i.metadata.hasSearch&&(e+=`Detected: Search functionality
`),i.metadata.hasCheckout&&(e+=`Detected: Checkout/Payment page
`),e}const b=M(),$=z(),C=U(),L=X();chrome.runtime.onMessage.addListener((i,e,t)=>{var s;switch(i.type){case"ping":return t({success:!0,loaded:!0}),!1;case"recording:start":return b.start(i.sessionId),t({success:!0}),!1;case"recording:stop":const r=b.stop();return t({success:!0,steps:r}),!1;case"recording:pause":return b.pause(),t({success:!0}),!1;case"recording:resume":return b.resume(),t({success:!0}),!1;case"recording:status":return t({isRecording:b.isRecording(),steps:b.getSteps()}),!1;case"playback:execute":return $.execute(i.steps,{timeout:i.timeout||3e4,variables:i.variables||{},onStepStart:(n,a)=>{chrome.runtime.sendMessage({type:"playback:step-start",stepId:n.id,index:a}).catch(()=>{})},onStepComplete:(n,a)=>{chrome.runtime.sendMessage({type:"playback:step-complete",stepId:n.id,result:a}).catch(()=>{})}}).then(n=>{t({success:!0,result:n})}).catch(n=>{t({success:!1,error:String(n)})}),!0;case"playback:stop":return $.stop(),t({success:!0}),!1;case"picker:start":return C.start(n=>{chrome.runtime.sendMessage({type:"picker:element-selected",selectors:n}).catch(()=>{})}),t({success:!0}),!1;case"picker:stop":return C.stop(),t({success:!0}),!1;case"selector:validate":try{const n=document.querySelectorAll(i.selector);t({success:!0,isValid:n.length>0,count:n.length,element:n.length===1?{tag:n[0].tagName.toLowerCase(),text:(s=n[0].textContent)==null?void 0:s.trim().substring(0,50)}:null})}catch(n){t({success:!1,isValid:!1,count:0,error:String(n)})}return!1;case"element:highlight":return L.highlight(i.selector),t({success:!0}),!1;case"element:clear-highlight":return L.clear(),t({success:!0}),!1;case"analyzer:getPageContext":try{const n=K();t({success:!0,context:n})}catch(n){t({success:!1,error:String(n)})}return!1;case"analyzer:getFullAnalysis":try{const n=A();t({success:!0,analysis:n})}catch(n){t({success:!1,error:String(n)})}return!1;default:return t({error:"Unknown message type"}),!1}});chrome.runtime.sendMessage({type:"content-script:ready"}).catch(()=>{});console.log("[QAerx] Content script initialized");
