var A=Object.defineProperty;var B=(r,e,t)=>e in r?A(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var u=(r,e,t)=>B(r,typeof e!="symbol"?e+"":e,t);class I{constructor(e){u(this,"handler");u(this,"isAttached",!1);u(this,"boundHandlers",new Map);this.handler=e}attach(){if(this.isAttached)return;const e=["click","dblclick","input","change","keydown","scroll"];for(const t of e){const s=this.createHandler(t);this.boundHandlers.set(t,s),document.addEventListener(t,s,{capture:!0,passive:!0})}this.isAttached=!0}detach(){if(this.isAttached){for(const[e,t]of this.boundHandlers)document.removeEventListener(e,t,{capture:!0});this.boundHandlers.clear(),this.isAttached=!1}}createHandler(e){return t=>{const s=this.captureEvent(e,t);s&&this.handler(s)}}captureEvent(e,t){const s=t.target;if(!s||!(s instanceof Element)||s.closest("[data-qaerx-extension]"))return null;const n={timestamp:Date.now(),target:s,frameSelector:this.getFrameSelector(s)};switch(e){case"click":case"dblclick":{const i=t;return{...n,type:e,target:s,timestamp:n.timestamp,button:this.getMouseButton(i.button)}}case"input":{const i=s;return"value"in i?{...n,type:"input",target:s,timestamp:n.timestamp,value:i.value}:null}case"change":{const i=s;return i.tagName==="SELECT"?{...n,type:"change",target:s,timestamp:n.timestamp,value:i.value}:i.type==="checkbox"||i.type==="radio"?{...n,type:"change",target:s,timestamp:n.timestamp,checked:i.checked}:null}case"keydown":{const i=t;return this.isSpecialKey(i.key)?{...n,type:"keydown",target:s,timestamp:n.timestamp,key:i.key,modifiers:this.getModifiers(i)}:null}case"scroll":return{...n,type:"scroll",target:s,timestamp:n.timestamp,scrollX:window.scrollX,scrollY:window.scrollY};default:return null}}getMouseButton(e){switch(e){case 0:return"left";case 1:return"middle";case 2:return"right";default:return"left"}}isSpecialKey(e){return["Enter","Tab","Escape","Backspace","Delete","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Home","End","PageUp","PageDown","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12"].includes(e)}getModifiers(e){const t=[];return e.ctrlKey&&t.push("Ctrl"),e.shiftKey&&t.push("Shift"),e.altKey&&t.push("Alt"),e.metaKey&&t.push("Meta"),t}getFrameSelector(e){const t=e.ownerDocument.defaultView;if(t===window)return;const s=document.querySelectorAll("iframe");for(const n of s)if(n.contentWindow===t){const i=n.id?`#${n.id}`:"",o=n.name?`[name="${n.name}"]`:"";return i?`iframe${i}`:o?`iframe${o}`:`iframe[src="${n.src}"]`}}}class L{generate(e){const t=[];let s=0;const n=e.getAttribute("data-testid");n&&t.push({type:"data-testid",value:`[data-testid="${n}"]`,priority:s++,confidence:.95});const i=e.getAttribute("data-cy");i&&t.push({type:"data-cy",value:`[data-cy="${i}"]`,priority:s++,confidence:.95});const o=e.getAttribute("aria-label");o&&t.push({type:"aria",value:`[aria-label="${o}"]`,priority:s++,confidence:.85});const a=e.getAttribute("role");a&&e.id&&this.isStableId(e.id)&&t.push({type:"aria",value:`[role="${a}"]#${e.id}`,priority:s++,confidence:.8}),e.id&&this.isStableId(e.id)&&t.push({type:"css",value:`#${CSS.escape(e.id)}`,priority:s++,confidence:.95});const c=e.getAttribute("name");c&&this.isStableName(c)&&t.push({type:"css",value:`[name="${CSS.escape(c)}"]`,priority:s++,confidence:.9});const l=e.getAttribute("type");l&&c&&this.isStableName(c)&&t.push({type:"css",value:`input[type="${l}"][name="${CSS.escape(c)}"]`,priority:s++,confidence:.92});const d=e.getAttribute("placeholder");d&&d.length<50&&t.push({type:"css",value:`[placeholder="${CSS.escape(d)}"]`,priority:s++,confidence:.75});const h=this.generateSemanticCSS(e);h&&t.push({type:"css",value:h,priority:s++,confidence:.7});const y=this.getUniqueTextContent(e);y&&t.push({type:"text",value:y,priority:s++,confidence:.5});const f=this.generateFullCSSPath(e);return t.push({type:"css",value:f,priority:s++,confidence:.4}),t}isStableId(e){return![/^[a-f0-9]{8}-[a-f0-9]{4}/i,/^:r[0-9]+:/,/^ember\d+$/,/^ng-\d+$/,/^\d+$/,/^[a-z]+_[a-f0-9]{6,}$/i,/^mui-\d+$/,/^headlessui-/].some(s=>s.test(e))}isStableName(e){const t=[/^[a-f0-9]{8,}$/i,/^\d+$/];return e.length>0&&!t.some(s=>s.test(e))}generateSemanticCSS(e){const t=e.tagName.toLowerCase(),s=Array.from(e.classList).filter(o=>this.isSemanticClass(o)).slice(0,2);if(s.length===0)return null;const n=`${t}.${s.join(".")}`;if(document.querySelectorAll(n).length===1)return n;const i=e.parentElement;if(i&&i.tagName!=="BODY"){const o=i.tagName.toLowerCase(),a=Array.from(i.classList).filter(c=>this.isSemanticClass(c)).slice(0,1);if(a.length>0){const c=`${o}.${a[0]} > ${n}`;if(document.querySelectorAll(c).length===1)return c}}return null}isSemanticClass(e){const t=[/^[a-z]{1,2}-\d+$/,/^[a-f0-9]{6,}$/i,/^css-[a-z0-9]+$/i,/^sc-[a-zA-Z]+$/,/^emotion-[0-9]+$/,/^_[a-zA-Z0-9]+$/,/^[a-z]+__[a-z]+--/];return e.length>2&&!t.some(s=>s.test(e))}generateFullCSSPath(e){const t=[];let s=e;for(;s&&s.tagName!=="HTML";){let n=s.tagName.toLowerCase();if(s.id&&this.isStableId(s.id)){n=`#${CSS.escape(s.id)}`,t.unshift(n);break}const i=s.parentElement;if(i){const o=s.tagName,a=i.children,c=[];for(let l=0;l<a.length;l++)a[l].tagName===o&&c.push(a[l]);if(c.length>1){const l=c.indexOf(s)+1;n+=`:nth-of-type(${l})`}t.unshift(n),s=i}else{t.unshift(n);break}}return t.join(" > ")}getUniqueTextContent(e){var n;if(!["BUTTON","A","LABEL","H1","H2","H3","H4","H5","H6"].includes(e.tagName))return null;const s=(n=e.textContent)==null?void 0:n.trim();return!s||s.length<2||s.length>50?null:s}getElementDescription(e){if(e.type==="text")return`"${e.value.substring(0,20)}${e.value.length>20?"...":""}"`;if(e.type==="data-testid"||e.type==="data-cy"){const t=e.value.match(/\[data-(?:testid|cy)="([^"]+)"\]/);return t?t[1]:e.value}if(e.type==="aria"){const t=e.value.match(/\[aria-label="([^"]+)"\]/);return t?t[1]:e.value}return e.type==="css"&&e.value.startsWith("#")?e.value.substring(1):e.value.split(" > ").pop()||e.value}}class P{constructor(){u(this,"SCROLL_DEBOUNCE_MS",300)}filter(e){let t=e;return t=this.dedupeScrolls(t),t=this.collapseInputs(t),t=t.filter(s=>s.type!=="focus"&&s.type!=="blur"),t=t.filter(s=>!this.isExtensionElement(s.target)),t}dedupeScrolls(e){const t=[];let s=null,n=0;for(const i of e)i.type==="scroll"?(s&&i.timestamp-n<this.SCROLL_DEBOUNCE_MS?t[t.length-1]=i:t.push(i),s=i,n=i.timestamp):(t.push(i),s=null);return t}collapseInputs(e){const t=[];let s=[],n=null;const i=()=>{if(s.length>0){const o=s[s.length-1];t.push(o),s=[]}};for(const o of e)o.type==="input"?(n!==o.target&&(i(),n=o.target),s.push(o)):(i(),n=null,t.push(o));return i(),t}isExtensionElement(e){return e.closest("[data-qaerx-extension]")!==null}}const F=()=>crypto.randomUUID();function N(r,e){let t;return(...s)=>{clearTimeout(t),t=setTimeout(()=>r(...s),e)}}class D{constructor(){u(this,"session",null);u(this,"eventCapture");u(this,"selectorGenerator");u(this,"actionFilter");u(this,"debouncedProcessEvents");this.eventCapture=new I(this.handleEvent.bind(this)),this.selectorGenerator=new L,this.actionFilter=new P,this.debouncedProcessEvents=N(()=>this.processPendingEvents(),100)}start(e){if(this.session)throw new Error("Recording already in progress");this.session={id:e,startedAt:Date.now(),isPaused:!1,steps:[],pendingEvents:[]},this.eventCapture.attach(),this.sendToBackground({type:"recording:started",sessionId:e})}pause(){this.session&&(this.session.isPaused=!0,this.sendToBackground({type:"recording:paused"}))}resume(){this.session&&(this.session.isPaused=!1,this.sendToBackground({type:"recording:resumed"}))}stop(){if(!this.session)return[];this.eventCapture.detach(),this.processPendingEvents();const e=this.session.steps,t=this.session.id;return this.session=null,this.sendToBackground({type:"recording:stopped",sessionId:t,steps:e}),e}getSteps(){var e;return((e=this.session)==null?void 0:e.steps)||[]}isRecording(){return this.session!==null&&!this.session.isPaused}handleEvent(e){!this.session||this.session.isPaused||(this.session.pendingEvents.push(e),this.debouncedProcessEvents())}processPendingEvents(){if(!this.session||this.session.pendingEvents.length===0)return;const e=this.session.pendingEvents;this.session.pendingEvents=[];const t=this.actionFilter.filter(e);for(const s of t){const n=this.createStep(s);n&&(this.session.steps.push(n),this.sendToBackground({type:"recording:step-added",step:n}))}}createStep(e){const t=this.selectorGenerator.generate(e.target);if(t.length===0)return console.warn("Could not generate selectors for element:",e.target),null;const s=this.mapEventToAction(e);return s?{id:F(),type:"ui",order:this.session.steps.length,name:this.generateStepName(s,t[0]),enabled:!0,continueOnFailure:!1,action:s,selectors:e.frameSelector?t.map(i=>({...i,frameSelector:e.frameSelector})):t}:null}mapEventToAction(e){switch(e.type){case"click":return{type:"click",button:e.button};case"dblclick":return{type:"dblclick"};case"input":return{type:"type",text:e.value||""};case"change":return e.target.tagName==="SELECT"?{type:"select",value:e.value||""}:e.target instanceof HTMLInputElement&&(e.target.type==="checkbox"||e.target.type==="radio")?e.checked?{type:"check"}:{type:"uncheck"}:null;case"scroll":return{type:"scroll",x:e.scrollX,y:e.scrollY};case"keydown":return e.key?{type:"press",key:e.key,modifiers:e.modifiers}:null;default:return null}}generateStepName(e,t){var n;const s=this.selectorGenerator.getElementDescription(t);switch(e.type){case"click":return`Click ${s}`;case"dblclick":return`Double-click ${s}`;case"type":return`Type "${e.text.length>20?e.text.substring(0,20)+"...":e.text}" into ${s}`;case"select":return`Select "${e.value}" in ${s}`;case"check":return`Check ${s}`;case"uncheck":return`Uncheck ${s}`;case"scroll":return"Scroll page";case"press":const o=((n=e.modifiers)==null?void 0:n.join("+"))||"";return`Press ${o?o+"+":""}${e.key}`;default:return`${e.type} on ${s}`}}sendToBackground(e){try{chrome.runtime.sendMessage(e)}catch(t){console.error("Failed to send message to background:",t)}}}let w=null;function q(){return w||(w=new D),w}const M=3e4;class H{constructor(){u(this,"shouldStop",!1)}async execute(e,t={}){const{timeout:s=M,variables:n={},onStepStart:i,onStepComplete:o}=t;this.shouldStop=!1;const a={status:"passed",startedAt:Date.now(),completedAt:0,stepResults:[]};for(let c=0;c<e.length&&!this.shouldStop;c++){const l=e[c];if(!l.enabled){a.stepResults.push({stepId:l.id,status:"skipped",duration:0});continue}i==null||i(l,c);const d=Date.now(),h=await this.executeStep(l,s,n);if(h.duration=Date.now()-d,a.stepResults.push(h),o==null||o(l,h),h.status==="failed"&&!l.continueOnFailure){a.status="failed";break}}return a.completedAt=Date.now(),a}stop(){this.shouldStop=!0}async executeStep(e,t,s){try{const n=this.substituteVariables(e.action,s);switch(n.type){case"navigate":await this.navigate(n.url,t);break;case"click":await this.click(e.selectors,t);break;case"dblclick":await this.dblclick(e.selectors,t);break;case"type":await this.type(e.selectors,n.text,t);break;case"select":await this.select(e.selectors,n.value,t);break;case"check":await this.check(e.selectors,!0,t);break;case"uncheck":await this.check(e.selectors,!1,t);break;case"waitForElement":await this.waitForElement(e.selectors,t);break;case"waitTime":await this.waitTime(n.duration);break;case"scroll":await this.scroll(n.x||0,n.y||0);break;default:throw new Error(`Unknown action type: ${n.type}`)}return{stepId:e.id,status:"passed",duration:0}}catch(n){return{stepId:e.id,status:"failed",duration:0,error:n instanceof Error?n.message:String(n)}}}substituteVariables(e,t){const s=i=>i.replace(/\{\{(\w+)\}\}/g,(o,a)=>t[a]??`{{${a}}}`),n={...e};return"url"in n&&typeof n.url=="string"&&(n.url=s(n.url)),"text"in n&&typeof n.text=="string"&&(n.text=s(n.text)),"value"in n&&typeof n.value=="string"&&(n.value=s(n.value)),n}async navigate(e,t){window.location.href=e,await this.waitForLoad(t)}async waitForLoad(e){return new Promise((t,s)=>{const n=setTimeout(()=>s(new Error("Page load timeout")),e);if(document.readyState==="complete"){clearTimeout(n),t();return}window.addEventListener("load",()=>{clearTimeout(n),t()},{once:!0})})}async findElement(e,t){const s=Date.now();for(;Date.now()-s<t;){for(const n of e)try{let i=null;switch(n.type){case"css":case"data-testid":case"data-cy":case"aria":i=document.querySelector(n.value);break;case"xpath":i=document.evaluate(n.value,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;break;case"text":i=this.findByText(n.value);break}if(i&&this.isElementVisible(i))return i}catch{}await this.sleep(100)}throw new Error(`Element not found with selectors: ${e.map(n=>n.value).join(", ")}`)}findByText(e){var n;const t=document.createTreeWalker(document.body,NodeFilter.SHOW_ELEMENT);let s;for(;s=t.nextNode();){const i=s;if(((n=i.textContent)==null?void 0:n.trim())===e)return i}return null}isElementVisible(e){const t=e.getBoundingClientRect(),s=window.getComputedStyle(e);return t.width>0&&t.height>0&&s.visibility!=="hidden"&&s.display!=="none"&&s.opacity!=="0"}async click(e,t){const s=await this.findElement(e,t);this.scrollIntoView(s),s.click()}async dblclick(e,t){const s=await this.findElement(e,t);this.scrollIntoView(s),s.dispatchEvent(new MouseEvent("dblclick",{bubbles:!0}))}async type(e,t,s){const n=await this.findElement(e,s);if(this.scrollIntoView(n),n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement){n.focus(),n.value="";for(const i of t)n.value+=i,n.dispatchEvent(new Event("input",{bubbles:!0})),await this.sleep(10);n.dispatchEvent(new Event("change",{bubbles:!0}))}else throw new Error("Element is not an input or textarea")}async select(e,t,s){const n=await this.findElement(e,s);if(n instanceof HTMLSelectElement)n.value=t,n.dispatchEvent(new Event("change",{bubbles:!0}));else throw new Error("Element is not a select")}async check(e,t,s){const n=await this.findElement(e,s);if(n instanceof HTMLInputElement&&(n.type==="checkbox"||n.type==="radio"))n.checked!==t&&n.click();else throw new Error("Element is not a checkbox or radio")}async waitForElement(e,t){await this.findElement(e,t)}async waitTime(e){await this.sleep(e)}async scroll(e,t){window.scrollTo(e,t)}scrollIntoView(e){e.scrollIntoView({behavior:"smooth",block:"center"})}sleep(e){return new Promise(t=>setTimeout(t,e))}}let v=null;function O(){return v||(v=new H),v}class U{constructor(){u(this,"isActive",!1);u(this,"overlay",null);u(this,"highlightBox",null);u(this,"tooltip",null);u(this,"currentElement",null);u(this,"selectorGenerator",new L);u(this,"onElementSelected");u(this,"handleMouseMove",e=>{var s;const t=document.elementFromPoint(e.clientX,e.clientY);!t||(s=t.id)!=null&&s.startsWith("qaerx-picker")||(this.currentElement=t,this.highlightElement(t,e.clientX,e.clientY))});u(this,"handleClick",e=>{var n;if(e.preventDefault(),e.stopPropagation(),!this.currentElement||(n=e.target.id)!=null&&n.startsWith("qaerx-picker"))return;const s=this.selectorGenerator.generate(this.currentElement);this.stop(),this.onElementSelected&&this.onElementSelected(s)});u(this,"handleKeyDown",e=>{e.key==="Escape"&&this.stop()})}start(e){this.isActive||(this.isActive=!0,this.onElementSelected=e,this.createUI(),this.attachListeners(),document.body.style.cursor="crosshair")}stop(){this.isActive&&(this.isActive=!1,this.removeUI(),this.detachListeners(),document.body.style.cursor="")}createUI(){this.overlay=document.createElement("div"),this.overlay.id="qaerx-picker-overlay",this.overlay.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 999998;
      pointer-events: none;
    `,document.body.appendChild(this.overlay),this.highlightBox=document.createElement("div"),this.highlightBox.style.cssText=`
      position: absolute;
      pointer-events: none;
      border: 2px solid #10b981;
      background: rgba(16, 185, 129, 0.1);
      border-radius: 4px;
      transition: all 0.1s ease;
      z-index: 999999;
    `,document.body.appendChild(this.highlightBox),this.tooltip=document.createElement("div"),this.tooltip.style.cssText=`
      position: absolute;
      pointer-events: none;
      background: #1f2937;
      color: #f9fafb;
      padding: 8px 12px;
      border-radius: 6px;
      font-family: ui-monospace, monospace;
      font-size: 12px;
      white-space: nowrap;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
      z-index: 1000000;
      max-width: 400px;
      overflow: hidden;
      text-overflow: ellipsis;
    `,document.body.appendChild(this.tooltip);const e=document.createElement("div");e.style.cssText=`
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #1f2937;
      color: #f9fafb;
      padding: 12px 20px;
      border-radius: 8px;
      font-family: system-ui, -apple-system, sans-serif;
      font-size: 14px;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
      z-index: 1000001;
      display: flex;
      align-items: center;
      gap: 12px;
    `,e.innerHTML=`
      <span>ðŸŽ¯ Click on any element to select it</span>
      <button style="
        background: #ef4444;
        color: white;
        border: none;
        padding: 4px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      " id="qaerx-picker-cancel">Cancel (ESC)</button>
    `,document.body.appendChild(e);const t=e.querySelector("#qaerx-picker-cancel");t&&t.addEventListener("click",()=>this.stop()),this.overlay.dataset.banner="true",this.overlay.appendChild(e)}removeUI(){this.overlay&&(this.overlay.remove(),this.overlay=null),this.highlightBox&&(this.highlightBox.remove(),this.highlightBox=null),this.tooltip&&(this.tooltip.remove(),this.tooltip=null)}attachListeners(){document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("click",this.handleClick,!0),document.addEventListener("keydown",this.handleKeyDown)}detachListeners(){document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("click",this.handleClick,!0),document.removeEventListener("keydown",this.handleKeyDown)}highlightElement(e,t,s){if(!this.highlightBox||!this.tooltip)return;const n=e.getBoundingClientRect(),i=window.scrollX||window.pageXOffset,o=window.scrollY||window.pageYOffset;this.highlightBox.style.top=`${n.top+o}px`,this.highlightBox.style.left=`${n.left+i}px`,this.highlightBox.style.width=`${n.width}px`,this.highlightBox.style.height=`${n.height}px`;const c=this.selectorGenerator.generate(e)[0],l=this.formatSelectorForDisplay(c),d=t+15,h=s+15;this.tooltip.textContent=l,this.tooltip.style.left=`${d}px`,this.tooltip.style.top=`${h}px`}formatSelectorForDisplay(e){var o,a,c;const t=((o=this.currentElement)==null?void 0:o.tagName.toLowerCase())||"",s=((a=this.currentElement)==null?void 0:a.getAttribute("type"))||"",n=((c=this.currentElement)==null?void 0:c.getAttribute("name"))||"";let i=`${t}`;return s&&(i+=`[type="${s}"]`),n&&(i+=` (name="${n}")`),`${i} â†’ ${e.value}`}}let E=null;function z(){return E||(E=new U),E}class _{constructor(){u(this,"highlightBox",null)}highlight(e){this.clear();try{const t=document.querySelector(e);if(!t)return;this.createHighlightBox(t)}catch{}}clear(){this.highlightBox&&(this.highlightBox.remove(),this.highlightBox=null)}createHighlightBox(e){const t=e.getBoundingClientRect(),s=window.scrollX||window.pageXOffset,n=window.scrollY||window.pageYOffset;if(this.highlightBox=document.createElement("div"),this.highlightBox.id="qaerx-highlight-box",this.highlightBox.style.cssText=`
      position: absolute;
      top: ${t.top+n}px;
      left: ${t.left+s}px;
      width: ${t.width}px;
      height: ${t.height}px;
      pointer-events: none;
      border: 2px solid #3b82f6;
      background: rgba(59, 130, 246, 0.1);
      border-radius: 4px;
      z-index: 999999;
      animation: qaerx-pulse 2s ease-in-out infinite;
    `,!document.getElementById("qaerx-highlight-styles")){const i=document.createElement("style");i.id="qaerx-highlight-styles",i.textContent=`
        @keyframes qaerx-pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
      `,document.head.appendChild(i)}document.body.appendChild(this.highlightBox),e.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>this.clear(),3e3)}}let k=null;function X(){return k||(k=new _),k}function V(){const r={url:window.location.href,title:document.title,forms:[],buttons:[],links:[],inputs:[],metadata:{hasLogin:!1,hasSignup:!1,hasSearch:!1,hasCheckout:!1}};return document.querySelectorAll("form").forEach((i,o)=>{const a={id:i.id||void 0,name:i.getAttribute("name")||void 0,action:i.action||void 0,method:i.method||void 0,fields:[]};i.querySelectorAll("input, textarea, select").forEach((l,d)=>{const h=l;if(h.type==="hidden"||h.type==="submit")return;const y=S(h),f=x(h),p={type:h.type||"text",name:h.name||void 0,id:h.id||void 0,placeholder:h.placeholder||void 0,label:y||void 0,required:h.required||!1,selector:f};a.fields.push(p)}),r.forms.push(a)}),document.querySelectorAll("input:not(form input), textarea:not(form textarea), select:not(form select)").forEach((i,o)=>{const a=i;if(a.type==="hidden")return;const c=S(a),l=x(a);r.inputs.push({type:a.type||"text",name:a.name||void 0,id:a.id||void 0,placeholder:a.placeholder||void 0,label:c||void 0,required:a.required||!1,selector:l})}),document.querySelectorAll('button, input[type="submit"], input[type="button"]').forEach((i,o)=>{var d;const a=i,c=((d=a.textContent)==null?void 0:d.trim())||a.value||"Button",l=x(a);r.buttons.push({text:c,type:a.type||void 0,id:a.id||void 0,class:a.className||void 0,selector:l})}),Array.from(document.querySelectorAll("a[href]")).slice(0,20).forEach((i,o)=>{var d;const a=i,c=((d=a.textContent)==null?void 0:d.trim())||"Link",l=x(a);a.href&&!a.href.startsWith("javascript:")&&r.links.push({text:c,href:a.href,selector:l})}),r.metadata=Y(r),r}function S(r){var n,i,o;if(r.id){const a=document.querySelector(`label[for="${r.id}"]`);if(a)return((n=a.textContent)==null?void 0:n.trim())||null}const e=r.closest("label");if(e){const a=e.cloneNode(!0);return a.querySelectorAll("input, textarea, select").forEach(l=>l.remove()),((i=a.textContent)==null?void 0:i.trim())||null}const t=r.getAttribute("aria-label");if(t)return t;const s=r.previousSibling;if(s&&s.nodeType===Node.TEXT_NODE){const a=(o=s.textContent)==null?void 0:o.trim();if(a&&a.length<50)return a.replace(/:$/,"")}return null}function x(r,e,t){var o;if(r.id)return`#${r.id}`;if(r.getAttribute("name"))return`[name="${r.getAttribute("name")}"]`;if(r.getAttribute("data-testid"))return`[data-testid="${r.getAttribute("data-testid")}"]`;if(r instanceof HTMLInputElement&&r.placeholder)return`input[type="${r.type}"][placeholder="${r.placeholder}"]`;const s=r.tagName.toLowerCase();if(r.className&&!r.className.includes(" "))return`${s}.${r.className}`;const i=Array.from(((o=r.parentElement)==null?void 0:o.children)||[]).filter(a=>a.tagName===r.tagName).indexOf(r)+1;return`${s}:nth-of-type(${i})`}function Y(r){var y;const e={hasLogin:!1,hasSignup:!1,hasSearch:!1,hasCheckout:!1},t=((y=document.body.textContent)==null?void 0:y.toLowerCase())||"",s=window.location.href.toLowerCase(),n=r.forms.some(f=>f.fields.some(p=>p.type==="password")),i=r.forms.some(f=>f.fields.some(p=>{var m,g;return p.type==="email"||((m=p.name)==null?void 0:m.toLowerCase().includes("email"))||((g=p.id)==null?void 0:g.toLowerCase().includes("email"))})),o=t.includes("login")||t.includes("sign in")||s.includes("login");e.hasLogin=n&&(i||o);const a=r.forms.some(f=>f.fields.some(p=>{var m,g;return((m=p.name)==null?void 0:m.toLowerCase().includes("confirm"))||((g=p.id)==null?void 0:g.toLowerCase().includes("confirm"))})),c=t.includes("sign up")||t.includes("register")||s.includes("signup")||s.includes("register");e.hasSignup=n&&(a||c);const l=r.inputs.some(f=>{var p,m;return f.type==="search"||((p=f.name)==null?void 0:p.toLowerCase().includes("search"))||((m=f.placeholder)==null?void 0:m.toLowerCase().includes("search"))});e.hasSearch=l||t.includes("search");const d=s.includes("checkout")||s.includes("cart")||t.includes("checkout")||t.includes("payment"),h=r.forms.some(f=>f.fields.some(p=>{var m,g;return((m=p.name)==null?void 0:m.toLowerCase().includes("card"))||((g=p.placeholder)==null?void 0:g.toLowerCase().includes("card"))}));return e.hasCheckout=d||h,e}function K(){const r=V();let e=`URL: ${r.url}
Title: ${r.title}

`;return r.forms.length>0&&(e+=`Forms (${r.forms.length}):
`,r.forms.forEach((t,s)=>{e+=`  Form ${s+1}${t.id?` (id="${t.id}")`:""}:
`,t.fields.forEach(n=>{const i=n.label||n.placeholder||n.name||"field";e+=`    - ${n.type}: ${i} [${n.selector}]${n.required?" *required":""}
`})})),r.buttons.length>0&&(e+=`
Buttons (${Math.min(r.buttons.length,10)}):
`,r.buttons.slice(0,10).forEach(t=>{e+=`  - "${t.text}" [${t.selector}]
`})),r.links.length>0&&(e+=`
Links (${Math.min(r.links.length,10)}):
`,r.links.slice(0,10).forEach(t=>{e+=`  - "${t.text}" -> ${t.href}
`})),r.metadata.hasLogin&&(e+=`
Detected: Login page
`),r.metadata.hasSignup&&(e+=`Detected: Signup page
`),r.metadata.hasSearch&&(e+=`Detected: Search functionality
`),r.metadata.hasCheckout&&(e+=`Detected: Checkout/Payment page
`),e}const b=q(),$=O(),C=z(),T=X();chrome.runtime.onMessage.addListener((r,e,t)=>{var s;switch(r.type){case"ping":return t({success:!0,loaded:!0}),!1;case"recording:start":return b.start(r.sessionId),t({success:!0}),!1;case"recording:stop":const n=b.stop();return t({success:!0,steps:n}),!1;case"recording:pause":return b.pause(),t({success:!0}),!1;case"recording:resume":return b.resume(),t({success:!0}),!1;case"recording:status":return t({isRecording:b.isRecording(),steps:b.getSteps()}),!1;case"playback:execute":return $.execute(r.steps,{timeout:r.timeout||3e4,variables:r.variables||{},onStepStart:(i,o)=>{chrome.runtime.sendMessage({type:"playback:step-start",stepId:i.id,index:o}).catch(()=>{})},onStepComplete:(i,o)=>{chrome.runtime.sendMessage({type:"playback:step-complete",stepId:i.id,result:o}).catch(()=>{})}}).then(i=>{t({success:!0,result:i})}).catch(i=>{t({success:!1,error:String(i)})}),!0;case"playback:stop":return $.stop(),t({success:!0}),!1;case"picker:start":return C.start(i=>{chrome.runtime.sendMessage({type:"picker:element-selected",selectors:i}).catch(()=>{})}),t({success:!0}),!1;case"picker:stop":return C.stop(),t({success:!0}),!1;case"selector:validate":try{const i=document.querySelectorAll(r.selector);t({success:!0,isValid:i.length>0,count:i.length,element:i.length===1?{tag:i[0].tagName.toLowerCase(),text:(s=i[0].textContent)==null?void 0:s.trim().substring(0,50)}:null})}catch(i){t({success:!1,isValid:!1,count:0,error:String(i)})}return!1;case"element:highlight":return T.highlight(r.selector),t({success:!0}),!1;case"element:clear-highlight":return T.clear(),t({success:!0}),!1;case"analyzer:getPageContext":try{const i=K();t({success:!0,context:i})}catch(i){t({success:!1,error:String(i)})}return!1;default:return t({error:"Unknown message type"}),!1}});chrome.runtime.sendMessage({type:"content-script:ready"}).catch(()=>{});console.log("[QAerx] Content script initialized");
